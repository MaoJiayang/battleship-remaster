<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ÊåáÊå•ÂÆòÔºöÂÜ≥ÊàòÂ§ßÊ¥ã</title>
  <script type="module" crossorigin>(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const o of l.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerPolicy&&(l.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?l.credentials="include":i.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(i){if(i.ep)return;i.ep=!0;const l=n(i);fetch(i.href,l)}})();const m=10,tt=40,nt="Êµ∑ÊùÉ:ÂÜ≥ÊàòÊ∑±Ëìù",st="v2.5Œ±",le={MOBILE_BREAKPOINT:768,MOBILE:{VIEW_SWITCH_DELAY:750,AI_ACTION_DELAY:800,TURN_BACK_DELAY:1e3},DESKTOP:{VIEW_SWITCH_DELAY:0,AI_ACTION_DELAY:0,TURN_BACK_DELAY:0}},ee=[{name:"Ëà™Á©∫ÊØçËà∞",len:4,maxHp:2,code:"CV",type:"carrier"},{name:"ÊàòÂàóËà∞",len:4,maxHp:3,code:"BB",type:"battleship"},{name:"ËΩªÂ∑°Ê¥ãËà∞",len:3,maxHp:1,code:"CL",type:"cruiser"},{name:"ÊΩúËâá",len:1,maxHp:2,code:"SS",type:"sub"},{name:"È©±ÈÄêËà∞",len:2,maxHp:1,code:"DD",type:"destroyer"}],Ce={EASY:{alpha:.1,randomness:.5},NORMAL:{alpha:.4,randomness:.25},HARD:{alpha:.7,randomness:0}},De="EASY";class oe{constructor({id:e,label:n,icon:s}){this.id=e,this.label=n,this.icon=s}canUse(e){throw new Error("Â≠êÁ±ªÂøÖÈ°ªÂÆûÁé∞ canUse ÊñπÊ≥ï")}isValidTarget(e,n){const{r:s,c:i}=e,l=n.defenderGrid[s]?.[i];return!(!l||l.hit&&l.shipId===-1)}previewArea(e){throw new Error("Â≠êÁ±ªÂøÖÈ°ªÂÆûÁé∞ previewArea ÊñπÊ≥ï")}resolve(e,n){throw new Error("Â≠êÁ±ªÂøÖÈ°ªÂÆûÁé∞ resolve ÊñπÊ≥ï")}}const B={CELL_UPDATE:"CELL_UPDATE",SHIP_UPDATE:"SHIP_UPDATE",LOG:"LOG",EFFECT:"EFFECT"};class Pe{constructor(e){this.id=e.id,this.code=e.code,this.name=e.name,this.len=e.len,this.maxHp=e.maxHp,this.hp=[...e.hp],this.sunk=e.sunk,this.r=e.r??-1,this.c=e.c??-1,this.vertical=e.vertical??!1}}function G(t,e,n,s=null){return{type:B.CELL_UPDATE,payload:{r:t,c:e,state:n,markClass:s}}}function Ie(t,e,n,s){return{type:B.SHIP_UPDATE,payload:{shipId:t,segmentIndex:e,newHp:n,sunk:s}}}function q(t,e){return{type:B.LOG,payload:{message:t,className:e}}}function H(t,e){return t>=0&&t<m&&e>=0&&e<m}function Me(t,e,n,s,i,l){const o=[];if(!H(t,e))return{events:[],hitShip:null,sunk:!1};const r=s[t][e];if(r.hit&&r.shipId===-1)return{events:[],hitShip:null,sunk:!1};if(r.hit=!0,r.shipId!==-1){const c=i[r.shipId],a=r.segmentIndex;if(c.hp[a]<=0)return{events:[],hitShip:c,sunk:!1};n>0&&(c.hp[a]-=n);const u=c.hp[a]<=0?"DESTROYED":"HIT";o.push(G(t,e,u)),o.push(Ie(c.id,a,c.hp[a],!1));const d=c.hp.every(f=>f<=0)&&!c.sunk;if(d){c.sunk=!0,o.push(Ie(c.id,-1,0,!0));const f=l?"c-warn":"c-e",p=l?`ÊàòÊä•ÔºöÊïåÊñπ„Äê${c.name}„ÄëÁ°ÆËÆ§Ê≤âÊ≤°ÔºÅ`:`‰∏•ÈáçË≠¶Êä•ÔºöÊàëÊñπ„Äê${c.name}„ÄëÊ≤âÊ≤°ÔºÅ`;o.push(q(p,f))}return{events:o,hitShip:c,sunk:d}}else return o.push(G(t,e,"MISS")),{events:o,hitShip:null,sunk:!1}}function it(t,e,n,s,i){const l=[],o=[];for(const{r,c}of t){const a=Me(r,c,e,n,s,i);l.push(...a.events),a.sunk&&o.push(a.hitShip.id)}return{events:l,shipsSunk:o}}class Ne extends oe{constructor(){super({id:"AP",label:"‰∏ªÁÇÆ",icon:"üí•"})}canUse(e){return!0}isValidTarget(e,n){if(!super.isValidTarget(e,n))return!1;const{r:s,c:i}=e,l=n.defenderGrid[s][i];return!(l.hit&&l.shipId!==-1&&n.defenderShips[l.shipId].hp[l.segmentIndex]<=0)}previewArea(e){return{cells:[{r:e.r,c:e.c}]}}resolve(e,n){const{r:s,c:i}=e,l=this._calculateDamage(n.attackerShips),o=Me(s,i,l,n.defenderGrid,n.defenderShips,n.isPlayer),r=n.isPlayer?"c-p":"c-e",c=n.isPlayer?"‰ΩøÁî®":"ÊïåÊñπ‰ΩøÁî®";o.events.unshift(q(`${c}‰∏ªÁÇÆÊîªÂáª (${s+1},${i+1})Ôºå‰º§ÂÆ≥: ${l}`,r));const a=o.sunk?[o.hitShip.id]:[];return{events:o.events,shipsSunk:a}}_calculateDamage(e){const n=e.some(l=>l.code==="BB"&&!l.sunk),s=e.some(l=>l.code==="SS"&&!l.sunk),i=e.some(l=>l.code==="CL"&&!l.sunk);return n||s?3:i?2:1}}class _e extends oe{constructor(){super({id:"HE",label:"Á©∫Ë¢≠",icon:"‚úàÔ∏è"})}canUse(e){return e.attackerShips.some(n=>n.code==="CV"&&!n.sunk)}previewArea(e){const{r:n,c:s}=e;return{cells:[[0,0],[-1,-1],[-1,1],[1,-1],[1,1]].map(([o,r])=>({r:n+o,c:s+r})).filter(o=>H(o.r,o.c))}}isValidTarget(e,n){return H(e.r,e.c)}resolve(e,n){const{r:s,c:i}=e,o=this.previewArea(e).cells.filter(u=>{const d=n.defenderGrid[u.r][u.c];return!(d.hit&&d.shipId===-1||d.hit&&d.shipId!==-1&&n.defenderShips[d.shipId].hp[d.segmentIndex]<=0)}),r=it(o,1,n.defenderGrid,n.defenderShips,n.isPlayer),c=n.isPlayer?"c-p":"c-e",a=n.isPlayer?"ÂëºÂè´":"ÊïåÊñπÂèëÂä®";return r.events.unshift(q(`${a}Á©∫Ë¢≠Ë¶ÜÁõñ (${s+1},${i+1}) Âë®ËæπÔºåÊâìÂáªÁÇπÊï∞: ${o.length}`,c)),{events:r.events,shipsSunk:r.shipsSunk}}}function lt(t,e,n,s,i){const l=[];let o=0;const r=[];for(let a=-1;a<=1;a++)for(let u=-1;u<=1;u++){const d=t+a,f=e+u;if(!H(d,f))continue;r.push({r:d,c:f,isCenter:a===0&&u===0});const p=n[d][f];p.shipId!==-1&&!p.hit&&o++}const c=i?"":"ÊïåÊñπ";if(o===0){for(const{r:a,c:u}of r){const d=n[a][u];d.hit||(d.hit=!0,l.push(G(a,u,"MISS")))}return l.push(q(`${c}Â£∞Á∫≥Êâ´Êèè (${t+1},${e+1}) Âå∫ÂüüÔºöÊó†ÂèçÂ∫î„ÄÇ`,"c-sys")),{events:l,hasSignal:!1}}else{const a=n[t][e];a.hit||(a.hit=!0,a.shipId!==-1?l.push(G(t,e,"HIT")):l.push(G(t,e,"MISS")));for(const{r:u,c:d,isCenter:f}of r){if(f)continue;n[u][d].hit||l.push(G(u,d,"SUSPECT"))}return l.push(q(`${c}Â£∞Á∫≥Êâ´Êèè (${t+1},${e+1}) Âå∫ÂüüÔºöÂèëÁé∞‰ø°Âè∑ÔºÅÂë®ËæπÊ†áËÆ∞‰∏∫Áñë‰ºº„ÄÇ`,"c-warn")),{events:l,hasSignal:!0}}}class Ge extends oe{constructor(){super({id:"SONAR",label:"Ê∞¥Âê¨",icon:"üì°"})}canUse(e){return e.attackerShips.some(n=>n.code==="DD"&&!n.sunk)}previewArea(e){const{r:n,c:s}=e,i=[];for(let l=-1;l<=1;l++)for(let o=-1;o<=1;o++){const r=n+l,c=s+o;H(r,c)&&i.push({r,c})}return{cells:i}}isValidTarget(e,n){return H(e.r,e.c)}resolve(e,n){const{r:s,c:i}=e;return{events:lt(s,i,n.defenderGrid,n.defenderShips,n.isPlayer).events,shipsSunk:[]}}}const ot={AP:new Ne,HE:new _e,SONAR:new Ge},h={UNKNOWN:0,MISS:1,HIT:2,DESTROYED:3,SUSPECT:4,SUNK:5},rt=2e3,D=1e-10;let x=null;function re(){return Array(m).fill(0).map(()=>Array(m).fill(0))}function ct(){x=re()}function at(t,e){x||(x=re());const{weapon:n,r:s,c:i}=t;if(n!=="SONAR"){if(n==="AP")s>=0&&s<m&&i>=0&&i<m&&(x[s][i]+=e.apDamage);else if(n==="HE"){const l=[[0,0],[-1,-1],[-1,1],[1,-1],[1,1]];for(const[o,r]of l){const c=s+o,a=i+r;c>=0&&c<m&&a>=0&&a<m&&(x[c][a]+=1)}}}}function dt(t){const{viewGrid:e,myShips:n,enemyShips:s,difficultyConfig:i}=t,l=pt(s),o=n.filter(p=>!p.sunk);if(o.length===0)return Le(e);if(Math.random()<(i.randomness??0))return ht(e,l);const r=new He(o,e),c=i.alpha??.5,a=mt(e,l);if(a.length===0)return Le(e);let u=null,d=-1/0;const f=[];for(const p of a){const v=ut(r,p,l,c);v>d+1e-9?(d=v,f.length=0,f.push(p)):Math.abs(v-d)<1e-9&&f.push(p)}return u=f[Math.floor(Math.random()*f.length)],at(u,l),u}class He{constructor(e,n){this.ships=e,this.viewGrid=n,this.boardSize=m,this.constraints=this._buildConstraints(),this.samples=this._sampleConfigurations(rt),this._probabilityGrid=null,this._entropy=null}_buildConstraints(){const e=[],n=[],s=[];for(let i=0;i<this.boardSize;i++)for(let l=0;l<this.boardSize;l++){const o=this.viewGrid[i][l];o===h.HIT||o===h.DESTROYED?e.push({r:i,c:l}):o===h.MISS||o===h.SUNK?n.push({r:i,c:l}):o===h.SUSPECT&&s.push({r:i,c:l})}return{mustHit:e,mustAvoid:n,suspect:s}}_sampleConfigurations(e){const n=[];let s=0;const i=e*20;for(;n.length<e&&s<i;){s++;const l=this._sampleOneConfiguration();l&&n.push(l)}for(;n.length<e&&n.length>0;)n.push(n[Math.floor(Math.random()*n.length)]);return n}_sampleOneConfiguration(){const e=new Set,n=[],s=[...this.ships].sort((i,l)=>l.len-i.len);for(const i of s){const l=this._sampleShipPlacement(i,e);if(!l)return null;n.push(l),l.cells.forEach(o=>e.add(`${o.r},${o.c}`))}return this._validateMustHit(n)?n:null}_sampleShipPlacement(e,n){const s=[];for(let o=0;o<=1;o++){const r=o===1,c=r?this.boardSize-e.len:this.boardSize-1,a=r?this.boardSize-1:this.boardSize-e.len;for(let u=0;u<=c;u++)for(let d=0;d<=a;d++){const f=[];let p=!0,v=0,b=0;for(let A=0;A<e.len;A++){const N=r?u+A:u,_=r?d:d+A,y=`${N},${_}`;if(n.has(y)){p=!1;break}const S=this.viewGrid[N][_];if(S===h.MISS||S===h.SUNK){p=!1;break}f.push({r:N,c:_}),(S===h.HIT||S===h.DESTROYED)&&v++,S===h.SUSPECT&&b++}if(p){const A=1+v*10+b*2;s.push({cells:f,weight:A,shipId:e.id})}}}if(s.length===0)return null;const i=s.reduce((o,r)=>o+r.weight,0);let l=Math.random()*i;for(const o of s)if(l-=o.weight,l<=0)return o;return s[s.length-1]}_validateMustHit(e){const n=new Set;for(const s of e)for(const i of s.cells){const l=this.viewGrid[i.r][i.c];(l===h.HIT||l===h.DESTROYED)&&n.add(`${i.r},${i.c}`)}for(const s of this.constraints.mustHit)if(!n.has(`${s.r},${s.c}`))return!1;return!0}getProbabilityGrid(){if(this._probabilityGrid)return this._probabilityGrid;const e=Array(this.boardSize).fill(0).map(()=>Array(this.boardSize).fill(0));if(this.samples.length===0)return e;for(const s of this.samples)for(const i of s)for(const l of i.cells)e[l.r][l.c]++;const n=this.samples.length;for(let s=0;s<this.boardSize;s++)for(let i=0;i<this.boardSize;i++)e[s][i]/=n;for(let s=0;s<this.boardSize;s++)for(let i=0;i<this.boardSize;i++){const l=this.viewGrid[s][i];l===h.HIT?e[s][i]=1:(l===h.MISS||l===h.DESTROYED||l===h.SUNK)&&(e[s][i]=0)}return this._probabilityGrid=e,e}getEntropy(){if(this._entropy!==null)return this._entropy;const e=this.getProbabilityGrid();let n=0;for(let s=0;s<this.boardSize;s++)for(let i=0;i<this.boardSize;i++){const l=this.viewGrid[s][i];if(l===h.UNKNOWN||l===h.SUSPECT){const o=e[s][i];o>D&&o<1-D&&(n-=o*Math.log2(o)+(1-o)*Math.log2(1-o))}}return this._entropy=n,n}getConditionalEntropy(e){const{weapon:n,r:s,c:i}=e,l=this.getProbabilityGrid();return n==="SONAR"?this._getSonarConditionalEntropy(s,i,l):this._getAttackConditionalEntropy(e,l)}_getSonarConditionalEntropy(e,n,s){const i=e>=0&&e<this.boardSize&&n>=0&&n<this.boardSize?s[e][n]:0;let l=0,o=0;for(let u=-1;u<=1;u++)for(let d=-1;d<=1;d++){const f=e+u,p=n+d;if(f>=0&&f<this.boardSize&&p>=0&&p<this.boardSize){const v=this.viewGrid[f][p];if(v===h.UNKNOWN||v===h.SUSPECT){const b=s[f][p];b>D&&b<1-D&&(l+=-b*Math.log2(b)-(1-b)*Math.log2(1-b),o++)}}}if(o===0)return this.getEntropy();const r=this.getEntropy(),c=this._cellEntropy(i),a=i*(r-c)+(1-i)*(r-l);return Math.max(0,r-Math.max(0,r-a))}_getAttackConditionalEntropy(e,n){const{weapon:s,r:i,c:l}=e,o=this.getEntropy(),r=this._getWeaponCoverage(s,i,l);let c=0;for(const a of r)if(a.r>=0&&a.r<this.boardSize&&a.c>=0&&a.c<this.boardSize){const u=this.viewGrid[a.r][a.c];if(u===h.UNKNOWN||u===h.SUSPECT){const d=n[a.r][a.c];c+=this._cellEntropy(d)}}return Math.max(0,o-c)}_cellEntropy(e){return e<D||e>1-D?0:-e*Math.log2(e)-(1-e)*Math.log2(1-e)}_getWeaponCoverage(e,n,s){const i=ot[e];return i?i.previewArea({r:n,c:s}).cells:[{r:n,c:s}]}}function ut(t,e,n,s){const{weapon:i,r:l,c:o}=e,r=t.getProbabilityGrid(),c=t.getEntropy(),a=t.getConditionalEntropy(e),u=Math.max(0,c-a),d=c>D?u/c:0,f=Math.max(...t.ships.map(A=>A.maxHp??1)),p=ft(e,r,n,f),v=i==="HE"?5:i==="AP"?n.apDamage:0,b=v>0?p/v:0;return i==="SONAR"?s*d:s*d+(1-s)*b}function ft(t,e,n,s){const{weapon:i,r:l,c:o}=t;if(i==="SONAR")return 0;x||(x=re());let r=0;const c=i==="AP"?n.apDamage:1;if(i==="AP"){if(l>=0&&l<m&&o>=0&&o<m){const a=Ae(l,o,c,s);r=e[l][o]*a}}else if(i==="HE"){const a=[[0,0],[-1,-1],[-1,1],[1,-1],[1,1]];for(const[u,d]of a){const f=l+u,p=o+d;if(f>=0&&f<m&&p>=0&&p<m){const v=Ae(f,p,1,s);r+=e[f][p]*v}}}return r}function Ae(t,e,n,s){const i=x[t][e],l=Math.max(0,s-i);return Math.min(n,l)}function mt(t,e){const n=[];for(let s=0;s<m;s++)for(let i=0;i<m;i++){const l=t[s][i];if(!(l===h.MISS||l===h.SUNK)){if(l===h.DESTROYED){e.canUseAir&&n.push({weapon:"HE",r:s,c:i});continue}n.push({weapon:"AP",r:s,c:i}),e.canUseAir&&n.push({weapon:"HE",r:s,c:i}),e.canUseSonar&&(l===h.UNKNOWN||l===h.SUSPECT)&&n.push({weapon:"SONAR",r:s,c:i})}}return n}function pt(t){const e=t.some(r=>r.code==="CV"&&!r.sunk),n=t.some(r=>r.code==="CL"&&!r.sunk),s=t.some(r=>r.code==="BB"&&!r.sunk),i=t.some(r=>r.code==="SS"&&!r.sunk),l=t.some(r=>r.code==="DD"&&!r.sunk);let o=1;return s||i?o=3:n&&(o=2),{canUseAir:e,canUseSonar:l,apDamage:o}}function ht(t,e){let n,s,i=0;do n=Math.floor(Math.random()*m),s=Math.floor(Math.random()*m),i++;while((t[n][s]===h.MISS||t[n][s]===h.DESTROYED||t[n][s]===h.SUNK)&&i<200);return e.canUseAir&&Math.random()<.1?{r:n,c:s,weapon:"HE"}:e.canUseSonar&&Math.random()<.1?{r:n,c:s,weapon:"SONAR"}:{r:n,c:s,weapon:"AP"}}function Le(t){for(let e=0;e<m;e++)for(let n=0;n<m;n++){const s=t[e][n];if(s!==h.MISS&&s!==h.DESTROYED&&s!==h.SUNK)return{r:e,c:n,weapon:"AP"}}return{r:0,c:0,weapon:"AP"}}function gt(t,e,n=null){if(!e||e.length===0)return Array(m).fill(0).map(()=>Array(m).fill(0));const s=e.filter(l=>!l.sunk);return s.length===0?Array(m).fill(0).map(()=>Array(m).fill(0)):new He(s,t).getProbabilityGrid()}const yt=5,vt=1.5;function Oe(t,e=m){const n=[],s=bt(e),i=Et([...t]);for(const l of i){const o=It(l,s,n,e);o?(St(s,o.r,o.c,l.len,o.v),n.push({...l,r:o.r,c:o.c,v:o.v})):console.error("AI ÈÉ®ÁΩ≤Â§±Ë¥•ÔºöÊó†Ê≥ïÊîæÁΩÆËàπÂè™",l.name)}return n}function Et(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}function bt(t){return Array(t).fill(0).map(()=>Array(t).fill(0))}function St(t,e,n,s,i){for(let l=0;l<s;l++){const o=i?e+l:e,r=i?n:n+l;t[o][r]=1}}function It(t,e,n,s){const i=[];for(let r=0;r<=1;r++){const c=r===1,a=c?s-t.len:s-1,u=c?s-1:s-t.len;for(let d=0;d<=a;d++)for(let f=0;f<=u;f++)if(At(e,d,f,t.len,c,s)){const p=Lt(d,f,t.len,c,n);i.push({r:d,c:f,v:c,minDist:p})}}if(i.length===0)return null;if(n.length===0)return i[Math.floor(Math.random()*i.length)];for(let r=yt;r>=vt;r-=.5){const c=i.filter(a=>a.minDist>=r);if(c.length>0)return c[Math.floor(Math.random()*c.length)]}i.sort((r,c)=>c.minDist-r.minDist);const l=Math.min(5,i.length),o=i.slice(0,l);return o[Math.floor(Math.random()*o.length)]}function At(t,e,n,s,i,l){for(let o=0;o<s;o++){const r=i?e+o:e,c=i?n:n+o;if(r>=l||c>=l||t[r][c]===1)return!1}return!0}function Lt(t,e,n,s,i){if(i.length===0)return 1/0;let l=1/0;const o=[];for(let r=0;r<n;r++)o.push({r:s?t+r:t,c:s?e:e+r});for(const r of i)for(let c=0;c<r.len;c++){const a=r.v?r.r+c:r.r,u=r.v?r.c:r.c+c;for(const d of o){const f=Math.sqrt(Math.pow(d.r-a,2)+Math.pow(d.c-u,2));l=Math.min(l,f)}}return l}class kt{constructor(){this._weapons=new Map}register(e){this._weapons.set(e.id,e)}get(e){return this._weapons.get(e)}getAll(){return Array.from(this._weapons.values())}has(e){return this._weapons.has(e)}}class wt{constructor(e,n){this.registry=e,this.renderer=n,this.currentWeaponId="AP"}setCurrentWeapon(e){this.registry.has(e)&&(this.currentWeaponId=e)}getCurrentWeapon(){return this.registry.get(this.currentWeaponId)}getPreviewArea(e){const n=this.getCurrentWeapon();return n?n.previewArea(e):{cells:[]}}executePlayerAction(e,n){const s=this.getCurrentWeapon();if(!s)return{success:!1,events:[],shipsSunk:[],reason:"Ê≠¶Âô®‰∏çÂ≠òÂú®"};if(!s.canUse(n))return{success:!1,events:[],shipsSunk:[],reason:"Ê≠¶Âô®‰∏çÂèØÁî®"};if(!s.isValidTarget(e,n))return{success:!1,events:[],shipsSunk:[],reason:"ÁõÆÊ†áÊó†Êïà"};const i=s.resolve(e,n);return this._injectGrid(i.events,"ENEMY"),this.renderer.render(i.events),{success:!0,events:i.events,shipsSunk:i.shipsSunk||[]}}executeAIAction(e,n){const{r:s,c:i,weapon:l}=e,o=this.registry.get(l);if(!o)return{success:!1,events:[],shipsSunk:[],reason:"Ê≠¶Âô®‰∏çÂ≠òÂú®"};if(!o.canUse(n))return console.warn(`[AI] Ê≠¶Âô® ${l} ‰∏çÂèØÁî®ÔºåË∑≥ËøáÊîªÂáª`),{success:!1,events:[],shipsSunk:[],reason:"Ê≠¶Âô®‰∏çÂèØÁî®"};if(!o.isValidTarget({r:s,c:i},n))return console.warn(`[AI] ÁõÆÊ†á (${s},${i}) Êó†ÊïàÔºåË∑≥ËøáÊîªÂáª`),{success:!1,events:[],shipsSunk:[],reason:"ÁõÆÊ†áÊó†Êïà"};const r=o.resolve({r:s,c:i},n);return this._injectGrid(r.events,"PLAYER","last-enemy-attack"),this.renderer.render(r.events),{success:!0,events:r.events,shipsSunk:r.shipsSunk||[]}}_injectGrid(e,n,s=null){for(const i of e)i.payload&&(i.payload.grid=n,s&&i.type===B.CELL_UPDATE&&(i.payload.markClass=s))}}class Tt{constructor(e={}){this.logFn=e.logFn||((n,s)=>console.log(`[${s}] ${n}`)),this.onShipSunk=e.onShipSunk||(()=>{})}render(e){if(!(!e||!Array.isArray(e)))for(const n of e)this._renderOne(n)}_renderOne(e){switch(e.type){case B.CELL_UPDATE:this._renderCellUpdate(e.payload);break;case B.SHIP_UPDATE:this._renderShipUpdate(e.payload);break;case B.LOG:this._renderLog(e.payload);break;case B.EFFECT:this._renderEffect(e.payload);break}}_renderCellUpdate(e){const{grid:n,r:s,c:i,state:l,markClass:o}=e,r=n==="PLAYER"?"player-grid":"enemy-grid",c=document.querySelector(`#${r} .cell[data-r="${s}"][data-c="${i}"]`);if(c){switch(c.classList.remove("hit","destroyed","miss"),l){case"HIT":c.classList.remove("detect","ai-detect"),c.classList.add("hit");break;case"DESTROYED":c.classList.remove("detect","ai-detect"),c.classList.add("destroyed");break;case"MISS":c.classList.remove("detect","ai-detect"),c.classList.add("miss");break;case"SUSPECT":!c.classList.contains("hit")&&!c.classList.contains("destroyed")&&!c.classList.contains("miss")&&c.classList.add(n==="PLAYER"?"ai-detect":"detect");break}o&&c.classList.add(o)}}_renderShipUpdate(e){const{grid:n,shipId:s,sunk:i}=e;i&&this.onShipSunk(s,n)}_renderLog(e){const{message:n,className:s}=e;this.logFn(n,s)}_renderEffect(e){}}function R(){const t=document.querySelector(".cell");let e=t?t.getBoundingClientRect().width:0;if(!e||e===0)if(window.innerWidth<=768){const n=window.innerWidth*.085;e=Math.max(26,Math.min(n,34))}else e=tt;return e}function ce(){return window.innerWidth<=le.MOBILE_BREAKPOINT?le.MOBILE:le.DESKTOP}function ae(t){let e="";return t==="BB"?e=`
                <div class="hull-scale-wrapper" data-original-width="240">
                    <div class="hull-bb">
                        <div class="turret-base facing-left" style="left: 25px;"><div class="turret-bb"></div></div>
                        <div class="turret-base facing-left" style="left: 52px; z-index: 11;"><div class="turret-bb"></div></div>
                        <div class="bb-bridge-complex">
                            <div class="bb-tower"></div>
                            <div class="bb-funnel"></div>
                        </div>
                        <div class="turret-base facing-right" style="right: 60px; z-index: 11;"><div class="turret-bb"></div></div>
                        <div class="bb-stern-equipment">
                            <div class="bb-catapult-rail"></div>
                            <div class="bb-floatplane"></div>
                            <div class="bb-crane"></div>
                        </div>
                    </div>
                </div>`:t==="CV"?e=`
                <div class="hull-scale-wrapper" data-original-width="240">
                    <div class="hull-cv">
                        <div class="cv-arrow"></div>
                        <div class="cv-elevator"></div>
                        <div class="cv-island"></div>
                        <div class="cv-sponson"></div>
                    </div>
                </div>`:t==="CL"?e=`
                <div class="hull-scale-wrapper" data-original-width="170">
                    <div class="hull-cl">
                        <div class="turret-base facing-left" style="left: 15px;"><div class="turret-cl"></div></div>
                        <div class="turret-base facing-left" style="left: 35px; z-index:11"><div class="turret-cl"></div></div>
                        <div class="cl-bridge-area">
                            <div class="cl-block"></div>
                            <div class="cl-funnel" style="left: 25px;"></div>
                            <div class="cl-funnel" style="left: 45px;"></div>
                        </div>
                        <div class="turret-base facing-right" style="right: 35px; z-index:11"><div class="turret-cl"></div></div>
                        <div class="turret-base facing-right" style="right: 15px;"><div class="turret-cl"></div></div>
                    </div>
                </div>`:t==="DD"?e=`
                <div class="hull-scale-wrapper" data-original-width="120">
                    <div class="hull-dd">
                        <div class="turret-base facing-left" style="left: 10px;"><div class="turret-dd"></div></div>
                        <div class="turret-base facing-left" style="left: 24px; z-index:11"><div class="turret-dd"></div></div>
                        <div class="dd-mid">
                            <div class="dd-structure" style="left: 0px;"></div>
                            <div class="dd-torpedo" style="left: 12px;"></div>
                            <div class="dd-structure" style="left: 28px;"></div>
                            <div class="dd-torpedo" style="left: 40px;"></div>
                        </div>
                        <div class="turret-base facing-right" style="right: 10px;"><div class="turret-dd"></div></div>
                    </div>
                </div>`:t==="SS"&&(e=`
                <div class="hull-scale-wrapper" data-original-width="60">
                    <div class="hull-ss">
                        <div class="ss-tower">
                            <div class="ss-periscope"></div>
                        </div>
                    </div>
                </div>`),e}let E="SETUP",g=[],T=[],te=ne(),F=[],M="horizontal",O="AP",K="PLAYER",P=!1,X=null,W=null,$=null,ke=null,w=null;function Bt(){Ye(),L("player"),_t(),Mt(),xt(),document.addEventListener("mouseup",Ve),document.addEventListener("mousemove",We),document.addEventListener("touchend",Rt,{passive:!1}),document.addEventListener("touchmove",Yt,{passive:!1}),window.addEventListener("resize",()=>{g.forEach(t=>U(t)),document.querySelectorAll(".revealed-enemy-ship").forEach(t=>{const e=parseInt(t.dataset.id),n=T.find(s=>s.id===e);n&&Jt(t,n)})}),nn(),Xe(Ke,{silent:!0}),L("player")}function xt(){ke=new Tt({logFn:Y,onShipSunk:(t,e)=>{if(e==="ENEMY"){const n=T.find(s=>s.id===t);n&&Qe(n)}}}),$=new kt,$.register(new Ne),$.register(new _e),$.register(new Ge),w=new wt($,ke)}function Ct(){return{attackerShips:g.map(t=>new Pe(t)),defenderGrid:F,defenderShips:T,isPlayer:!0}}function Dt(){return{attackerShips:T.map(t=>new Pe(t)),defenderGrid:Pt(),defenderShips:g,isPlayer:!1}}function Pt(){const t=[];for(let e=0;e<m;e++){t[e]=[];for(let n=0;n<m;n++){let s=-1,i=-1;for(const r of g){const c=[];for(let u=0;u<r.len;u++)c.push(r.vertical?{r:r.r+u,c:r.c,idx:u}:{r:r.r,c:r.c+u,idx:u});const a=c.find(u=>u.r===e&&u.c===n);if(a){s=r.id,i=a.idx;break}}const l=document.querySelector(`#player-grid .cell[data-r="${e}"][data-c="${n}"]`),o=l&&(l.classList.contains("hit")||l.classList.contains("destroyed")||l.classList.contains("miss"));t[e][n]={hit:o,shipId:s,segmentIndex:i}}}return t}function ne(){return Array(m).fill(0).map(()=>Array(m).fill(0))}function Ye(){const t=document.getElementById("player-grid"),e=document.getElementById("enemy-grid");t.innerHTML="",e.innerHTML="";for(let n=0;n<m;n++)for(let s=0;s<m;s++){let i=document.createElement("div");i.className="cell",i.dataset.r=n,i.dataset.c=s,t.appendChild(i);let l=document.createElement("div");l.className="cell",l.dataset.r=n,l.dataset.c=s,l.onclick=()=>Kt(n,s),l.onmouseenter=()=>Nt(n,s),l.onmouseleave=()=>Re(),e.appendChild(l)}}function Mt(){const t=document.getElementById("help-btn");t&&(localStorage.getItem("hasClickedHelp")||t.classList.add("pulse-highlight"),t.addEventListener("click",y=>{y.stopPropagation(),t.classList.remove("pulse-highlight"),localStorage.setItem("hasClickedHelp","true"),z()}));const e=document.getElementById("btn-menu-toggle"),n=document.getElementById("settings-modal");e&&n&&e.addEventListener("click",()=>{n.style.display="block"});const s=document.getElementById("help-modal");if(s){s.addEventListener("click",S=>{S.target===s&&(S.stopPropagation(),z())});const y=s.querySelector(".close-btn");y&&y.addEventListener("click",S=>{S.stopPropagation(),z()})}document.querySelectorAll("[data-weapon]").forEach(y=>{y.addEventListener("click",()=>{Q(y.dataset.weapon),window.innerWidth<=768&&document.getElementById("weapon-bar").classList.remove("show")})}),document.querySelectorAll("[data-difficulty]").forEach(y=>{y.addEventListener("click",()=>Xe(y.dataset.difficulty))});const i=document.getElementById("rotate-toggle");i&&i.addEventListener("click",Gt);const l=document.getElementById("first-turn-toggle");l&&l.addEventListener("click",we),document.querySelectorAll("[data-panel-toggle]").forEach(y=>{y.addEventListener("click",()=>tn(y.dataset.panelToggle))});const o=document.getElementById("btn-debug");o&&o.addEventListener("click",Te);const r=document.getElementById("btn-reset");r&&r.addEventListener("click",V);const c=document.getElementById("btn-random");c&&c.addEventListener("click",Be);const a=document.getElementById("start-btn");a&&a.addEventListener("click",xe);const u=document.querySelector('[data-action="view-battlefield"]');u&&u.addEventListener("click",Qt);const d=document.querySelector('[data-action="restart-game"]');d&&d.addEventListener("click",en);const f=document.getElementById("btn-settings");if(f&&n){f.addEventListener("click",()=>{n.style.display="block"}),n.addEventListener("click",et=>{et.target===n&&(n.style.display="none")});const y=n.querySelector(".close-btn");y&&y.addEventListener("click",()=>n.style.display="none");const S=document.getElementById("mobile-first-turn");S&&S.addEventListener("click",we);const ge=document.getElementById("mobile-debug");ge&&ge.addEventListener("click",Te);const ye=document.getElementById("mobile-reset");ye&&ye.addEventListener("click",()=>{V(),n.style.display="none"});const ve=document.getElementById("mobile-menu-restart");ve&&ve.addEventListener("click",()=>{E==="PLAYING"||E==="END"?confirm("Á°ÆÂÆöË¶ÅÈáçÊñ∞ÂºÄÂßãÂêóÔºü")&&(J(),n.style.display="none"):(J(),n.style.display="none")});const Ee=document.getElementById("mobile-menu-random");Ee&&Ee.addEventListener("click",()=>{Be(),n.style.display="none"});const be=document.getElementById("mobile-menu-reset");be&&be.addEventListener("click",()=>{V(),n.style.display="none"});const Se=document.getElementById("mobile-menu-help");Se&&Se.addEventListener("click",()=>{n.style.display="none",z()})}const p=document.getElementById("tab-view-player"),v=document.getElementById("tab-view-enemy");p&&p.addEventListener("click",()=>L("player")),v&&v.addEventListener("click",()=>L("enemy"));const b=document.getElementById("mb-tab-player"),A=document.getElementById("mb-tab-enemy");b&&b.addEventListener("click",()=>L("player")),A&&A.addEventListener("click",()=>L("enemy"));const N=document.getElementById("mb-btn-start");N&&N.addEventListener("click",xe);const _=document.getElementById("mb-btn-weapon");_&&_.addEventListener("click",()=>{document.getElementById("weapon-bar").classList.toggle("show")})}function L(t){const e=document.getElementById("player-board-box"),n=document.getElementById("enemy-board-box"),s=document.getElementById("tab-view-player"),i=document.getElementById("tab-view-enemy"),l=document.getElementById("mb-tab-player"),o=document.getElementById("mb-tab-enemy");e.classList.remove("active-view"),n.classList.remove("active-view"),s&&s.classList.remove("active"),i&&i.classList.remove("active"),l&&l.classList.remove("active"),o&&o.classList.remove("active"),t==="player"?(e.classList.add("active-view"),s&&s.classList.add("active"),l&&l.classList.add("active")):(n.classList.add("active-view"),i&&i.classList.add("active"),o&&o.classList.add("active"))}function Nt(t,e){if(E==="PLAYING"&&document.getElementById("enemy-grid").style.pointerEvents!=="none"&&(Re(),w)){w.setCurrentWeapon(O);const n=w.getPreviewArea({r:t,c:e}),s=document.getElementById("enemy-grid");n.cells.forEach(i=>{if(i.r>=0&&i.r<m&&i.c>=0&&i.c<m){const l=s.querySelector(`.cell[data-r="${i.r}"][data-c="${i.c}"]`);l&&l.classList.add("attack-range-highlight")}})}}function Re(){document.getElementById("enemy-grid").querySelectorAll(".attack-range-highlight").forEach(e=>{e.classList.remove("attack-range-highlight")})}function _t(){const t=document.getElementById("dock");g=[],t.innerHTML="",ee.forEach((e,n)=>{const s=document.createElement("div");s.className="ship ship-visuals-root",s.title=`${e.name} (ÈïøÂ∫¶:${e.len})`,s.style.position="relative";const i=document.createElement("div");i.className="ship-inner",i.innerHTML=ae(e.code),s.appendChild(i);const l={id:n,name:e.name,len:e.len,maxHp:e.maxHp,code:e.code,hp:Array(e.len).fill(e.maxHp),el:s,inDock:!0,vertical:!1,r:-1,c:-1,sunk:!1};U(l),s.onclick=o=>{se||E==="SETUP"&&!l.inDock&&$t(l)},s.onmousedown=o=>$e(o,l),s.ontouchstart=o=>Ot(o,l),t.appendChild(s),g.push(l)})}function de(t,e,n){const s=t.querySelector(".hull-scale-wrapper");if(!s)return;const i=parseFloat(s.dataset.originalWidth);if(!i)return;const o=e*n/i*.95;s.style.transform=`scale(${o})`}function U(t,e=!1){const n=R(),s=t.len*n+"px",i=n+"px";t.el.style.setProperty("--w",s),t.el.style.setProperty("--h",i),de(t.el,t.len,n),t.vertical&&(!t.inDock||e)?(t.el.classList.add("vertical"),t.el.style.width=n+"px",t.el.style.height=s):(t.el.classList.remove("vertical"),t.el.style.width=s,t.el.style.height=n+"px"),!t.inDock&&!e&&(t.el.style.left=t.c*n+"px",t.el.style.top=t.r*n+"px")}function Gt(){M=M==="horizontal"?"vertical":"horizontal";const t=document.getElementById("rotate-toggle");t.innerText=M==="horizontal"?"ÈÉ®ÁΩ≤ÊñπÂêë:Ê∞¥Âπ≥‚Æï":"ÈÉ®ÁΩ≤ÊñπÂêë:ÂûÇÁõ¥‚¨á",g.forEach(e=>{e.inDock&&(e.vertical=M==="vertical")})}function we(){K=K==="PLAYER"?"AI":"PLAYER";const t=K==="PLAYER"?"ÂÖàÊâãÔºöÁé©ÂÆ∂ üë§":"ÂÖàÊâãÔºöÁîµËÑë ü§ñ",e=document.getElementById("first-turn-toggle");e&&(e.innerText=t);const n=document.getElementById("mobile-first-turn");n&&(n.innerText=t)}function Te(){P=!P;const t=P?"üß† AI ËßÜËßí: ÂºÄÂêØ":"üß† AI ËßÜËßí: ÂÖ≥Èó≠",e=P?"#ed8936":"",n=document.getElementById("btn-debug");n&&(n.innerText=t,n.style.background=e);const s=document.getElementById("mobile-debug");s&&(s.innerText=t,s.style.background=e),P?Ue():Ht()}function Ue(t=null){if(!P)return;const e=Ze(),n=g.filter(l=>!l.sunk),s=t||(n.length>0?gt(e,n,he):Array(m).fill(0).map(()=>Array(m).fill(0))),i=document.getElementById("player-grid");for(let l=0;l<m;l++)for(let o=0;o<m;o++){const r=i.querySelector(`.cell[data-r="${l}"][data-c="${o}"]`),c=s[l][o]||0;r.classList.remove("debug-heat"),r.removeAttribute("data-heat"),r.style.removeProperty("--heat-bg");const a=Math.min(1,Math.max(0,c));if(a>0){r.setAttribute("data-heat",`${(a*100).toFixed(1)}%`),r.classList.add("debug-heat");const u=.1+a*.6,d=Math.floor(255*a),f=Math.floor(255*(1-a));r.style.setProperty("--heat-bg",`rgba(${d}, 0, ${f}, ${u})`)}}}function Ht(){document.getElementById("player-grid").querySelectorAll(".debug-heat").forEach(e=>{e.classList.remove("debug-heat"),e.removeAttribute("data-heat"),e.style.removeProperty("--heat-bg")})}let C=null,I={x:0,y:0},se=!1,k=null;function ue(t){return t.touches&&t.touches.length>0?{x:t.touches[0].clientX,y:t.touches[0].clientY}:t.changedTouches&&t.changedTouches.length>0?{x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY}:{x:t.clientX,y:t.clientY}}function Ot(t,e){if(t.touches.length>1)return;t.cancelable&&t.preventDefault();const n=ue(t),s={button:0,preventDefault:()=>{},clientX:n.x,clientY:n.y,target:t.target};$e(s,e)}function $e(t,e){if(E!=="SETUP"||t.button!==0)return;t.preventDefault(),C=e,se=!1,k=null;const n=e.el.getBoundingClientRect();let s=t.clientX-n.left,i=t.clientY-n.top;e.el.classList.add("dragging");const l=e.inDock&&M==="vertical";e.inDock&&(e.vertical=M==="vertical"),U(e,!0),l?(I.x=i,I.y=s):(I.x=s,I.y=i),e.el.style.left=t.clientX-I.x+"px",e.el.style.top=t.clientY-I.y+"px",document.body.appendChild(e.el),e.inDock||Fe(e)}function Yt(t){if(!C)return;t.cancelable&&t.preventDefault();const e=ue(t),n={clientX:e.x,clientY:e.y};We(n)}function We(t){if(!C)return;se=!0;const e=C;e.el.style.left=t.clientX-I.x+"px",e.el.style.top=t.clientY-I.y+"px",qe();const n=document.elementFromPoint(t.clientX,t.clientY);if(!n){k=null;return}const s=n.closest(".cell"),i=document.getElementById("player-grid"),l=R();if(s&&i.contains(s)){const o=i.getBoundingClientRect(),r=t.clientX-I.x,c=t.clientY-I.y,a=r-o.left+l/2,u=c-o.top+l/2,d=Math.floor(a/l),f=Math.floor(u/l);Ut(e,f,d)}else k=null}function Rt(t){if(!C)return;const e=ue(t),n={clientX:e.x,clientY:e.y};Ve(n)}function Ve(t){if(!C)return;const e=C;e.el.classList.remove("dragging");const s=document.getElementById("player-grid").getBoundingClientRect(),i=R(),l=t.clientX>=s.left&&t.clientX<=s.right&&t.clientY>=s.top&&t.clientY<=s.bottom,o=k&&k.shipId===e.id?k:null;qe(),k=null;let r=!1;if(o&&Z(o.r,o.c,e.len,o.vertical))j(e,o.r,o.c,o.vertical),r=!0;else if(l){const c=t.clientX-I.x,a=t.clientY-I.y,u=c-s.left+i/2,d=a-s.top+i/2,f=Math.floor(u/i),p=Math.floor(d/i);Z(p,f,e.len,e.vertical)&&(j(e,p,f,e.vertical),r=!0)}r||(ze(e),l&&Y("Êó†Êïà‰ΩçÁΩÆÔºöÈáçÂè†ÊàñË∂äÁïå","c-warn")),C=null,setTimeout(()=>se=!1,50),me()}function Ut(t,e,n){const s=t.len,i=t.vertical,l=Z(e,n,s,i),o=l?"highlight-valid":"highlight-invalid";let r=!1;for(let c=0;c<s;c++){const a=i?e+c:e,u=i?n:n+c,d=document.querySelector(`#player-grid .cell[data-r="${a}"][data-c="${u}"]`);d&&(d.classList.add(o),r=!0)}l&&r?k={shipId:t.id,r:e,c:n,vertical:i}:k=null}function qe(){document.querySelectorAll(".highlight-valid, .highlight-invalid").forEach(t=>{t.classList.remove("highlight-valid"),t.classList.remove("highlight-invalid")})}function j(t,e,n,s){const i=document.getElementById("player-grid"),l=R();t.inDock=!1,t.r=e,t.c=n,t.vertical=s,t.el.style.transition="none",t.el.style.position="absolute",t.el.style.margin="0",i.appendChild(t.el),U(t),t.el.style.left=n*l+"px",t.el.style.top=e*l+"px",t.el.offsetWidth,t.el.style.transition="",fe(t,1)}function ze(t){const e=document.getElementById("dock");t.el.style.transition="none",t.inDock=!0,t.r=-1,t.c=-1,t.sunk=!1,t.hp=Array(t.len).fill(t.maxHp),t.el.classList.remove("sunk"),t.vertical=M==="vertical",t.el.style.position="relative",t.el.style.left="auto",t.el.style.top="auto",t.el.style.margin="0",U(t),e.appendChild(t.el),t.el.offsetWidth,t.el.style.transition=""}function $t(t){const e=!t.vertical;Fe(t),Z(t.r,t.c,t.len,e)?j(t,t.r,t.c,e):(fe(t,1),Wt(t.el),Y("ÊóãËΩ¨Á©∫Èó¥‰∏çË∂≥","c-warn"))}function Wt(t){t.classList.remove("shake"),t.offsetWidth,t.classList.add("shake")}function Z(t,e,n,s,i){if(t<0||e<0)return!1;if(s){if(t+n>m||e>=m)return!1}else if(e+n>m||t>=m)return!1;for(let l=0;l<n;l++){let o=s?t+l:t,r=s?e:e+l;if(te[o][r]===1)return!1}return!0}function fe(t,e){for(let n=0;n<t.len;n++){let s=t.vertical?t.r+n:t.r,i=t.vertical?t.c:t.c+n;s<m&&i<m&&(te[s][i]=e)}}function Fe(t){fe(t,0)}function V(){te=ne(),g.forEach(t=>ze(t)),me()}function Be(){V(),setTimeout(()=>{Oe(ee,m).forEach(e=>{const n=g.find(s=>s.code===e.code);n&&j(n,e.r,e.c,e.v)}),me()},50)}function me(){const t=g.every(s=>!s.inDock),e=document.getElementById("start-btn"),n=document.getElementById("mb-btn-start");E==="SETUP"&&(e.disabled=!t,n&&(n.disabled=!t),t?e.className="btn-orange":e.disabled=!0)}function xe(){document.getElementById("start-btn"),E==="PLAYING"||E==="END"?confirm("Á°ÆÂÆöË¶ÅÁªìÊùüÂΩìÂâçÊàòÊñóÂπ∂ÈáçÊñ∞ÂºÄÂßãÂêóÔºü")&&J():Vt()}function J(){document.body.classList.remove("game-playing"),ie(),X=null,E="SETUP",document.getElementById("dock").style.display="flex",document.getElementById("battle-panel").style.display="none";const t=document.getElementById("mb-deploy-group"),e=document.getElementById("mb-combat-group");t&&(t.style.display="flex"),e&&(e.style.display="none"),document.getElementById("dock").style.pointerEvents="auto",document.getElementById("dock").style.opacity=1,["rotate-toggle","first-turn-toggle","btn-debug","btn-reset","btn-random","mobile-first-turn","mobile-debug","mobile-reset","mobile-menu-random","mobile-menu-reset"].forEach(l=>{const o=document.getElementById(l);o&&(o.disabled=!1)});const s=document.getElementById("start-btn");s.innerText="üöÄ ÂºÄÂßãÊàòÊñó",s.className="btn-orange",s.disabled=!0;const i=document.getElementById("mb-btn-start");i&&(i.disabled=!0),Ye(),document.getElementById("enemy-grid").style.pointerEvents="none",te=ne(),V(),document.getElementById("log").innerHTML='<div class="log-line c-sys">Ê∏∏ÊàèÂ∑≤ÈáçÁΩÆ„ÄÇ</div>',L("player")}function Vt(){document.body.classList.add("game-playing"),ie(),X=null,E="PLAYING",document.getElementById("dock").style.display="none",document.getElementById("battle-panel").style.display="flex";const t=document.getElementById("mb-deploy-group"),e=document.getElementById("mb-combat-group");t&&(t.style.display="none"),e&&(e.style.display="flex"),["rotate-toggle","first-turn-toggle","btn-reset","btn-random","mobile-first-turn","mobile-reset","mobile-menu-random","mobile-menu-reset"].forEach(i=>{const l=document.getElementById(i);l&&(l.disabled=!0)}),g.forEach(i=>i.el.style.cursor="default");const s=document.getElementById("start-btn");s.innerText="üîÑ ÈáçÊñ∞ÂºÄÂßã",s.className="btn-restart",ct(),qt(),pe(),Q("AP"),K==="PLAYER"?(Y("ÊàòÊñóÂºÄÂßãÔºÅÁé©ÂÆ∂ÂÖàÊâãÔºåÁÇπÂáªÊïåÊñπÊµ∑ÂüüÂºÄÁÅ´„ÄÇ","c-warn"),document.getElementById("enemy-grid").style.pointerEvents="auto",L("enemy")):(Y("ÊàòÊñóÂºÄÂßãÔºÅÁîµËÑëÂÖàÊâã„ÄÇ","c-warn"),document.getElementById("enemy-grid").style.pointerEvents="none",L("player"),je(ce().AI_ACTION_DELAY))}function qt(){const t=document.getElementById("enemy-grid");t.querySelectorAll(".wreck").forEach(n=>n.remove()),t.querySelectorAll(".revealed-enemy-ship").forEach(n=>n.remove()),t.querySelectorAll(".cell").forEach(n=>{for(n.className="cell";n.firstChild;)n.removeChild(n.firstChild)});const e=Oe(ee,m);T=[],F=ne().map(n=>n.map(s=>({hit:!1,shipId:-1,segmentIndex:-1}))),e.forEach((n,s)=>{const{r:i,c:l,v:o,len:r,name:c,maxHp:a,code:u}=n;for(let d=0;d<r;d++){const f=o?i+d:i,p=o?l:l+d;F[f][p].shipId=s,F[f][p].segmentIndex=d}T.push({id:s,name:c,len:r,maxHp:a,code:u,hp:Array(r).fill(a),sunk:!1,r:i,c:l,v:o})})}function Q(t){O=t,document.querySelectorAll(".weapon-btn").forEach(i=>i.classList.remove("active"));const e=t==="AP"?"btn-ap":t==="HE"?"btn-he":"btn-sonar";document.getElementById(e).classList.add("active");const n=document.getElementById("mb-weapon-name"),s=document.getElementById("mb-weapon-icon");n&&s&&(t==="AP"?(n.innerText="‰∏ªÁÇÆ",s.innerText="üí•"):t==="HE"?(n.innerText="Á©∫Ë¢≠",s.innerText="‚úàÔ∏è"):t==="SONAR"&&(n.innerText="Ê∞¥Âê¨",s.innerText="üì°"))}function zt(){const t=g.some(o=>o.code==="CV"&&!o.sunk);g.some(o=>o.code==="CL"&&!o.sunk);const e=g.some(o=>o.code==="DD"&&!o.sunk),n=t,s=e;document.getElementById("btn-he").disabled=!n,document.getElementById("btn-sonar").disabled=!s,O==="HE"&&!n&&Q("AP"),O==="SONAR"&&!s&&Q("AP");const i=Ft(),l=document.getElementById("ap-desc");l&&(l.innerText=`ÂçïÁÇπ ${i}‰º§`)}function Ft(){const t=g.some(s=>s.code==="BB"&&!s.sunk),e=g.some(s=>s.code==="SS"&&!s.sunk),n=g.some(s=>s.code==="CL"&&!s.sunk);return t||e?3:n?2:1}function pe(){const t=document.getElementById("ship-status-list");t.innerHTML="",g.forEach(e=>{const n=document.createElement("div");n.className="ship-status-row";const s=document.createElement("span");s.innerText=e.name,e.sunk&&(s.style.textDecoration="line-through",s.style.color="#fc8181");const i=document.createElement("div");i.className="hp-blocks",e.hp.forEach(l=>{const o=document.createElement("div");o.className="hp-block",l<=0?o.classList.add("lost"):l<e.maxHp&&o.classList.add("dmg"),i.appendChild(o)}),n.appendChild(s),n.appendChild(i),t.appendChild(n)}),zt()}function Kt(t,e){if(E==="PLAYING"&&document.getElementById("enemy-grid").style.pointerEvents!=="none"){if(w){w.setCurrentWeapon(O);const n=Ct(),s=w.executePlayerAction({r:t,c:e},n);if(!s.success)return;O!=="SONAR"&&s.shipsSunk&&s.shipsSunk.length>0&&Je("Áé©ÂÆ∂")}if(pe(),document.getElementById("enemy-grid").style.pointerEvents="none",E==="PLAYING"){const n=ce();n.VIEW_SWITCH_DELAY>0&&setTimeout(()=>{E==="PLAYING"&&L("player")},n.VIEW_SWITCH_DELAY),je(n.AI_ACTION_DELAY)}}}let he={...Ce[De]},Ke=De;function Xe(t,e={}){const{silent:n=!1}=e;Ke=t,he={...Ce[t]},document.querySelectorAll(".diff-btn").forEach(s=>{s.dataset.difficulty===t?s.classList.add("active"):s.classList.remove("active")}),n||Y(`AI ÈöæÂ∫¶Â∑≤Ë∞ÉÊï¥‰∏∫: ${t==="EASY"?"Êñ∞ÂÖµ (ÁÆÄÂçï)":t==="NORMAL"?"Ëà∞Èïø (Âõ∞Èöæ)":"ÊèêÁù£ (ÂÜ∑ÈÖ∑)"}`,"c-sys")}function ie(){W!==null&&(clearTimeout(W),W=null)}function je(t){ie(),W=setTimeout(()=>{W=null,jt()},t)}function Xt(){document.getElementById("player-grid").querySelectorAll(".last-enemy-attack").forEach(e=>{e.classList.remove("last-enemy-attack")})}function jt(){if(E!=="PLAYING")return;Xt();const e={viewGrid:Ze(),myShips:g,enemyShips:T,difficultyConfig:he},n=dt(e);if(w){const i=Dt(),l=w.executeAIAction(n,i);if(n.weapon!=="SONAR"&&l.shipsSunk&&l.shipsSunk.length>0){for(const o of l.shipsSunk){const r=g.find(c=>c.id===o);r&&r.el&&r.el.classList.add("sunk")}Je("ÁîµËÑë")}}pe(),P&&Ue();const s=document.getElementById("enemy-grid");if(E==="PLAYING"){s.style.pointerEvents="auto";const i=ce();i.TURN_BACK_DELAY>0&&setTimeout(()=>{E==="PLAYING"&&L("enemy")},i.TURN_BACK_DELAY)}else s.style.pointerEvents="none"}function Ze(){let t=Array(10).fill(0).map(()=>Array(10).fill(0));return document.querySelectorAll("#player-grid .cell").forEach(e=>{const n=parseInt(e.dataset.r),s=parseInt(e.dataset.c);e.classList.contains("destroyed")?t[n][s]=3:e.classList.contains("hit")?t[n][s]=2:e.classList.contains("miss")?t[n][s]=1:e.classList.contains("ai-detect")&&(t[n][s]=4)}),g.forEach(e=>{if(e.sunk)for(let n=0;n<e.len;n++){let s=e.vertical?e.r+n:e.r,i=e.vertical?e.c:e.c+n;s>=0&&s<10&&i>=0&&i<10&&(t[s][i]=5)}}),t}function Je(t){if(X)return;const e=g.every(r=>r.sunk),n=T.every(r=>r.sunk);if(!(e||n))return;X=t,E="END",ie();const s=document.getElementById("enemy-grid");s&&(s.style.pointerEvents="none"),Zt();const i=document.getElementById("game-over-modal"),l=document.getElementById("game-over-title"),o=document.getElementById("game-over-msg");t==="Áé©ÂÆ∂"?(l.innerText="VICTORY",l.className="game-over-title win-text",o.innerText="ÊÅ≠ÂñúÊåáÊå•ÂÆòÔºÅÊïåÊñπËà∞ÈòüÂ∑≤Ë¢´ÂÖ®Ê≠ºÔºÅ"):(l.innerText="DEFEAT",l.className="game-over-title lose-text",o.innerText="ÂæàÈÅóÊÜæÔºåÊàëÊñπËà∞ÈòüÂ∑≤ÂÖ®ÂÜõË¶ÜÊ≤°..."),setTimeout(()=>{i.style.display="block"},500)}function Zt(){T.forEach(t=>{Qe(t)})}function Qe(t){const e=document.getElementById("enemy-grid"),n=R();if(e.querySelector(`.revealed-enemy-ship[data-id="${t.id}"]`))return;const s=document.createElement("div");s.className="ship revealed-enemy-ship ship-visuals-root",s.dataset.id=t.id,s.style.position="absolute",s.style.left=t.c*n+"px",s.style.top=t.r*n+"px",s.style.pointerEvents="none";const i=document.createElement("div");i.className="ship-inner",i.innerHTML=ae(t.code),s.appendChild(i);const l=t.len*n+"px",o=n+"px";s.style.setProperty("--w",l),s.style.setProperty("--h",o),t.v?(s.classList.add("vertical"),s.style.width=n+"px",s.style.height=l):(s.style.width=l,s.style.height=n+"px"),t.sunk?s.classList.add("sunk"):(s.style.opacity="0.9",s.style.filter="drop-shadow(0 0 5px white)"),de(s,t.len,n),e.appendChild(s)}function Jt(t,e){const n=R(),s=e.len*n+"px",i=n+"px";t.style.left=e.c*n+"px",t.style.top=e.r*n+"px",t.style.setProperty("--w",s),t.style.setProperty("--h",i),de(t,e.len,n),e.v?(t.style.width=n+"px",t.style.height=s):(t.style.width=s,t.style.height=n+"px")}function Qt(){document.getElementById("game-over-modal").style.display="none"}function en(){document.getElementById("game-over-modal").style.display="none",J()}function Y(t,e){const n=document.getElementById("log"),s=document.createElement("div");s.className=`log-line ${e}`,s.innerHTML=`[${new Date().toLocaleTimeString().split(" ")[0]}] ${t}`,n.prepend(s)}function z(){const t=document.getElementById("help-modal");requestAnimationFrame(()=>{t.style.display=t.style.display==="block"?"none":"block"})}function tn(t){const e=t==="left",n=document.querySelector(e?".dock-panel":".log-panel"),s=document.querySelector(e?".toggle-left":".toggle-right");n.classList.toggle("panel-collapsed");const i=n.classList.contains("panel-collapsed");e?s.innerText=i?"‚ñ∂":"‚óÄ":s.innerText=i?"‚óÄ":"‚ñ∂"}function nn(){const t=document.getElementById("rules-ship-table-body");t&&(t.innerHTML="",ee.forEach(e=>{const n=document.createElement("tr"),s=document.createElement("td"),i=document.createElement("div");i.className="ship-preview";const l=document.createElement("div");l.className="ship ship-visuals-root";const o=document.createElement("div");o.className="ship-inner",o.innerHTML=ae(e.code),l.appendChild(o),U({len:e.len,el:l,vertical:!1,inDock:!1});const r=l.querySelector(".hull-scale-wrapper");r&&(r.style.transform="scale(0.4)"),i.appendChild(l),s.appendChild(i),n.appendChild(s);const c=document.createElement("td");c.innerText=e.code,n.appendChild(c);const a=document.createElement("td");a.innerText=e.name,n.appendChild(a);const u=document.createElement("td");u.innerText=e.len,n.appendChild(u);const d=document.createElement("td");d.innerText=e.maxHp,n.appendChild(d);const f=document.createElement("td");e.code==="CV"?f.innerHTML="Ëß£ÈîÅ <b>Á©∫Ë¢≠</b>":e.code==="DD"?f.innerHTML="Ëß£ÈîÅ <b>Ê∞¥Âê¨</b>":e.code==="BB"||e.code==="SS"?f.innerHTML="‰∏ªÁÇÆ‰º§ÂÆ≥ 3":e.code==="CL"?f.innerHTML="‰∏ªÁÇÆ‰º§ÂÆ≥ 2 (Ëã•BB/SSÊ≤âÊ≤°)":f.innerText="-",n.appendChild(f),t.appendChild(n)}))}window.addEventListener("DOMContentLoaded",()=>{const t=document.querySelector("header h1");t&&(t.textContent=`${nt} (${st})`),Bt()});</script>
  <style rel="stylesheet" crossorigin>:root{--bg-color: #1a202c;--panel-bg: #2d3748;--water: #2b6cb0;--accent: #ed8936;--text: #e2e8f0;--cell-size: 40px}*{box-sizing:border-box}body{font-family:Segoe UI,sans-serif;background-color:var(--bg-color);color:var(--text);margin:0;height:100vh;display:flex;flex-direction:column;-webkit-user-select:none;user-select:none}header{height:50px;background:#171923;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 5px #00000080;z-index:50}h1{margin:0;font-size:1.2rem;color:var(--accent);letter-spacing:2px}.layout{display:flex;flex:1;height:calc(100vh - 50px)}.center-area{flex:1;display:flex;flex-direction:column;background:radial-gradient(#2c3e50 1px,transparent 1px);background-size:20px 20px;position:relative;overflow:hidden}.scroll-view{flex:1;overflow:auto;width:100%;display:flex;flex-direction:column;position:relative}.dock-panel{width:260px;min-width:260px;background:var(--panel-bg);border-right:1px solid #4a5568;display:flex;flex-direction:column;padding:15px;z-index:30;transition:all .3s cubic-bezier(.4,0,.2,1);overflow:hidden;white-space:nowrap}.dock-header{font-weight:700;color:#90cdf4;margin-bottom:10px;text-align:center;display:flex;align-items:center;justify-content:center;gap:8px}.dock-container{flex:1;background:#0003;border-radius:8px;padding:15px;display:flex;flex-direction:column;align-items:center;gap:15px;position:relative;overflow-y:auto}.battlefield{flex:0 0 auto;margin:auto;display:flex;justify-content:center;align-items:center;gap:40px;min-width:fit-content;padding:20px}.board-box{display:flex;flex-direction:column;align-items:center;flex-shrink:0}.board-title{margin-bottom:8px;font-weight:700}.bottom-controls{height:70px;background:#171923e6;border-top:1px solid #4a5568;display:flex;justify-content:center;align-items:center;gap:15px;padding:0 20px;z-index:40;box-shadow:0 -4px 10px #0000004d}.bottom-controls button{padding:10px 20px;font-size:14px;display:flex;align-items:center;gap:8px;min-width:120px;justify-content:center}@media(max-width:768px){.bottom-controls button{min-width:auto;padding:8px 12px}}.panel-collapsed{width:0!important;min-width:0!important;padding-left:0!important;padding-right:0!important;border:none!important;opacity:0}.toggle-btn{position:absolute;top:50%;transform:translateY(-50%);width:16px;height:40px;background:var(--panel-bg);border:1px solid #4a5568;color:var(--accent);display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:90;transition:all .2s;font-size:10px;box-shadow:0 2px 8px #0000004d;opacity:.8}.toggle-btn:hover{background:#4a5568;color:#fff;width:20px;opacity:1}.toggle-left{left:0;border-left:none;border-radius:0 12px 12px 0}.toggle-right{right:0;border-right:none;border-radius:12px 0 0 12px}.grid{display:grid;grid-template-columns:repeat(10,var(--cell-size));grid-template-rows:repeat(10,var(--cell-size));background-color:var(--water);border:4px solid #2c5282;box-shadow:0 10px 20px #0006;position:relative}.cell{width:var(--cell-size);height:var(--cell-size);border:1px solid rgba(255,255,255,.1);box-sizing:border-box;transition:background .1s;position:relative}#enemy-grid .cell{z-index:5}#player-grid .cell{z-index:auto}.cell.highlight-valid{background-color:#48bb78b3!important;box-shadow:inset 0 0 0 2px #fff}.cell.highlight-invalid{background-color:#f56565b3!important;box-shadow:inset 0 0 0 2px red}#enemy-grid .cell:hover:not(.hit):not(.miss):not(.destroyed):not(.detect){background-color:#fff3;cursor:crosshair}.hit{background-color:#ecc94b66!important;position:relative}.hit:after{content:"üí•";position:absolute;inset:0;display:flex;justify-content:center;align-items:center;font-size:18px;z-index:102}.destroyed{background-color:#e53e3e66!important;position:relative}.destroyed:after{content:"‚ò†Ô∏è";position:absolute;inset:0;display:flex;justify-content:center;align-items:center;font-size:18px;z-index:102}.detect{background-color:#ecc94b4d!important;position:relative}.detect:after{content:"‚ùì";position:absolute;inset:0;display:flex;justify-content:center;align-items:center;font-size:18px;z-index:102}.ai-detect{background-color:#ecc94b4d!important;position:relative}.ai-detect:after{content:"‚ùì";position:absolute;inset:0;display:flex;justify-content:center;align-items:center;font-size:18px;z-index:102}.miss{background-color:#ffffff1a!important;position:relative}.miss:after{content:"";position:absolute;width:10px;height:10px;border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%);background:#ffffff80;z-index:102}.attack-range-highlight{box-shadow:inset 0 0 0 2px #fc8181,0 0 10px #fc818180;background-color:#fc818133!important;z-index:60}.last-enemy-attack{background-color:#fc81814d!important;box-shadow:inset 0 0 0 2px #fc8181;z-index:200}.weapon-bar{display:flex;gap:8px;width:100%}.weapon-btn{flex:1;padding:10px 6px;font-size:12px;background:linear-gradient(to bottom,#2d3748,#1a202c);color:#cbd5e0;border:1px solid #4a5568;border-radius:6px;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px;transition:all .2s;box-shadow:0 2px 4px #0003}.weapon-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 8px #0000004d;border-color:#718096}.weapon-btn.active{background:linear-gradient(to bottom,#3182ce,#2b6cb0);color:#fff;border-color:#63b3ed;box-shadow:0 0 12px #4299e180;transform:translateY(-1px)}.weapon-btn:disabled{opacity:.5;cursor:not-allowed;background:#1a202c;filter:grayscale(1);border-color:#2d3748}.status-panel{display:flex;flex-direction:column;gap:8px;width:100%;margin-top:10px}.ship-status-row{display:flex;align-items:center;justify-content:space-between;padding:6px 8px;background:#0003;border-radius:4px;border-bottom:none;font-size:12px;margin-bottom:2px}.hp-blocks{display:flex;gap:4px}.hp-block{width:12px;height:6px;background:#48bb78;border-radius:2px;box-shadow:0 0 4px #48bb7866}.hp-block.dmg{background:#ecc94b;box-shadow:0 0 4px #ecc94b66}.hp-block.lost{background:#e53e3e;box-shadow:none;opacity:.3}.top-hit-marker{position:absolute;z-index:102;pointer-events:none;width:var(--cell-size);height:var(--cell-size);display:flex;justify-content:center;align-items:center;font-size:28px;text-shadow:0 0 5px #000}.log-panel{width:260px;min-width:260px;background:var(--panel-bg);border-left:1px solid #4a5568;display:flex;flex-direction:column;z-index:20;transition:all .3s cubic-bezier(.4,0,.2,1);overflow:hidden;white-space:normal}.log-header{padding:10px;background:#232936;text-align:center;font-weight:700;color:#90cdf4}.log-content{flex:1;overflow-y:auto;padding:10px;font-family:Consolas,monospace;font-size:12px}.log-line{margin-bottom:4px;border-bottom:1px solid #3a4657;padding-bottom:2px}.c-sys{color:#a0aec0}.c-p{color:#68d391}.c-e{color:#fc8181}.c-warn{color:var(--accent);font-weight:700}.ship{position:relative;z-index:100;cursor:grab;display:block;transition:top .1s,left .1s;touch-action:none}.ship:not(.sunk):hover .ship-inner{filter:brightness(1.2) drop-shadow(0 0 5px rgba(255,255,255,.4))}.ship-inner{width:100%;height:100%;pointer-events:none;transform-origin:top left;transition:transform .2s}.ship.dragging{opacity:.7;cursor:grabbing;z-index:9999;position:fixed!important;pointer-events:none!important;transition:none!important;transform:scale(1.05);filter:drop-shadow(5px 5px 10px rgba(0,0,0,.5))}.ship.vertical{width:var(--cell-size)!important}.ship.vertical .ship-inner{width:var(--w)!important;height:var(--h)!important;transform:rotate(90deg) translateY(-100%)}.ship.sunk{filter:grayscale(100%) brightness(.8);border:1px solid red}@keyframes shake{0%,to{transform:translate(0)}25%{transform:translate(-5px)}75%{transform:translate(5px)}}.shake{animation:shake .2s ease-in-out 2}.wreck{position:absolute;border:2px solid #fc8181;background:#0000004d;pointer-events:none;z-index:10}.revealed-enemy-ship{z-index:1!important}.btn-area{margin-top:auto;display:flex;flex-direction:column;gap:8px}button{padding:10px;border:none;border-radius:4px;font-weight:700;cursor:pointer;transition:.2s;font-size:14px}.btn-mode{background:#805ad5;color:#fff;margin-bottom:5px}.btn-mode:hover{background:#6b46c1}.btn-mode:disabled{background:#553c9a;opacity:.5;cursor:not-allowed}.btn-blue{background:#4299e1;color:#fff}.btn-blue:hover{background:#3182ce}.btn-blue:disabled{background:#2c5282;opacity:.5;cursor:not-allowed}.btn-orange{background:var(--accent);color:#1a202c}.btn-orange:hover{background:#dd6b20}.btn-orange:disabled{background:#718096;cursor:not-allowed}.btn-restart{background:#9f7aea;color:#fff}.btn-restart:hover{background:#805ad5}.difficulty-bar{display:flex;gap:5px;margin-bottom:10px}.diff-btn{flex:1;padding:6px;font-size:12px;background:#2d3748;color:#a0aec0;border:1px solid #4a5568;cursor:pointer;transition:all .2s}.diff-btn:hover{background:#4a5568}.diff-btn.active{color:#1a202c;font-weight:700}.diff-btn.active[data-difficulty=EASY]{background:#38a169;border-color:#48bb78;color:#f0fff4;box-shadow:0 0 6px #38a16980}.diff-btn.active[data-difficulty=NORMAL]{background:#ecc94b;border-color:#f6e05e;color:#442a00;box-shadow:0 0 6px #ecc94b99}.diff-btn.active[data-difficulty=HARD]{background:#e53e3e;border-color:#fc8181;color:#fff5f5;box-shadow:0 0 6px #e53e3e99}.cell.debug-heat:before{content:attr(data-heat);position:absolute;inset:0;display:flex;justify-content:center;align-items:center;font-size:12px;font-weight:700;color:#fff;background:var(--heat-bg, rgba(255, 0, 0, .3));z-index:200;pointer-events:none;text-shadow:0 0 2px black}#help-btn{position:fixed;bottom:20px;right:20px;width:auto;height:50px;padding:0 20px;background:var(--accent);color:#1a202c;border-radius:25px;display:flex;justify-content:center;align-items:center;font-size:18px;font-weight:700;cursor:pointer;box-shadow:0 4px 10px #00000080;z-index:1000;transition:transform .2s;gap:8px}#help-btn:hover{transform:scale(1.05)}.modal{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;background-color:#000c;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);animation:fadeIn .3s ease-out}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.modal-content{background:linear-gradient(135deg,#2d3748,#1a202c);margin:5% auto;padding:25px;border:1px solid #4a5568;width:80%;max-width:600px;border-radius:16px;position:relative;color:var(--text);max-height:80vh;overflow-y:auto;box-shadow:0 20px 50px #00000080;animation:slideIn .3s ease-out}@keyframes slideIn{0%{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1}}.close-btn{position:absolute;top:15px;right:20px;color:#718096;font-size:28px;font-weight:700;cursor:pointer;transition:color .2s}.close-btn:hover{color:#fc8181}.rules-table{width:100%;border-collapse:collapse;margin-bottom:15px;font-size:14px}.rules-table th,.rules-table td{border:1px solid #4a5568;padding:10px;text-align:left;vertical-align:middle}.rules-table th{background-color:#0000004d;color:var(--accent);font-weight:600}.rules-table tr:nth-child(2n){background-color:#ffffff05}.ship-preview{width:80px;height:30px;display:flex;align-items:center;justify-content:center;overflow:hidden}.ship-preview .ship-inner{pointer-events:none}.ship-preview .hull-scale-wrapper{transform:scale(.4)!important}.game-over-content{text-align:center;max-width:400px;padding:40px}.game-over-title{font-size:3rem;margin:0 0 20px;text-shadow:0 0 20px currentColor}.win-text{color:#48bb78}.lose-text{color:#fc8181}.control-group{margin-top:auto;display:flex;flex-direction:column;gap:8px;padding-top:10px;border-top:1px solid #4a5568}.btn-row{display:flex;gap:5px}.btn-row>*{flex:1}.btn-icon{padding:8px;font-size:16px}.difficulty-bar{margin-bottom:0}@media(max-width:768px){:root{--cell-size: clamp(26px, 8.5vw, 34px)}body{height:auto;min-height:100vh;overflow-y:auto;padding-top:50px}.layout{flex-direction:column;height:auto;overflow:visible}.dock-panel{width:100%;min-width:100%;height:auto;max-height:none;border-right:none;border-bottom:1px solid #4a5568;order:1;padding:10px;overflow:visible}.center-area{order:2;height:auto;overflow:visible;flex:none;background-attachment:fixed}.log-panel{width:100%;min-width:100%;height:200px;border-left:none;border-top:1px solid #4a5568;order:3}.toggle-btn{display:none}.scroll-view{overflow:visible;padding-bottom:120px}.battlefield{display:grid;grid-template-areas:"stack";width:100%;flex:1;padding:0;margin:0;gap:0;position:relative}.board-box{grid-area:stack;width:100%;display:flex;flex:1;justify-content:center;padding-top:20px;visibility:visible;z-index:0;opacity:1;pointer-events:none}.board-box.active-view{z-index:10;pointer-events:auto}.board-box.active-view .board-title{animation:titleEnter .4s cubic-bezier(.2,.8,.2,1) forwards}.board-box:not(.active-view) .board-title{opacity:0;visibility:hidden;transition:opacity 0s}.board-box.active-view .grid{animation:gridEnter .4s cubic-bezier(.2,.8,.2,1) forwards;box-shadow:0 10px 25px #00000080}@keyframes titleEnter{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@keyframes gridEnter{0%{opacity:0;transform:scale(.95) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}.bottom-controls{height:auto;flex-wrap:nowrap;padding:8px 10px;gap:8px;position:fixed;bottom:0;left:0;right:0;background:#1a202cfa;border-top:1px solid #4a5568;z-index:1000;box-shadow:0 -4px 20px #00000080;display:flex;justify-content:space-between}#btn-reset,#btn-debug{display:none}#btn-random,#btn-settings{display:flex!important}.dock-panel .difficulty-bar,.dock-panel #first-turn-toggle,.dock-panel .control-group>div:first-child{display:none}.dock-panel #rotate-toggle{display:flex;width:100%;justify-content:center;padding:12px;margin-top:8px;font-size:15px;background:linear-gradient(to right,#667eea,#764ba2);border:1px solid rgba(255,255,255,.2);box-shadow:0 4px 12px #764ba266;border-radius:8px;animation:pulse-guide 2s infinite}@keyframes pulse-guide{0%{box-shadow:0 0 #764ba2b3}70%{box-shadow:0 0 0 6px #764ba200}to{box-shadow:0 0 #764ba200}}.mobile-tab-btn{display:flex!important;flex-direction:column;align-items:center;justify-content:center;font-size:10px;background:transparent;border:none;color:#718096;padding:0 15px;min-width:60px;cursor:pointer}.mobile-tab-btn.active{color:#63b3ed;text-shadow:0 0 10px rgba(99,179,237,.5)}.mobile-tab-btn span{font-size:20px;margin-bottom:4px;display:block}#start-btn{flex:2;margin:0 10px;border-radius:20px;box-shadow:0 4px 10px #ed893666}.weapon-bar{position:fixed;bottom:70px;left:50%;transform:translate(-50%);width:90%;background:#2d3748e6;padding:8px;border-radius:12px;border:1px solid #4a5568;box-shadow:0 4px 15px #0006;z-index:999;display:none}.dock-panel{padding-bottom:20px}.log-panel{display:none}#help-btn{position:static;width:auto;height:24px;padding:0 8px;font-size:12px;box-shadow:0 2px 4px #0003;border:1px solid rgba(255,255,255,.3);transform:none;margin-left:8px;bottom:auto;right:auto;border-radius:12px;gap:4px}#help-btn:hover{transform:none}}.pulse-highlight{animation:pulse-orange 2s infinite;background-color:#f6ad55!important;border-color:#fff!important}@keyframes pulse-orange{0%{box-shadow:0 0 #ed8936b3;transform:scale(1)}70%{box-shadow:0 0 0 6px #ed893600;transform:scale(1.1)}to{box-shadow:0 0 #ed893600;transform:scale(1)}}.icon-btn{background:transparent;border:none;color:var(--text);font-size:24px;cursor:pointer;padding:8px;display:none;position:absolute;right:15px;top:50%;transform:translateY(-50%);z-index:60;text-shadow:0 0 10px rgba(0,0,0,.5)}.icon-btn:hover{color:var(--accent);transform:translateY(-50%) rotate(90deg);transition:all .3s}.menu-modal-content{background:#1a202c;border:1px solid #2d3748;padding:20px}.menu-grid{display:flex;flex-direction:column;gap:15px}.menu-section{background:#2d3748;padding:15px;border-radius:12px}.menu-label{font-size:12px;color:#a0aec0;margin-bottom:10px;text-transform:uppercase;letter-spacing:1px;font-weight:700}.menu-row{display:flex;gap:10px}.menu-btn{flex:1;padding:12px;border-radius:8px;font-size:14px;display:flex;align-items:center;justify-content:center;gap:8px;border:none;cursor:pointer;transition:.2s}.mobile-bottom-bar{display:none;width:100%;height:65px;background:#1a202c;align-items:center;justify-content:space-between;padding:0 10px;box-shadow:0 -2px 10px #0000004d;position:relative;z-index:100}.nav-tab{flex:0 0 60px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:transparent;border:none;color:#718096;font-size:10px;padding:0;cursor:pointer;transition:color .2s}.nav-tab .icon{font-size:22px;margin-bottom:4px}.nav-tab.active{color:#63b3ed}.nav-tab.active .icon{transform:scale(1.1)}.action-center{flex:1;display:flex;justify-content:center;padding:0 15px}.deploy-actions,.combat-actions{display:flex;gap:10px;width:100%;justify-content:center}.action-btn{display:flex;align-items:center;justify-content:center;gap:6px;border:none;border-radius:16px;font-weight:700;transition:transform .1s,background .2s;cursor:pointer;box-shadow:0 2px 5px #0003}.action-btn:active{transform:scale(.95)}.action-btn.primary{background:var(--accent);color:#1a202c;flex:2;height:44px;font-size:16px}.action-btn.primary:disabled{background:#4a5568;color:#a0aec0;cursor:not-allowed;box-shadow:none}.action-btn.secondary{background:#2d3748;color:var(--text);flex:1;height:44px;border:1px solid #4a5568;font-size:18px}.weapon-selector{background:linear-gradient(135deg,#3182ce,#2b6cb0);color:#fff;width:100%;height:44px;border-radius:22px;font-size:16px;border:1px solid #4299e1}.desktop-controls{display:flex;gap:10px;align-items:center;width:100%;justify-content:center}@media(max-width:768px){header{justify-content:center;padding:0 15px;position:fixed;top:0;width:100%}.icon-btn{display:block}.bottom-controls{padding:0;background:#1a202c;height:auto;border-top:1px solid #2d3748}.mobile-bottom-bar{display:flex}.desktop-controls{display:none}.weapon-bar{bottom:75px!important;width:auto!important;left:15px!important;right:15px!important;transform:none!important;background:#1a202cf2!important;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid #4a5568;display:none}.weapon-bar.show{display:flex!important;animation:slideUp .2s ease-out}@keyframes slideUp{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.mobile-tab-btn,#btn-random,#btn-settings{display:none!important}.dock-panel{padding-bottom:10px}.scroll-view{padding-bottom:80px}}.ship-visuals-root{--color-sea: #1a2b3c;--color-steel-light: #cfd8dc;--color-steel-mid: #90a4ae;--color-steel-dark: #546e7a;--color-barrel: #263238;--deck-wood-bb: #8d6e63;--deck-flight: #455a64;--deck-dd: #607d8b;--hull-ss: #212121}.turret-base{position:absolute;top:50%;transform:translateY(-50%);z-index:10;display:flex;align-items:center;justify-content:center}.turret-bb{width:22px;height:20px;background:linear-gradient(to bottom,#eceff1,#90a4ae);border-radius:50% 4px 4px 50%;box-shadow:0 2px 3px #0006}.turret-bb:before{content:"";position:absolute;top:50%;transform:translateY(-50%);width:24px;height:3px;background:var(--color-barrel);box-shadow:0 -5px 0 var(--color-barrel),0 5px 0 var(--color-barrel);border-radius:0 2px 2px 0}.turret-bb:after{content:"";position:absolute;top:3px;bottom:3px;width:4px;background:#fff}.turret-cl{width:16px;height:14px;background:#b0bec5;border-radius:4px;box-shadow:0 1px 2px #0000004d}.turret-cl:before{content:"";position:absolute;top:4px;width:14px;height:2px;background:var(--color-barrel);box-shadow:0 4px 0 var(--color-barrel)}.turret-dd{width:12px;height:12px;background:#cfd8dc;border:1px solid #78909c;border-radius:50%}.turret-dd:before{content:"";position:absolute;top:50%;left:50%;width:10px;height:2px;background:var(--color-barrel);transform:translate(-100%,-50%)}.turret-bb:before{left:-20px}.turret-cl:before{left:-10px}.turret-bb:after{left:0}.facing-left .turret-bb,.facing-left .turret-cl,.facing-left .turret-dd{transform:rotate(0)}.facing-right .turret-bb,.facing-right .turret-cl,.facing-right .turret-dd{transform:rotate(180deg)}.hull-bb{width:240px;height:46px;background:repeating-linear-gradient(90deg,#795548 0px 4px,#5d4037 5px);border-radius:50% 15% 15% 50%;position:relative;overflow:hidden;box-shadow:inset 0 0 0 3px var(--color-steel-mid)}.bb-bridge-complex{position:absolute;left:85px;top:4px;bottom:4px;width:60px;background:#0003;border-radius:4px;z-index:5}.bb-tower{position:absolute;left:0;top:-2px;bottom:-2px;width:25px;background:var(--color-steel-light);border:1px solid var(--color-steel-dark);border-radius:4px;box-shadow:2px 2px 4px #0006}.bb-funnel{position:absolute;right:5px;top:8px;bottom:8px;width:18px;background:repeating-linear-gradient(to bottom,#37474f,#37474f 4px,#263238 5px);border-radius:6px;border:1px solid #fff}.bb-stern-equipment{position:absolute;right:10px;top:0;bottom:0;width:40px;z-index:1}.bb-catapult-rail{position:absolute;top:10px;bottom:10px;left:0;width:20px;border-top:2px solid #5d4037;border-bottom:2px solid #5d4037;opacity:.7}.bb-crane{position:absolute;right:5px;bottom:12px;width:25px;height:4px;background:var(--color-steel-dark);transform:rotate(-45deg);border-radius:2px;box-shadow:1px 1px 2px #00000080}.bb-floatplane{position:absolute;left:5px;top:50%;transform:translateY(-50%);width:12px;height:10px;background:#4caf50;clip-path:polygon(50% 0,100% 50%,50% 100%,0 50%)}.hull-cv{width:240px;height:50px;background:var(--deck-flight);border-radius:4px;position:relative;background-image:linear-gradient(90deg,transparent 20%,rgba(255,255,255,.9) 20%,rgba(255,255,255,.9) 80%,transparent 80%),linear-gradient(to bottom,transparent 5%,rgba(255,255,255,.1) 5%,rgba(255,255,255,.1) 95%,transparent 95%);background-size:30px 3px,100% 100%;background-repeat:repeat-x,no-repeat;background-position:center,center}.cv-island{position:absolute;right:55px;top:-6px;width:45px;height:14px;background:var(--color-steel-dark);border-radius:2px;z-index:20;box-shadow:3px 3px 5px #00000080;border-right:6px solid #263238}.cv-elevator{position:absolute;left:60px;top:6px;width:35px;height:38px;border:1px dashed rgba(255,255,255,.4);background:#0003}.cv-sponson{position:absolute;left:10px;bottom:-4px;width:40px;height:6px;background:var(--color-steel-mid);border-radius:0 0 4px 4px}.cv-arrow{position:absolute;left:5px;top:50%;transform:translateY(-50%);width:0;height:0;border-top:6px solid transparent;border-bottom:6px solid transparent;border-right:10px solid #fff}.hull-cl{width:170px;height:32px;background:var(--color-steel-mid);background-image:repeating-linear-gradient(90deg,transparent,transparent 19px,rgba(0,0,0,.1) 20px);border-radius:50% 10% 10% 50%;position:relative;box-shadow:inset 0 0 0 2px var(--color-steel-dark)}.cl-bridge-area{position:absolute;inset:0 40px 0 50px}.cl-block{position:absolute;left:0;top:2px;bottom:2px;width:15px;background:var(--color-steel-dark);border-radius:2px}.cl-funnel{position:absolute;width:8px;height:18px;background:#37474f;border-radius:4px;top:7px}.hull-dd{width:120px;height:22px;background:var(--deck-dd);border-radius:100px 3px 3px 100px;position:relative;display:flex;align-items:center}.dd-mid{position:absolute;left:35px;right:30px;height:100%}.dd-structure{position:absolute;top:6px;width:8px;height:10px;background:#546e7a;border-radius:2px}.dd-torpedo{position:absolute;top:5px;width:12px;height:12px;background:linear-gradient(90deg,#455a64,#263238);border-radius:2px}.hull-ss{width:60px;height:14px;background:var(--hull-ss);border-radius:10px;position:relative;box-shadow:inset 0 2px 4px #ffffff1a}.ss-tower{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:8px;height:22px;background:#333;border-radius:2px;border-top:1px solid #666}.ss-periscope{position:absolute;right:-2px;top:0;width:2px;height:6px;background:#999}.ship-inner{display:flex;align-items:center;justify-content:center;overflow:visible}.hull-scale-wrapper{transform-origin:center center}</style>
</head>
<body>
  <header>
    <h1>ÊåáÊå•ÂÆòÔºöÂÜ≥ÊàòÂ§ßÊ¥ã</h1>
    <button id="btn-menu-toggle" class="icon-btn" aria-label="ËèúÂçï">‚öôÔ∏è</button>
  </header>

  <div id="help-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn" data-action="toggle-help">&times;</span>
      <h2 style="color: var(--accent); text-align: center; margin-top: 0;">Ê∏∏ÊàèËßÑÂàôËØ¥Êòé</h2>

      <h3>1. ËÉúÂà©Êù°‰ª∂</h3>
      <p>ÁéáÂÖàÂáªÊ≤âÊïåÊñπÊâÄÊúâ 5 ËâòËà∞ËàπÁöÑ‰∏ÄÊñπËé∑ËÉú„ÄÇ</p>

      <h3>2. Ëà∞ËàπÂ±ûÊÄß</h3>
      <table class="rules-table">
        <thead>
          <tr><th>ÂõæÁ§∫</th><th>‰ª£Âè∑</th><th>ÂêçÁß∞</th><th>ÈïøÂ∫¶</th><th>Ë°ÄÈáè/Ê†º</th><th>ÁâπÊÆäËÉΩÂäõ</th></tr>
        </thead>
        <tbody id="rules-ship-table-body"></tbody>
      </table>

      <h3>3. Ê≠¶Âô®Á≥ªÁªü</h3>
      <table class="rules-table">
        <tr><th>Ê≠¶Âô®</th><th>ËåÉÂõ¥</th><th>‰º§ÂÆ≥</th><th>ËØ¥Êòé</th></tr>
        <tr><td><b>‰∏ªÁÇÆ</b></td><td>ÂçïÁÇπ</td><td>1~3</td><td>Âü∫Á°ÄÊîªÂáª„ÄÇ‰º§ÂÆ≥ÂèñÂÜ≥‰∫éÂ≠òÊ¥ªËà∞Ëàπ(BB/SS=3, CL=2, ÂÖ∂‰ªñ=1)„ÄÇ</td></tr>
        <tr><td><b>Á©∫Ë¢≠</b></td><td>XÂûã (5Ê†º)</td><td>1</td><td>ÈúÄËà™ÊØç(CV)Â≠òÊ¥ª„ÄÇÂØπ‰∏≠ÂøÉÂèäÂõõËßíÈÄ†Êàê‰º§ÂÆ≥„ÄÇ</td></tr>
        <tr><td><b>Ê∞¥Âê¨</b></td><td>3x3 Âå∫Âüü</td><td>0</td><td>ÈúÄÈ©±ÈÄê(DD)Â≠òÊ¥ª„ÄÇÊé¢ÊµãÂå∫ÂüüÂÜÖÊòØÂê¶ÊúâËàπ„ÄÇËã•ÊúâÔºåÊòæÁ§∫‰∏≠ÂøÉÁúüÂÆûÁä∂ÊÄÅÔºåÂπ∂Ê†áËÆ∞Âë®Âõ¥‰∏∫Áñë‰ºº„ÄÇ</td></tr>
      </table>

      <h3>4. Áä∂ÊÄÅÊ†áËØÜ</h3>
      <ul style="font-size: 14px; line-height: 1.6;">
        <li>üåä <b>Á©∫ÁôΩ</b>ÔºöÊú™Áü•Êµ∑Âüü„ÄÇ</li>
        <li>‚ö™ <b>Ê∞¥Ëä±</b>ÔºöÊú™ÂëΩ‰∏≠ (Miss)„ÄÇ</li>
        <li>‚ùì <b>ÈóÆÂè∑</b>ÔºöÁñë‰ººÁõÆÊ†á (Â£∞ÂëêÊâ´ÊèèÁªìÊûú)„ÄÇ</li>
        <li>üí• <b>ÂÜíÁÉü</b>ÔºöÂèóÊçü (Hit)ÔºåËàπËøòÂú®„ÄÇ</li>
        <li>‚ò†Ô∏è <b>Á∫¢Âèâ</b>ÔºöÊØÅÂùè (Destroyed)ÔºåËØ•Ê†ºË°ÄÈáèÂΩíÈõ∂„ÄÇ</li>
      </ul>

      <h3>5. Â∞èÊèêÁ§∫</h3>
      <ul style="font-size: 14px; line-height: 1.6;">
        <li>ÁßªÂä®Á´ØÈïøÊåâË¶ÅÊîªÂáªÁöÑÊ†º‰ΩçÂèØ‰ª•È¢ÑËßàÊîªÂáªËåÉÂõ¥</li>
        <li>Êõ¥ÊîπÈÉ®ÁΩ≤ÊñπÂêëÈ¶ñÂÖàÈúÄË¶ÅÂ∞ÜËà∞ËàπÊãñÂõûÊ∏ØÂè£ÔºàÂú®‰øÆ‰∫ÜÂú®‰øÆ‰∫ÜÔºâ</li>
      </ul>
    </div>
  </div>

  <div id="game-over-modal" class="modal">
    <div class="modal-content game-over-content">
      <h2 id="game-over-title" class="game-over-title"></h2>
      <p id="game-over-msg" style="font-size: 1.2rem; margin-bottom: 30px; color: #cbd5e0;"></p>
      <div style="display: flex; gap: 10px; justify-content: center;">
        <button class="btn-blue" data-action="view-battlefield" style="font-size: 1.2rem; padding: 12px 20px;">üëÄ Êü•ÁúãÊàòÂú∫</button>
        <button class="btn-restart" data-action="restart-game" style="font-size: 1.2rem; padding: 12px 20px;">üîÑ ÈáçÊñ∞ÂºÄÂßã</button>
      </div>
    </div>
  </div>

  <!-- ÈÄöÁî®ËèúÂçïÊ®°ÊÄÅÊ°Ü (ÂéüËÆæÁΩÆËèúÂçï) -->
  <div id="settings-modal" class="modal">
    <div class="modal-content menu-modal-content">
      <span class="close-btn" data-action="toggle-settings">&times;</span>
      <h2 style="color: var(--accent); text-align: center; margin-top: 0;">‚ò∞ ËèúÂçï</h2>
      
      <div class="menu-grid">
        <!-- Ê∏∏ÊàèÊéßÂà∂ -->
        <div class="menu-section">
            <div class="menu-label">Ê∏∏ÊàèÊéßÂà∂</div>
            <div class="menu-row">
                <button id="mobile-menu-restart" class="menu-btn btn-restart">üîÑ ÈáçÊñ∞ÂºÄÂßã</button>
                <button id="mobile-menu-random" class="menu-btn btn-blue">üé≤ ÈöèÊú∫ÈÉ®ÁΩ≤</button>
            </div>
            <button id="mobile-menu-reset" class="menu-btn btn-blue" style="width:100%; margin-top:8px">‚Ü©Ô∏è ÂÖ®ÈÉ®ÂõûÊ∏Ø</button>
        </div>

        <!-- ÈöæÂ∫¶ËÆæÁΩÆ -->
        <div class="menu-section">
            <div class="menu-label">AI ÈöæÂ∫¶</div>
            <div class="difficulty-bar">
                <button class="diff-btn" id="mobile-diff-easy" data-difficulty="EASY">Êñ∞ÂÖµ</button>
                <button class="diff-btn" id="mobile-diff-normal" data-difficulty="NORMAL">Ëà∞Èïø</button>
                <button class="diff-btn" id="mobile-diff-hard" data-difficulty="HARD">ÊèêÁù£</button>
            </div>
        </div>

        <!-- ÈÄâÈ°π -->
        <div class="menu-section">
            <div class="menu-label">ÈÄâÈ°π</div>
            <div class="menu-row">
                <button class="btn-mode" id="mobile-first-turn">ÂÖàÊâãÔºöÁé©ÂÆ∂ üë§</button>
                <button class="btn-mode" id="mobile-debug">üß† AI ËßÜËßí</button>
            </div>
        </div>
        
        <!-- Â∏ÆÂä© -->
        <div class="menu-section">
             <button id="mobile-menu-help" class="menu-btn btn-orange" style="width:100%">üìñ Ê∏∏ÊàèËØ¥Êòé</button>
        </div>
      </div>
    </div>
  </div>

  <div class="layout">
    <div class="dock-panel">
      <div class="dock-header">
        <span>‚öì Ë£ÖÂ§áÂå∫</span>
        <div id="help-btn" data-action="toggle-help">? Â∏ÆÂä©</div>
      </div>

      <div id="battle-panel" class="dock-container" style="display: none; align-items: stretch;">
        <div class="weapon-bar" id="weapon-bar">
          <button class="weapon-btn active" id="btn-ap" data-weapon="AP">
            <span>üí• ‰∏ªÁÇÆ</span>
            <span id="ap-desc" style="font-size:10px; opacity:0.8">ÂçïÁÇπ 3‰º§</span>
          </button>
          <button class="weapon-btn" id="btn-he" data-weapon="HE">
            <span>‚úàÔ∏è Á©∫Ë¢≠</span>
            <span style="font-size:10px; opacity:0.8">ËåÉÂõ¥ 1‰º§</span>
          </button>
          <button class="weapon-btn" id="btn-sonar" data-weapon="SONAR">
            <span>üì° Ê∞¥Âê¨</span>
            <span style="font-size:10px; opacity:0.8">‰æ¶Êü• 3x3</span>
          </button>
        </div>

        <div class="status-panel" id="status-panel">
          <div style="text-align:center; color:#90cdf4; font-weight:bold; margin-bottom:5px">Ëà∞ÈòüÁä∂ÊÄÅ</div>
          <div id="ship-status-list"></div>
        </div>
      </div>

      <div class="dock-container" id="dock"></div>

      <div class="control-group">
        <div style="font-size: 12px; color: #a0aec0; margin-bottom: 2px;">AI ÈöæÂ∫¶</div>
        <div class="difficulty-bar" id="diff-bar">
          <button class="diff-btn" data-difficulty="EASY">Êñ∞ÂÖµ (ÁÆÄÂçï)</button>
          <button class="diff-btn" data-difficulty="NORMAL">Ëà∞Èïø (Âõ∞Èöæ)</button>
          <button class="diff-btn active" data-difficulty="HARD">ÊèêÁù£ (ÂÜ∑ÈÖ∑)</button>
        </div>

        <div class="btn-row">
          <button class="btn-mode" id="rotate-toggle" title="ÂàáÊç¢ÈÉ®ÁΩ≤ÊñπÂêë">ÊñπÂêëÔºöÊ∞¥Âπ≥ ‚Æï</button>
          <button class="btn-mode" id="first-turn-toggle" title="ÂàáÊç¢ÂÖàÊâã">ÂÖàÊâãÔºöÁé©ÂÆ∂ üë§</button>
        </div>
      </div>
    </div>

    <div class="center-area">
      <div class="toggle-btn toggle-left" data-panel-toggle="left" title="ÂàáÊç¢Ë£ÖÂ§áÂå∫">‚óÄ</div>
      <div class="toggle-btn toggle-right" data-panel-toggle="right" title="ÂàáÊç¢Êó•ÂøóÂå∫">‚ñ∂</div>

      <div class="scroll-view">
        <div class="battlefield">
          <div class="board-box" id="player-board-box">
            <div class="board-title" style="color:#68d391">ÊàëÊñπÊµ∑Âüü (Èò≤ÂÆà)</div>
            <div id="player-grid" class="grid"></div>
          </div>
          <div class="board-box" id="enemy-board-box">
            <div class="board-title" style="color:#fc8181">ÊïåÊñπÊµ∑Âüü (ËøõÊîª)</div>
            <div id="enemy-grid" class="grid"></div>
          </div>
        </div>
      </div>

      <div class="bottom-controls" id="bottom-controls">
        <!-- ÁßªÂä®Á´ØÂ∫ïÈÉ®ÂØºËà™ (Êñ∞ËÆæËÆ°) -->
        <div class="mobile-bottom-bar">
            <button class="nav-tab active" id="mb-tab-player">
                <span class="icon">üõ°Ô∏è</span>
                <span class="label">ÊàëÊñπ</span>
            </button>
            
            <div class="action-center">
                <!-- ÈÉ®ÁΩ≤Èò∂ÊÆµ -->
                <div class="deploy-actions" id="mb-deploy-group">
                    <button id="mb-btn-start" class="action-btn primary" disabled>
                        <span>üöÄ ÂºÄÂßã</span>
                    </button>
                </div>
                <!-- ÊàòÊñóÈò∂ÊÆµ -->
                <div class="combat-actions" id="mb-combat-group" style="display:none">
                    <button id="mb-btn-weapon" class="action-btn weapon-selector">
                        <span id="mb-weapon-icon">üí•</span>
                        <span id="mb-weapon-name">‰∏ªÁÇÆ</span>
                    </button>
                </div>
            </div>

            <button class="nav-tab" id="mb-tab-enemy">
                <span class="icon">üéØ</span>
                <span class="label">ÊïåÊñπ</span>
            </button>
        </div>

        <!-- Ê°åÈù¢Á´ØÂéüÊúâÊåâÈíÆ (ÁßªÂä®Á´ØÈöêËóè) -->
        <div class="desktop-controls">
            <button class="btn-mode" id="btn-debug" title="AI ËßÜËßí (Debug)">üß† AI ËßÜËßí</button>
            <button id="btn-reset" class="btn-blue" title="ÂÖ®ÈÉ®ÂõûÊ∏Ø">üîÑ ÂÖ®ÈÉ®ÂõûÊ∏Ø</button>
            <button id="btn-settings" class="btn-blue" style="display:none" title="ËÆæÁΩÆ">‚öôÔ∏è ËÆæÁΩÆ</button>
            <button id="btn-random" class="btn-blue" title="ÈöèÊú∫ÈÉ®ÁΩ≤">üé≤ ÈöèÊú∫ÈÉ®ÁΩ≤</button>
            <button class="btn-orange" id="start-btn" disabled>üöÄ ÂºÄÂßãÊàòÊñó</button>
        </div>
      </div>
    </div>

    <div class="log-panel">
      <div class="log-header">‚ö° ÊàòÂÜµËÆ∞ÂΩï</div>
      <div id="log" class="log-content">
        <div class="log-line c-sys">ÊãñÊãΩÈÉ®ÁΩ≤ÔºåÁªøËâ≤Âå∫Âüü‰∏∫ÊúâÊïà„ÄÇ</div>
        <div class="log-line c-sys">ÂáÜÂ§áÂ∞±Áª™ÂêéÁÇπÂáªÂºÄÂßã„ÄÇ</div>
      </div>
    </div>
  </div>

</body>
</html>
