<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æŒ‡æŒ¥å®˜ï¼šå†³æˆ˜å¤§æ´‹</title>
  <script type="module" crossorigin>
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&l(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();const u=10,p=40,Ee="æŒ‡æŒ¥å®˜ï¼šå†³æˆ˜å¤§æ´‹",be="v2.0alpha",Z=[{name:"èˆªç©ºæ¯èˆ°",len:4,maxHp:2,code:"CV",type:"carrier"},{name:"æˆ˜åˆ—èˆ°",len:4,maxHp:3,code:"BB",type:"battleship"},{name:"è½»å·¡æ´‹èˆ°",len:3,maxHp:1,code:"CL",type:"cruiser"},{name:"æ½œè‰‡",len:1,maxHp:2,code:"SS",type:"sub"},{name:"é©±é€èˆ°",len:2,maxHp:1,code:"DD",type:"destroyer"}],ne={EASY:{hitFocus:.5,sonarFocus:.5,airstrikeAdvantage:1.6,sonarVarianceGate:.4,sonarUnknownRatio:1,randomness:.6},NORMAL:{hitFocus:2,sonarFocus:1.2,airstrikeAdvantage:1.1,sonarVarianceGate:.25,sonarUnknownRatio:2/3,randomness:.35},HARD:{hitFocus:5.5,sonarFocus:2,airstrikeAdvantage:.85,sonarVarianceGate:.085,sonarUnknownRatio:5/9,randomness:0}},le="EASY";function K(e){let t="";return e==="BB"?t=`
                <div class="hull-scale-wrapper" style="transform: scale(0.66)">
                    <div class="hull-bb">
                        <div class="turret-base facing-left" style="left: 25px;"><div class="turret-bb"></div></div>
                        <div class="turret-base facing-left" style="left: 52px; z-index: 11;"><div class="turret-bb"></div></div>
                        <div class="bb-bridge-complex">
                            <div class="bb-tower"></div>
                            <div class="bb-funnel"></div>
                        </div>
                        <div class="turret-base facing-right" style="right: 60px; z-index: 11;"><div class="turret-bb"></div></div>
                        <div class="bb-stern-equipment">
                            <div class="bb-catapult-rail"></div>
                            <div class="bb-floatplane"></div>
                            <div class="bb-crane"></div>
                        </div>
                    </div>
                </div>`:e==="CV"?t=`
                <div class="hull-scale-wrapper" style="transform: scale(0.66)">
                    <div class="hull-cv">
                        <div class="cv-arrow"></div>
                        <div class="cv-elevator"></div>
                        <div class="cv-island"></div>
                        <div class="cv-sponson"></div>
                    </div>
                </div>`:e==="CL"?t=`
                <div class="hull-scale-wrapper" style="transform: scale(0.7)">
                    <div class="hull-cl">
                        <div class="turret-base facing-left" style="left: 15px;"><div class="turret-cl"></div></div>
                        <div class="turret-base facing-left" style="left: 35px; z-index:11"><div class="turret-cl"></div></div>
                        <div class="cl-bridge-area">
                            <div class="cl-block"></div>
                            <div class="cl-funnel" style="left: 25px;"></div>
                            <div class="cl-funnel" style="left: 45px;"></div>
                        </div>
                        <div class="turret-base facing-right" style="right: 35px; z-index:11"><div class="turret-cl"></div></div>
                        <div class="turret-base facing-right" style="right: 15px;"><div class="turret-cl"></div></div>
                    </div>
                </div>`:e==="DD"?t=`
                <div class="hull-scale-wrapper" style="transform: scale(0.66)">
                    <div class="hull-dd">
                        <div class="turret-base facing-left" style="left: 10px;"><div class="turret-dd"></div></div>
                        <div class="turret-base facing-left" style="left: 24px; z-index:11"><div class="turret-dd"></div></div>
                        <div class="dd-mid">
                            <div class="dd-structure" style="left: 0px;"></div>
                            <div class="dd-torpedo" style="left: 12px;"></div>
                            <div class="dd-structure" style="left: 28px;"></div>
                            <div class="dd-torpedo" style="left: 40px;"></div>
                        </div>
                        <div class="turret-base facing-right" style="right: 10px;"><div class="turret-dd"></div></div>
                    </div>
                </div>`:e==="SS"&&(t=`
                <div class="hull-scale-wrapper" style="transform: scale(0.66)">
                    <div class="hull-ss">
                        <div class="ss-tower">
                            <div class="ss-periscope"></div>
                        </div>
                    </div>
                </div>`),t}let I="SETUP",E=[],A=[],R=H(),B=[],P="horizontal",k="AP",q="PLAYER",w=!1,O=null,G=null;function Le(){se(),Ae(),Ie(),document.addEventListener("mouseup",Pe),document.addEventListener("mousemove",we),Qe(),me(fe,{silent:!0})}function H(){return Array(u).fill(0).map(()=>Array(u).fill(0))}function se(){const e=document.getElementById("player-grid"),t=document.getElementById("enemy-grid");e.innerHTML="",t.innerHTML="";for(let n=0;n<u;n++)for(let l=0;l<u;l++){let s=document.createElement("div");s.className="cell",s.dataset.r=n,s.dataset.c=l,e.appendChild(s);let i=document.createElement("div");i.className="cell",i.dataset.r=n,i.dataset.c=l,i.onclick=()=>qe(n,l),i.onmouseenter=()=>xe(n,l),i.onmouseleave=()=>ie(),t.appendChild(i)}}function Ie(){const e=document.getElementById("help-btn");e&&e.addEventListener("click",W);const t=document.getElementById("help-modal");if(t){t.addEventListener("click",f=>{f.target===t&&W()});const r=t.querySelector(".close-btn");r&&r.addEventListener("click",W)}document.querySelectorAll("[data-weapon]").forEach(r=>{r.addEventListener("click",()=>F(r.dataset.weapon))}),document.querySelectorAll("[data-difficulty]").forEach(r=>{r.addEventListener("click",()=>me(r.dataset.difficulty))});const n=document.getElementById("rotate-toggle");n&&n.addEventListener("click",Be);const l=document.getElementById("first-turn-toggle");l&&l.addEventListener("click",Se),document.querySelectorAll("[data-panel-toggle]").forEach(r=>{r.addEventListener("click",()=>Je(r.dataset.panelToggle))});const s=document.getElementById("btn-debug");s&&s.addEventListener("click",ke);const i=document.getElementById("btn-reset");i&&i.addEventListener("click",Q);const c=document.getElementById("btn-random");c&&c.addEventListener("click",Ge);const o=document.getElementById("start-btn");o&&o.addEventListener("click",He);const a=document.querySelector('[data-action="view-battlefield"]');a&&a.addEventListener("click",Ze);const d=document.querySelector('[data-action="restart-game"]');d&&d.addEventListener("click",Ke)}function xe(e,t){if(I!=="PLAYING"||document.getElementById("enemy-grid").style.pointerEvents==="none")return;ie();let n=[];if(k==="AP")n.push({r:e,c:t});else if(k==="HE")[[0,0],[-1,-1],[-1,1],[1,-1],[1,1]].forEach(i=>{n.push({r:e+i[0],c:t+i[1]})});else if(k==="SONAR")for(let s=-1;s<=1;s++)for(let i=-1;i<=1;i++)n.push({r:e+s,c:t+i});const l=document.getElementById("enemy-grid");n.forEach(s=>{if(s.r>=0&&s.r<u&&s.c>=0&&s.c<u){const i=l.querySelector(`.cell[data-r="${s.r}"][data-c="${s.c}"]`);i&&i.classList.add("attack-range-highlight")}})}function ie(){document.getElementById("enemy-grid").querySelectorAll(".attack-range-highlight").forEach(t=>{t.classList.remove("attack-range-highlight")})}function Ae(){const e=document.getElementById("dock");E=[],e.innerHTML="",Z.forEach((t,n)=>{const l=document.createElement("div");l.className="ship ship-visuals-root",l.title=`${t.name} (é•¿åº¦:${t.len})`,l.style.position="relative";const s=document.createElement("div");s.className="ship-inner",s.innerHTML=K(t.code),l.appendChild(s);const i={id:n,name:t.name,len:t.len,maxHp:t.maxHp,code:t.code,hp:Array(t.len).fill(t.maxHp),el:l,inDock:!0,vertical:!1,r:-1,c:-1,sunk:!1};Y(i),l.onclick=c=>{U||I==="SETUP"&&!i.inDock&&De(i)},l.onmousedown=c=>Te(c,i),e.appendChild(l),E.push(i)})}function Y(e,t=!1){const n=e.len*p+"px",l=p+"px";e.el.style.setProperty("--w",n),e.el.style.setProperty("--h",l),e.vertical&&(!e.inDock||t)?(e.el.classList.add("vertical"),e.el.style.width=p+"px",e.el.style.height=n):(e.el.classList.remove("vertical"),e.el.style.width=n,e.el.style.height=p+"px")}function Be(){P=P==="horizontal"?"vertical":"horizontal";const e=document.getElementById("rotate-toggle");e.innerText=P==="horizontal"?"éƒ¨ç½²æ–¹å‘:æ°´å¹³â®•":"éƒ¨ç½²æ–¹å‘:å‚ç›´â¬‡",E.forEach(t=>{t.inDock&&(t.vertical=P==="vertical")})}function Se(){q=q==="PLAYER"?"AI":"PLAYER";const e=document.getElementById("first-turn-toggle");e.innerText=q==="PLAYER"?"å…ˆæ‰‹ï¼šç©å®¶ ğŸ‘¤":"å…ˆæ‰‹ï¼šç”µè„‘ ğŸ¤–"}function ke(){w=!w;const e=document.getElementById("btn-debug");e.innerText=w?"ğŸ§  AI è§†è§’: å¼€å¯":"ğŸ§  AI è§†è§’: å…³é—­",e.style.background=w?"#ed8936":"",w?ce():Me()}function ce(e=null){if(!w)return;const t=he(),n=E.filter(i=>!i.sunk),l=e||ve(t,n),s=document.getElementById("player-grid");for(let i=0;i<u;i++)for(let c=0;c<u;c++){const o=s.querySelector(`.cell[data-r="${i}"][data-c="${c}"]`),a=l[i][c]||0;o.classList.remove("debug-heat"),o.removeAttribute("data-heat"),o.style.removeProperty("--heat-bg");const d=Math.min(1,Math.max(0,a));if(d>0){o.setAttribute("data-heat",`${(d*100).toFixed(1)}%`),o.classList.add("debug-heat");const r=.1+d*.6,f=Math.floor(255*d),g=Math.floor(255*(1-d));o.style.setProperty("--heat-bg",`rgba(${f}, 0, ${g}, ${r})`)}}}function Me(){document.getElementById("player-grid").querySelectorAll(".debug-heat").forEach(t=>{t.classList.remove("debug-heat"),t.removeAttribute("data-heat"),t.style.removeProperty("--heat-bg")})}let D=null,x={x:0,y:0},U=!1,S=null;function Te(e,t){if(I!=="SETUP"||e.button!==0)return;e.preventDefault(),D=t,U=!1,S=null;const n=t.el.getBoundingClientRect();let l=e.clientX-n.left,s=e.clientY-n.top;t.el.classList.add("dragging");const i=t.inDock&&P==="vertical";t.inDock&&(t.vertical=P==="vertical"),Y(t,!0),i?(x.x=s,x.y=l):(x.x=l,x.y=s),t.el.style.left=e.clientX-x.x+"px",t.el.style.top=e.clientY-x.y+"px",document.body.appendChild(t.el),t.inDock||re(t)}function we(e){if(!D)return;U=!0;const t=D;t.el.style.left=e.clientX-x.x+"px",t.el.style.top=e.clientY-x.y+"px",oe();const n=document.elementFromPoint(e.clientX,e.clientY);if(!n){S=null;return}const l=n.closest(".cell"),s=document.getElementById("player-grid");if(l&&s.contains(l)){const i=s.getBoundingClientRect(),c=e.clientX-x.x,o=e.clientY-x.y,a=c-i.left+p/2,d=o-i.top+p/2,r=Math.floor(a/p),f=Math.floor(d/p);Ce(t,f,r)}else S=null}function Pe(e){if(!D)return;const t=D;t.el.classList.remove("dragging");const l=document.getElementById("player-grid").getBoundingClientRect(),s=e.clientX>=l.left&&e.clientX<=l.right&&e.clientY>=l.top&&e.clientY<=l.bottom,i=S&&S.shipId===t.id?S:null;oe(),S=null;let c=!1;if(i&&N(i.r,i.c,t.len,i.vertical))V(t,i.r,i.c,i.vertical),c=!0;else if(s){const o=e.clientX-x.x,a=e.clientY-x.y,d=o-l.left+p/2,r=a-l.top+p/2,f=Math.floor(d/p),g=Math.floor(r/p);N(g,f,t.len,t.vertical)&&(V(t,g,f,t.vertical),c=!0)}c||(ae(t),s&&b("æ— æ•ˆä½ç½®ï¼šé‡å æˆ–è¶Šç•Œ","c-warn")),D=null,setTimeout(()=>U=!1,50),ee()}function Ce(e,t,n){const l=e.len,s=e.vertical,i=N(t,n,l,s),c=i?"highlight-valid":"highlight-invalid";let o=!1;for(let a=0;a<l;a++){const d=s?t+a:t,r=s?n:n+a,f=document.querySelector(`#player-grid .cell[data-r="${d}"][data-c="${r}"]`);f&&(f.classList.add(c),o=!0)}i&&o?S={shipId:e.id,r:t,c:n,vertical:s}:S=null}function oe(){document.querySelectorAll(".highlight-valid, .highlight-invalid").forEach(e=>{e.classList.remove("highlight-valid"),e.classList.remove("highlight-invalid")})}function V(e,t,n,l){const s=document.getElementById("player-grid");e.inDock=!1,e.r=t,e.c=n,e.vertical=l,e.el.style.position="absolute",e.el.style.margin="0",s.appendChild(e.el),Y(e),e.el.style.left=n*p+"px",e.el.style.top=t*p+"px",J(e,1)}function ae(e){const t=document.getElementById("dock");e.inDock=!0,e.r=-1,e.c=-1,e.sunk=!1,e.hp=Array(e.len).fill(e.maxHp),e.el.classList.remove("sunk"),e.vertical=P==="vertical",e.el.style.position="relative",e.el.style.left="auto",e.el.style.top="auto",e.el.style.margin="0",Y(e),t.appendChild(e.el)}function De(e){const t=!e.vertical;re(e),N(e.r,e.c,e.len,t)?V(e,e.r,e.c,t):(J(e,1),$e(e.el),b("æ—‹è½¬ç©ºé—´ä¸è¶³","c-warn"))}function $e(e){e.classList.remove("shake"),e.offsetWidth,e.classList.add("shake")}function N(e,t,n,l,s){if(e<0||t<0)return!1;if(l){if(e+n>u||t>=u)return!1}else if(t+n>u||e>=u)return!1;for(let i=0;i<n;i++){let c=l?e+i:e,o=l?t:t+i;if(R[c][o]===1)return!1}return!0}function J(e,t){for(let n=0;n<e.len;n++){let l=e.vertical?e.r+n:e.r,s=e.vertical?e.c:e.c+n;l<u&&s<u&&(R[l][s]=t)}}function re(e){J(e,0)}function Q(){R=H(),E.forEach(e=>ae(e)),ee()}function Ge(){Q(),setTimeout(()=>{E.forEach(e=>{let t=!1,n=0;for(;!t&&n<200;){let l=Math.floor(Math.random()*u),s=Math.floor(Math.random()*u),i=Math.random()>.5;N(l,s,e.len,i)&&(V(e,l,s,i),t=!0),n++}}),ee()},50)}function ee(){const e=E.every(n=>!n.inDock),t=document.getElementById("start-btn");I==="SETUP"&&(t.disabled=!e,e?t.className="btn-orange":t.disabled=!0)}function He(){document.getElementById("start-btn"),I==="PLAYING"||I==="END"?confirm("ç¡®å®šè¦ç»“æŸå½“å‰æˆ˜æ–—å¹¶é‡æ–°å¼€å§‹å—ï¼Ÿ")&&de():Ne()}function de(){X(),O=null,I="SETUP",document.getElementById("dock").style.display="flex",document.getElementById("battle-panel").style.display="none",document.getElementById("dock").style.pointerEvents="auto",document.getElementById("dock").style.opacity=1,document.getElementById("rotate-toggle").disabled=!1,document.getElementById("first-turn-toggle").disabled=!1,document.getElementById("btn-debug").disabled=!1,document.getElementById("btn-reset").disabled=!1,document.getElementById("btn-random").disabled=!1;const e=document.getElementById("start-btn");e.innerText="ğŸš€ å¼€å§‹æˆ˜æ–—",e.className="btn-orange",e.disabled=!0,se(),document.getElementById("enemy-grid").style.pointerEvents="none",R=H(),Q(),document.getElementById("log").innerHTML='<div class="log-line c-sys">æ¸¸æˆå·²é‡ç½®ã€‚</div>'}function Ne(){X(),O=null,I="PLAYING",document.getElementById("dock").style.display="none",document.getElementById("battle-panel").style.display="flex",document.getElementById("rotate-toggle").disabled=!0,document.getElementById("first-turn-toggle").disabled=!0,document.getElementById("btn-reset").disabled=!0,document.getElementById("btn-random").disabled=!0,E.forEach(t=>t.el.style.cursor="default");const e=document.getElementById("start-btn");e.innerText="ğŸ”„ é‡æ–°å¼€å§‹",e.className="btn-restart",Re(),te(),F("AP"),q==="PLAYER"?(b("æˆ˜æ–—å¼€å§‹ï¼ç©å®¶å…ˆæ‰‹ï¼Œç‚¹å‡»æ•Œæ–¹æµ·åŸŸå¼€ç«ã€‚","c-warn"),document.getElementById("enemy-grid").style.pointerEvents="auto"):(b("æˆ˜æ–—å¼€å§‹ï¼ç”µè„‘å…ˆæ‰‹ã€‚","c-warn"),document.getElementById("enemy-grid").style.pointerEvents="none",ge(1e3))}function Re(){const e=document.getElementById("enemy-grid");e.querySelectorAll(".wreck").forEach(n=>n.remove()),e.querySelectorAll(".revealed-enemy-ship").forEach(n=>n.remove()),e.querySelectorAll(".cell").forEach(n=>{for(n.className="cell";n.firstChild;)n.removeChild(n.firstChild)}),A=[],B=H().map(n=>n.map(l=>({hit:!1,shipId:-1,segmentIndex:-1})));let t=H();Z.forEach((n,l)=>{let s=!1,i=0;for(;!s&&i<1e3;){i++;let c=Math.floor(Math.random()*u),o=Math.floor(Math.random()*u),a=Math.random()>.5,d=!0;if(a?c+n.len>u&&(d=!1):o+n.len>u&&(d=!1),d)for(let r=0;r<n.len;r++){let f=a?c+r:c,g=a?o:o+r;t[f][g]===1&&(d=!1)}if(d){for(let r=0;r<n.len;r++){let f=a?c+r:c,g=a?o:o+r;t[f][g]=1,B[f][g].shipId=l,B[f][g].segmentIndex=r}A.push({id:l,name:n.name,len:n.len,maxHp:n.maxHp,code:n.code,hp:Array(n.len).fill(n.maxHp),sunk:!1,r:c,c:o,v:a}),s=!0}}s||console.error("Failed to place ship:",n.name)})}function F(e){k=e,document.querySelectorAll(".weapon-btn").forEach(n=>n.classList.remove("active"));const t=e==="AP"?"btn-ap":e==="HE"?"btn-he":"btn-sonar";document.getElementById(t).classList.add("active")}function Ye(){const e=E.some(c=>c.code==="CV"&&!c.sunk);E.some(c=>c.code==="CL"&&!c.sunk);const t=E.some(c=>c.code==="DD"&&!c.sunk),n=e,l=t;document.getElementById("btn-he").disabled=!n,document.getElementById("btn-sonar").disabled=!l,k==="HE"&&!n&&F("AP"),k==="SONAR"&&!l&&F("AP");const s=ue(),i=document.getElementById("ap-desc");i&&(i.innerText=`å•ç‚¹ ${s}ä¼¤`)}function ue(){const e=E.some(l=>l.code==="BB"&&!l.sunk),t=E.some(l=>l.code==="SS"&&!l.sunk),n=E.some(l=>l.code==="CL"&&!l.sunk);return e||t?3:n?2:1}function te(){const e=document.getElementById("ship-status-list");e.innerHTML="",E.forEach(t=>{const n=document.createElement("div");n.className="ship-status-row";const l=document.createElement("span");l.innerText=t.name,t.sunk&&(l.style.textDecoration="line-through",l.style.color="#fc8181");const s=document.createElement("div");s.className="hp-blocks",t.hp.forEach(i=>{const c=document.createElement("div");c.className="hp-block",i<=0?c.classList.add("lost"):i<t.maxHp&&c.classList.add("dmg"),s.appendChild(c)}),n.appendChild(l),n.appendChild(s),e.appendChild(n)}),Ye()}function qe(e,t){if(I==="PLAYING"&&document.getElementById("enemy-grid").style.pointerEvents!=="none"){if(k==="AP"){const n=B[e][t];if(n.hit&&n.shipId!==-1&&A[n.shipId].hp[n.segmentIndex]<=0||n.hit&&n.shipId===-1)return;const l=ue();j(e,t,l),b(`ä½¿ç”¨ä¸»ç‚®æ”»å‡» (${e+1},${t+1})ï¼Œä¼¤å®³: ${l}`,"c-p")}else if(k==="HE"){const n=[[0,0],[-1,-1],[-1,1],[1,-1],[1,1]];let l=0;n.forEach(s=>{let i=e+s[0],c=t+s[1];if(i>=0&&i<u&&c>=0&&c<u){const o=B[i][c],a=o.hit&&o.shipId!==-1&&A[o.shipId].hp[o.segmentIndex]<=0;!(o.hit&&o.shipId===-1)&&!a&&(j(i,c,1),l++)}}),b(`å‘¼å«ç©ºè¢­è¦†ç›– (${e+1},${t+1}) å‘¨è¾¹ï¼Œæ‰“å‡»ç‚¹æ•°: ${l}`,"c-p")}else if(k==="SONAR"){let n=0;for(let l=-1;l<=1;l++)for(let s=-1;s<=1;s++){let i=e+l,c=t+s;if(i>=0&&i<u&&c>=0&&c<u){const o=B[i][c];o.shipId!==-1&&!o.hit&&n++}}if(n===0){for(let l=-1;l<=1;l++)for(let s=-1;s<=1;s++){let i=e+l,c=t+s;if(i>=0&&i<u&&c>=0&&c<u){const o=B[i][c],a=document.querySelector(`#enemy-grid .cell[data-r='${i}'][data-c='${c}']`);a&&a.classList.remove("detect"),o.hit||(o.hit=!0,a&&a.classList.add("miss"))}}b(`å£°çº³æ‰«æ (${e+1},${t+1}) åŒºåŸŸï¼šæ— ååº”ã€‚`,"c-sys")}else{B[e][t].hit||j(e,t,0);for(let s=-1;s<=1;s++)for(let i=-1;i<=1;i++){let c=e+s,o=t+i;if(!(s===0&&i===0)&&c>=0&&c<u&&o>=0&&o<u){const a=B[c][o],d=document.querySelector(`#enemy-grid .cell[data-r='${c}'][data-c='${o}']`);!a.hit&&d&&!d.classList.contains("miss")&&!d.classList.contains("hit")&&!d.classList.contains("destroyed")&&!d.classList.contains("detect")&&d.classList.add("detect")}}b(`å£°çº³æ‰«æ (${e+1},${t+1}) åŒºåŸŸï¼šå‘ç°ä¿¡å·ï¼å‘¨è¾¹æ ‡è®°ä¸ºç–‘ä¼¼ã€‚`,"c-warn")}}te(),document.getElementById("enemy-grid").style.pointerEvents="none",I==="PLAYING"&&ge(300)}}function j(e,t,n){const l=B[e][t],s=document.querySelector(`#enemy-grid .cell[data-r='${e}'][data-c='${t}']`);if(!(l.hit&&l.shipId===-1))if(l.hit=!0,s.classList.remove("detect"),l.shipId!==-1){const i=A[l.shipId];n>0&&(i.hp[l.segmentIndex]-=n),s.classList.remove("hit","destroyed"),i.hp[l.segmentIndex]<=0?s.classList.add("destroyed"):s.classList.add("hit"),i.hp.every(c=>c<=0)&&!i.sunk&&(i.sunk=!0,b(`æˆ˜æŠ¥ï¼šæ•Œæ–¹ã€${i.name}ã€‘ç¡®è®¤æ²‰æ²¡ï¼`,"c-warn"),pe(i),ye("ç©å®¶"))}else s.classList.add("miss")}let C={...ne[le]},fe=le;function me(e,t={}){const{silent:n=!1}=t;fe=e,C={...ne[e]};const l=document.querySelectorAll(".diff-btn");l.forEach(s=>s.classList.remove("active")),e==="EASY"?l[0].classList.add("active"):e==="NORMAL"?l[1].classList.add("active"):l[2].classList.add("active"),n||b(`AI éš¾åº¦å·²è°ƒæ•´ä¸º: ${e==="EASY"?"æ–°å…µ (ç®€å•)":e==="NORMAL"?"èˆ°é•¿ (å›°éš¾)":"æç£ (å†·é…·)"}`,"c-sys")}const Oe=1e-4;function X(){G!==null&&(clearTimeout(G),G=null)}function ge(e){X(),G=setTimeout(()=>{G=null,Ve()},e)}function Ve(){if(I!=="PLAYING")return;const e=A.some(m=>m.code==="CV"&&!m.sunk),t=A.some(m=>m.code==="CL"&&!m.sunk),n=A.some(m=>m.code==="BB"&&!m.sunk),l=A.some(m=>m.code==="SS"&&!m.sunk),s=A.some(m=>m.code==="DD"&&!m.sunk);let i=1;n||l?i=3:t&&(i=2);const c=e,o=s,a=he(),d=E.filter(m=>!m.sunk),r=ve(a,d);let f={r:-1,c:-1,weapon:"AP"};if(Math.random()<C.randomness){let m,h,y=0;do m=Math.floor(Math.random()*u),h=Math.floor(Math.random()*u),y++;while((a[m][h]===1||a[m][h]===3||a[m][h]===5)&&y<200);c&&Math.random()<.1?f={r:m,c:h,weapon:"HE"}:o&&Math.random()<.1?f={r:m,c:h,weapon:"SONAR"}:f={r:m,c:h,weapon:"AP"}}else{const m=Ue(r,a,i),h=_e(r,a,i);if(f={...m,weapon:"AP"},c){const y=Xe(r,a,1);y.score>m.score*C.airstrikeAdvantage&&(f={...y,weapon:"HE"})}if(o){const y=je(r,a),L=h.normVariance<C.sonarVarianceGate;y.r!==-1&&y.score>=C.sonarUnknownRatio&&L&&(f={...y,weapon:"SONAR"})}}if(f.r===-1){let m,h;do m=Math.floor(Math.random()*10),h=Math.floor(Math.random()*10);while(a[m][h]===1||a[m][h]===3||a[m][h]===5);f={r:m,c:h,weapon:"AP"}}const{r:g,c:v,weapon:M}=f;if(M==="AP")z(g,v,i),b(`æ•Œæ–¹ä½¿ç”¨ä¸»ç‚®æ”»å‡» (${g+1},${v+1})`,"c-e");else if(M==="HE")[[0,0],[-1,-1],[-1,1],[1,-1],[1,1]].forEach(h=>{let y=g+h[0],L=v+h[1];y>=0&&y<u&&L>=0&&L<u&&z(y,L,1)}),b(`æ•Œæ–¹å‘åŠ¨ç©ºè¢­ (${g+1},${v+1})`,"c-e");else if(M==="SONAR"){let m=!1;for(let h=-1;h<=1;h++)for(let y=-1;y<=1;y++){let L=g+h,T=v+y;L>=0&&L<10&&T>=0&&T<10&&R[L][T]===1&&(m=!0)}if(m)b(`æ•Œæ–¹å£°çº³æ‰«æ (${g+1},${v+1})ï¼šå‘ç°ä¿¡å·ï¼`,"c-e"),z(g,v,0),ze(g,v);else{b(`æ•Œæ–¹å£°çº³æ‰«æ (${g+1},${v+1})ï¼šæ— ååº”ã€‚`,"c-sys");for(let h=-1;h<=1;h++)for(let y=-1;y<=1;y++){let L=g+h,T=v+y;if(L>=0&&L<10&&T>=0&&T<10){const _=document.querySelector(`#player-grid .cell[data-r='${L}'][data-c='${T}']`);!_.classList.contains("hit")&&!_.classList.contains("destroyed")&&_.classList.add("miss")}}}}te(),w&&ce();const $=document.getElementById("enemy-grid");I==="PLAYING"?$.style.pointerEvents="auto":$.style.pointerEvents="none"}function he(){let e=Array(10).fill(0).map(()=>Array(10).fill(0));return document.querySelectorAll("#player-grid .cell").forEach(t=>{const n=parseInt(t.dataset.r),l=parseInt(t.dataset.c);t.classList.contains("destroyed")?e[n][l]=3:t.classList.contains("hit")?e[n][l]=2:t.classList.contains("miss")?e[n][l]=1:t.classList.contains("ai-detect")&&(e[n][l]=4)}),E.forEach(t=>{if(t.sunk)for(let n=0;n<t.len;n++){let l=t.vertical?t.r+n:t.r,s=t.vertical?t.c:t.c+n;l>=0&&l<10&&s>=0&&s<10&&(e[l][s]=5)}}),e}function ve(e,t){const n=Array(u).fill(0).map(()=>Array(u).fill(0));let l=0;if(t.forEach(s=>{Fe(s,e).forEach(({cells:c,weight:o})=>{const a=c.filter(r=>{const f=e[r.r][r.c];return f===0||f===4});if(a.length===0)return;const d=o/a.length;a.forEach(r=>{n[r.r][r.c]+=d,l+=d})})}),l>0)for(let s=0;s<u;s++)for(let i=0;i<u;i++)n[s][i]=n[s][i]/l;for(let s=0;s<u;s++)for(let i=0;i<u;i++){const c=e[s][i];c===2&&(n[s][i]=1),(c===1||c===3||c===5)&&(n[s][i]=0)}return n}function Fe(e,t){const n=[],l=e.len,i=Math.max(1,e.hp.filter(o=>o>0).length)/l;for(let o=0;o<u;o++)for(let a=0;a<=u-l;a++)c(o,a,!1);for(let o=0;o<=u-l;o++)for(let a=0;a<u;a++)c(o,a,!0);return n;function c(o,a,d){const r=[];let f=1;for(let v=0;v<l;v++){const M=d?o+v:o,$=d?a:a+v,m=t[M][$];if(m===1||m===5)return;r.push({r:M,c:$}),m===2||m===3?f+=C.hitFocus:m===4&&(f+=C.sonarFocus)}const g=Math.max(Oe,f*i);n.push({cells:r,weight:g})}}function Ue(e,t,n=1){let l=-1;const s=[];for(let c=0;c<u;c++)for(let o=0;o<u;o++){const a=t[c][o];if(a===1||a===3||a===5)continue;const r=(a===2?1:e[c][o]||0)*n;r>l+1e-6?(l=r,s.length=0,s.push({r:c,c:o})):Math.abs(r-l)<1e-6&&s.push({r:c,c:o})}return s.length===0?{r:-1,c:-1,score:0}:{...s[Math.floor(Math.random()*s.length)],score:l}}function Xe(e,t,n=1){const l=[[0,0],[-1,-1],[-1,1],[1,-1],[1,1]];let s=-1;const i=[];for(let o=0;o<u;o++)for(let a=0;a<u;a++){let d=0;l.forEach(r=>{const f=o+r[0],g=a+r[1];if(f<0||f>=u||g<0||g>=u)return;const v=t[f][g];if(v===1||v===3||v===5)return;const M=v===2?1:e[f][g]||0;d+=M*n}),d>s+1e-6?(s=d,i.length=0,i.push({r:o,c:a})):Math.abs(d-s)<1e-6&&d>=0&&i.push({r:o,c:a})}return i.length===0?{r:-1,c:-1,score:0}:{...i[Math.floor(Math.random()*i.length)],score:s}}function _e(e,t,n=1){const l=[];let s=0;for(let a=0;a<u;a++)for(let d=0;d<u;d++){const r=t[a][d];if(r===1||r===3||r===5)continue;const g=(r===2?1:e[a][d]||0)*n;l.push(g),g>s&&(s=g)}if(!l.length)return{mean:0,variance:0,maxScore:0,normVariance:0};const i=l.reduce((a,d)=>a+d,0)/l.length,c=l.reduce((a,d)=>a+Math.pow(d-i,2),0)/l.length;let o=0;if(s>0){const a=s/2,d=a>0?a*a:1;o=Math.min(1,c/d)}return{mean:i,variance:c,maxScore:s,normVariance:o}}function je(e,t){let n={r:-1,c:-1,score:0,density:0};for(let l=0;l<u;l++)for(let s=0;s<u;s++){let i=0,c=0;for(let d=-1;d<=1;d++)for(let r=-1;r<=1;r++){const f=l+d,g=s+r;if(f<0||f>=u||g<0||g>=u)continue;t[f][g]===0&&(i++,c+=e[f][g]||0)}if(i===0)continue;const o=i/9,a=c/i;(o>n.score+1e-6||Math.abs(o-n.score)<1e-6&&a>n.density)&&(n={r:l,c:s,score:o,density:a})}return n}function ze(e,t){for(let n=-1;n<=1;n++)for(let l=-1;l<=1;l++){if(n===0&&l===0)continue;const s=e+n,i=t+l;if(s<0||s>=u||i<0||i>=u)continue;const c=document.querySelector(`#player-grid .cell[data-r='${s}'][data-c='${i}']`);c&&(c.classList.contains("hit")||c.classList.contains("destroyed")||c.classList.add("ai-detect"))}}function z(e,t,n){const l=document.querySelector(`#player-grid .cell[data-r='${e}'][data-c='${t}']`);l.classList.remove("ai-detect");let s=null,i=-1;for(let c of E)if(c.vertical){if(t===c.c&&e>=c.r&&e<c.r+c.len){s=c,i=e-c.r;break}}else if(e===c.r&&t>=c.c&&t<c.c+c.len){s=c,i=t-c.c;break}if(s){if(s.hp[i]<=0)return;s.hp[i]-=n,l.classList.remove("hit","destroyed","miss"),s.hp[i]<=0?l.classList.add("destroyed"):l.classList.add("hit"),s.hp.every(c=>c<=0)&&!s.sunk&&(s.sunk=!0,s.el.classList.add("sunk"),b(`ä¸¥é‡è­¦æŠ¥ï¼šæˆ‘æ–¹ã€${s.name}ã€‘æ²‰æ²¡ï¼`,"c-e"),ye("ç”µè„‘"))}else!l.classList.contains("miss")&&!l.classList.contains("hit")&&!l.classList.contains("destroyed")&&l.classList.add("miss")}function ye(e){if(O)return;const t=E.every(o=>o.sunk),n=A.every(o=>o.sunk);if(!(t||n))return;O=e,I="END",X();const l=document.getElementById("enemy-grid");l&&(l.style.pointerEvents="none"),We();const s=document.getElementById("game-over-modal"),i=document.getElementById("game-over-title"),c=document.getElementById("game-over-msg");e==="ç©å®¶"?(i.innerText="VICTORY",i.className="game-over-title win-text",c.innerText="æ­å–œæŒ‡æŒ¥å®˜ï¼æ•Œæ–¹èˆ°é˜Ÿå·²è¢«å…¨æ­¼ï¼"):(i.innerText="DEFEAT",i.className="game-over-title lose-text",c.innerText="å¾ˆé—æ†¾ï¼Œæˆ‘æ–¹èˆ°é˜Ÿå·²å…¨å†›è¦†æ²¡..."),setTimeout(()=>{s.style.display="block"},500)}function We(){A.forEach(e=>{pe(e)})}function pe(e){const t=document.getElementById("enemy-grid");if(t.querySelector(`.revealed-enemy-ship[data-id="${e.id}"]`))return;const n=document.createElement("div");n.className="ship revealed-enemy-ship ship-visuals-root",n.dataset.id=e.id,n.style.position="absolute",n.style.left=e.c*p+"px",n.style.top=e.r*p+"px",n.style.pointerEvents="none";const l=document.createElement("div");l.className="ship-inner",l.innerHTML=K(e.code),n.appendChild(l);const s=e.len*p+"px",i=p+"px";n.style.setProperty("--w",s),n.style.setProperty("--h",i),e.v?(n.classList.add("vertical"),n.style.width=p+"px",n.style.height=s):(n.style.width=s,n.style.height=p+"px"),e.sunk?n.classList.add("sunk"):(n.style.opacity="0.9",n.style.filter="drop-shadow(0 0 5px white)"),t.appendChild(n)}function Ze(){document.getElementById("game-over-modal").style.display="none"}function Ke(){document.getElementById("game-over-modal").style.display="none",de()}function b(e,t){const n=document.getElementById("log"),l=document.createElement("div");l.className=`log-line ${t}`,l.innerHTML=`[${new Date().toLocaleTimeString().split(" ")[0]}] ${e}`,n.prepend(l)}function W(){const e=document.getElementById("help-modal");e.style.display=e.style.display==="block"?"none":"block"}function Je(e){const t=e==="left",n=document.querySelector(t?".dock-panel":".log-panel"),l=document.querySelector(t?".toggle-left":".toggle-right");n.classList.toggle("panel-collapsed");const s=n.classList.contains("panel-collapsed");t?l.innerText=s?"â–¶":"â—€":l.innerText=s?"â—€":"â–¶"}function Qe(){const e=document.getElementById("rules-ship-table-body");e&&(e.innerHTML="",Z.forEach(t=>{const n=document.createElement("tr"),l=document.createElement("td"),s=document.createElement("div");s.className="ship-preview";const i=document.createElement("div");i.className="ship ship-visuals-root";const c=document.createElement("div");c.className="ship-inner",c.innerHTML=K(t.code),i.appendChild(c),Y({len:t.len,el:i,vertical:!1,inDock:!1}),s.appendChild(i),l.appendChild(s),n.appendChild(l);const o=document.createElement("td");o.innerText=t.code,n.appendChild(o);const a=document.createElement("td");a.innerText=t.name,n.appendChild(a);const d=document.createElement("td");d.innerText=t.len,n.appendChild(d);const r=document.createElement("td");r.innerText=t.maxHp,n.appendChild(r);const f=document.createElement("td");t.code==="CV"?f.innerHTML="è§£é” <b>ç©ºè¢­</b>":t.code==="DD"?f.innerHTML="è§£é” <b>æ°´å¬</b>":t.code==="BB"||t.code==="SS"?f.innerHTML="ä¸»ç‚®ä¼¤å®³ 3":t.code==="CL"?f.innerHTML="ä¸»ç‚®ä¼¤å®³ 2 (è‹¥BB/SSæ²‰æ²¡)":f.innerText="-",n.appendChild(f),e.appendChild(n)}))}window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("header h1");e&&(e.textContent=`${Ee} (${be})`),Le()});

</script>
  <style>
:root{--bg-color: #1a202c;--panel-bg: #2d3748;--water: #2b6cb0;--accent: #ed8936;--text: #e2e8f0;--cell-size: 40px}*{box-sizing:border-box}body{font-family:Segoe UI,sans-serif;background-color:var(--bg-color);color:var(--text);margin:0;height:100vh;display:flex;flex-direction:column;-webkit-user-select:none;user-select:none}header{height:50px;background:#171923;align-items:center;justify-content:center;box-shadow:0 2px 5px #00000080;z-index:50}h1{margin:0;font-size:1.2rem;color:var(--accent);letter-spacing:2px}.layout{display:flex;flex:1;height:calc(100vh - 50px)}.center-area{flex:1;display:flex;flex-direction:column;background:radial-gradient(#2c3e50 1px,transparent 1px);background-size:20px 20px;position:relative;overflow:hidden}.scroll-view{flex:1;overflow:auto;width:100%;display:flex;flex-direction:column;position:relative}.dock-panel{width:260px;min-width:260px;background:var(--panel-bg);border-right:1px solid #4a5568;display:flex;flex-direction:column;padding:15px;z-index:30;transition:all .3s cubic-bezier(.4,0,.2,1);overflow:hidden;white-space:nowrap}.dock-header{font-weight:700;color:#90cdf4;margin-bottom:10px;text-align:center}.dock-container{flex:1;background:#0003;border-radius:8px;padding:15px;display:flex;flex-direction:column;align-items:center;gap:15px;position:relative;overflow-y:auto}.battlefield{flex:0 0 auto;margin:auto;display:flex;justify-content:center;align-items:center;gap:40px;min-width:fit-content;padding:20px}.board-box{display:flex;flex-direction:column;align-items:center;flex-shrink:0}.board-title{margin-bottom:8px;font-weight:700}.bottom-controls{height:70px;background:#171923e6;border-top:1px solid #4a5568;display:flex;justify-content:center;align-items:center;gap:15px;padding:0 20px;z-index:40;box-shadow:0 -4px 10px #0000004d}.bottom-controls button{padding:10px 20px;font-size:14px;display:flex;align-items:center;gap:8px;min-width:120px;justify-content:center}.panel-collapsed{width:0!important;min-width:0!important;padding-left:0!important;padding-right:0!important;border:none!important;opacity:0}.toggle-btn{position:absolute;top:50%;transform:translateY(-50%);width:16px;height:40px;background:var(--panel-bg);border:1px solid #4a5568;color:var(--accent);display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:90;transition:all .2s;font-size:10px;box-shadow:0 2px 8px #0000004d;opacity:.8}.toggle-btn:hover{background:#4a5568;color:#fff;width:20px;opacity:1}.toggle-left{left:0;border-left:none;border-radius:0 12px 12px 0}.toggle-right{right:0;border-right:none;border-radius:12px 0 0 12px}.grid{display:grid;grid-template-columns:repeat(10,var(--cell-size));grid-template-rows:repeat(10,var(--cell-size));background-color:var(--water);border:4px solid #2c5282;box-shadow:0 10px 20px #0006;position:relative}.cell{width:var(--cell-size);height:var(--cell-size);border:1px solid rgba(255,255,255,.1);box-sizing:border-box;transition:background .1s;position:relative}#enemy-grid .cell{z-index:5}#player-grid .cell{z-index:auto}.cell.highlight-valid{background-color:#48bb78b3!important;box-shadow:inset 0 0 0 2px #fff}.cell.highlight-invalid{background-color:#f56565b3!important;box-shadow:inset 0 0 0 2px red}#enemy-grid .cell:hover:not(.hit):not(.miss):not(.destroyed):not(.detect){background-color:#fff3;cursor:crosshair}.hit{background-color:#ecc94b66!important;position:relative}.hit:after{content:"ğŸ’¥";position:absolute;top:0;right:0;bottom:0;left:0;display:flex;justify-content:center;align-items:center;font-size:18px;z-index:102}.destroyed{background-color:#e53e3e66!important;position:relative}.destroyed:after{content:"â˜ ï¸";position:absolute;top:0;right:0;bottom:0;left:0;display:flex;justify-content:center;align-items:center;font-size:18px;z-index:102}.detect{background-color:#ecc94b4d!important;position:relative}.detect:after{content:"â“";position:absolute;top:0;right:0;bottom:0;left:0;display:flex;justify-content:center;align-items:center;font-size:18px;z-index:102}.ai-detect{background-color:#ecc94b4d!important;position:relative}.ai-detect:after{content:"â“";position:absolute;top:0;right:0;bottom:0;left:0;display:flex;justify-content:center;align-items:center;font-size:18px;z-index:102}.miss{background-color:#ffffff1a!important;position:relative}.miss:after{content:"";position:absolute;width:10px;height:10px;border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%);background:#ffffff80;z-index:102}.attack-range-highlight{box-shadow:inset 0 0 0 2px #fc8181,0 0 10px #fc818180;background-color:#fc818133!important;z-index:60}.weapon-bar{display:flex;gap:8px;width:100%}.weapon-btn{flex:1;padding:10px 6px;font-size:12px;background:linear-gradient(to bottom,#2d3748,#1a202c);color:#cbd5e0;border:1px solid #4a5568;border-radius:6px;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px;transition:all .2s;box-shadow:0 2px 4px #0003}.weapon-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 8px #0000004d;border-color:#718096}.weapon-btn.active{background:linear-gradient(to bottom,#3182ce,#2b6cb0);color:#fff;border-color:#63b3ed;box-shadow:0 0 12px #4299e180;transform:translateY(-1px)}.weapon-btn:disabled{opacity:.5;cursor:not-allowed;background:#1a202c;filter:grayscale(1);border-color:#2d3748}.status-panel{display:flex;flex-direction:column;gap:8px;width:100%;margin-top:10px}.ship-status-row{display:flex;align-items:center;justify-content:space-between;padding:6px 8px;background:#0003;border-radius:4px;border-bottom:none;font-size:12px;margin-bottom:2px}.hp-blocks{display:flex;gap:4px}.hp-block{width:12px;height:6px;background:#48bb78;border-radius:2px;box-shadow:0 0 4px #48bb7866}.hp-block.dmg{background:#ecc94b;box-shadow:0 0 4px #ecc94b66}.hp-block.lost{background:#e53e3e;box-shadow:none;opacity:.3}.top-hit-marker{position:absolute;z-index:102;pointer-events:none;width:var(--cell-size);height:var(--cell-size);display:flex;justify-content:center;align-items:center;font-size:28px;text-shadow:0 0 5px #000}.log-panel{width:260px;min-width:260px;background:var(--panel-bg);border-left:1px solid #4a5568;display:flex;flex-direction:column;z-index:20;transition:all .3s cubic-bezier(.4,0,.2,1);overflow:hidden;white-space:nowrap}.log-header{padding:10px;background:#232936;text-align:center;font-weight:700;color:#90cdf4}.log-content{flex:1;overflow-y:auto;padding:10px;font-family:Consolas,monospace;font-size:12px}.log-line{margin-bottom:4px;border-bottom:1px solid #3a4657;padding-bottom:2px}.c-sys{color:#a0aec0}.c-p{color:#68d391}.c-e{color:#fc8181}.c-warn{color:var(--accent);font-weight:700}.ship{position:relative;z-index:100;cursor:grab;display:block;transition:top .1s,left .1s}.ship:not(.sunk):hover .ship-inner{filter:brightness(1.2) drop-shadow(0 0 5px rgba(255,255,255,.4))}.ship-inner{width:100%;height:100%;pointer-events:none;transform-origin:top left;transition:transform .2s}.ship.dragging{opacity:.7;cursor:grabbing;z-index:9999;position:fixed!important;pointer-events:none!important;transition:none!important;transform:scale(1.05);filter:drop-shadow(5px 5px 10px rgba(0,0,0,.5))}.ship.vertical{width:40px!important}.ship.vertical .ship-inner{width:var(--w)!important;height:var(--h)!important;transform:rotate(90deg) translateY(-100%)}.ship.sunk{filter:grayscale(100%) brightness(.8);border:1px solid red}@keyframes shake{0%,to{transform:translate(0)}25%{transform:translate(-5px)}75%{transform:translate(5px)}}.shake{animation:shake .2s ease-in-out 2}.wreck{position:absolute;border:2px solid #fc8181;background:#0000004d;pointer-events:none;z-index:10}.revealed-enemy-ship{z-index:1!important}.btn-area{margin-top:auto;display:flex;flex-direction:column;gap:8px}button{padding:10px;border:none;border-radius:4px;font-weight:700;cursor:pointer;transition:.2s;font-size:14px}.btn-mode{background:#805ad5;color:#fff;margin-bottom:5px}.btn-mode:hover{background:#6b46c1}.btn-mode:disabled{background:#553c9a;opacity:.5;cursor:not-allowed}.btn-blue{background:#4299e1;color:#fff}.btn-blue:hover{background:#3182ce}.btn-blue:disabled{background:#2c5282;opacity:.5;cursor:not-allowed}.btn-orange{background:var(--accent);color:#1a202c}.btn-orange:hover{background:#dd6b20}.btn-orange:disabled{background:#718096;cursor:not-allowed}.btn-restart{background:#9f7aea;color:#fff}.btn-restart:hover{background:#805ad5}.difficulty-bar{display:flex;gap:5px;margin-bottom:10px}.diff-btn{flex:1;padding:6px;font-size:12px;background:#2d3748;color:#a0aec0;border:1px solid #4a5568;cursor:pointer;transition:all .2s}.diff-btn:hover{background:#4a5568}.diff-btn.active{background:#38a169;color:#fff;border-color:#48bb78;box-shadow:0 0 5px #48bb7880}.cell.debug-heat:before{content:attr(data-heat);position:absolute;top:0;right:0;bottom:0;left:0;display:flex;justify-content:center;align-items:center;font-size:12px;font-weight:700;color:#fff;background:var(--heat-bg, rgba(255, 0, 0, .3));z-index:200;pointer-events:none;text-shadow:0 0 2px black}#help-btn{position:fixed;bottom:20px;right:20px;width:50px;height:50px;background:var(--accent);color:#1a202c;border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:24px;font-weight:700;cursor:pointer;box-shadow:0 4px 10px #00000080;z-index:1000;transition:transform .2s}#help-btn:hover{transform:scale(1.1)}.modal{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;background-color:#000c;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);animation:fadeIn .3s ease-out}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.modal-content{background:linear-gradient(135deg,#2d3748,#1a202c);margin:5% auto;padding:25px;border:1px solid #4a5568;width:80%;max-width:600px;border-radius:16px;position:relative;color:var(--text);max-height:80vh;overflow-y:auto;box-shadow:0 20px 50px #00000080;animation:slideIn .3s ease-out}@keyframes slideIn{0%{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1}}.close-btn{position:absolute;top:15px;right:20px;color:#718096;font-size:28px;font-weight:700;cursor:pointer;transition:color .2s}.close-btn:hover{color:#fc8181}.rules-table{width:100%;border-collapse:collapse;margin-bottom:15px;font-size:14px}.rules-table th,.rules-table td{border:1px solid #4a5568;padding:10px;text-align:left;vertical-align:middle}.rules-table th{background-color:#0000004d;color:var(--accent);font-weight:600}.rules-table tr:nth-child(2n){background-color:#ffffff05}.ship-preview{width:80px;height:30px;display:flex;align-items:center;justify-content:center;overflow:hidden}.ship-preview .ship-inner{pointer-events:none}.ship-preview .hull-scale-wrapper{transform:scale(.4)!important}.game-over-content{text-align:center;max-width:400px;padding:40px}.game-over-title{font-size:3rem;margin:0 0 20px;text-shadow:0 0 20px currentColor}.win-text{color:#48bb78}.lose-text{color:#fc8181}.control-group{margin-top:auto;display:flex;flex-direction:column;gap:8px;padding-top:10px;border-top:1px solid #4a5568}.btn-row{display:flex;gap:5px}.btn-row>*{flex:1}.btn-icon{padding:8px;font-size:16px}.difficulty-bar{margin-bottom:0}.ship-visuals-root{--color-sea: #1a2b3c;--color-steel-light: #cfd8dc;--color-steel-mid: #90a4ae;--color-steel-dark: #546e7a;--color-barrel: #263238;--deck-wood-bb: #8d6e63;--deck-flight: #455a64;--deck-dd: #607d8b;--hull-ss: #212121}.turret-base{position:absolute;top:50%;transform:translateY(-50%);z-index:10;display:flex;align-items:center;justify-content:center}.turret-bb{width:22px;height:20px;background:linear-gradient(to bottom,#eceff1,#90a4ae);border-radius:50% 4px 4px 50%;box-shadow:0 2px 3px #0006}.turret-bb:before{content:"";position:absolute;top:50%;transform:translateY(-50%);width:24px;height:3px;background:var(--color-barrel);box-shadow:0 -5px 0 var(--color-barrel),0 5px 0 var(--color-barrel);border-radius:0 2px 2px 0}.turret-bb:after{content:"";position:absolute;top:3px;bottom:3px;width:4px;background:#fff}.turret-cl{width:16px;height:14px;background:#b0bec5;border-radius:4px;box-shadow:0 1px 2px #0000004d}.turret-cl:before{content:"";position:absolute;top:4px;width:14px;height:2px;background:var(--color-barrel);box-shadow:0 4px 0 var(--color-barrel)}.turret-dd{width:12px;height:12px;background:#cfd8dc;border:1px solid #78909c;border-radius:50%}.turret-dd:before{content:"";position:absolute;top:5px;width:10px;height:2px;background:var(--color-barrel)}.turret-bb:before{left:-20px}.turret-cl:before{left:-10px}.turret-dd:before{left:-8px}.turret-bb:after{left:0}.facing-left .turret-bb,.facing-left .turret-cl,.facing-left .turret-dd{transform:rotate(0)}.facing-right .turret-bb,.facing-right .turret-cl,.facing-right .turret-dd{transform:rotate(180deg)}.hull-bb{width:240px;height:46px;background:repeating-linear-gradient(90deg,#795548,#795548 4px,#5d4037 5px);border-radius:50% 15% 15% 50%;position:relative;overflow:hidden;box-shadow:inset 0 0 0 3px var(--color-steel-mid)}.bb-bridge-complex{position:absolute;left:85px;top:4px;bottom:4px;width:60px;background:#0003;border-radius:4px;z-index:5}.bb-tower{position:absolute;left:0;top:-2px;bottom:-2px;width:25px;background:var(--color-steel-light);border:1px solid var(--color-steel-dark);border-radius:4px;box-shadow:2px 2px 4px #0006}.bb-funnel{position:absolute;right:5px;top:8px;bottom:8px;width:18px;background:repeating-linear-gradient(to bottom,#37474f,#37474f 4px,#263238 5px);border-radius:6px;border:1px solid #fff}.bb-stern-equipment{position:absolute;right:10px;top:0;bottom:0;width:40px;z-index:1}.bb-catapult-rail{position:absolute;top:10px;bottom:10px;left:0;width:20px;border-top:2px solid #5d4037;border-bottom:2px solid #5d4037;opacity:.7}.bb-crane{position:absolute;right:5px;bottom:12px;width:25px;height:4px;background:var(--color-steel-dark);transform:rotate(-45deg);border-radius:2px;box-shadow:1px 1px 2px #00000080}.bb-floatplane{position:absolute;left:5px;top:50%;transform:translateY(-50%);width:12px;height:10px;background:#4caf50;clip-path:polygon(50% 0,100% 50%,50% 100%,0 50%)}.hull-cv{width:240px;height:50px;background:var(--deck-flight);border-radius:4px;position:relative;background-image:linear-gradient(90deg,transparent 20%,rgba(255,255,255,.9) 20%,rgba(255,255,255,.9) 80%,transparent 80%),linear-gradient(to bottom,transparent 5%,rgba(255,255,255,.1) 5%,rgba(255,255,255,.1) 95%,transparent 95%);background-size:30px 3px,100% 100%;background-repeat:repeat-x,no-repeat;background-position:center,center}.cv-island{position:absolute;right:55px;top:-6px;width:45px;height:14px;background:var(--color-steel-dark);border-radius:2px;z-index:20;box-shadow:3px 3px 5px #00000080;border-right:6px solid #263238}.cv-elevator{position:absolute;left:60px;top:6px;width:35px;height:38px;border:1px dashed rgba(255,255,255,.4);background:#0003}.cv-sponson{position:absolute;left:10px;bottom:-4px;width:40px;height:6px;background:var(--color-steel-mid);border-radius:0 0 4px 4px}.cv-arrow{position:absolute;left:5px;top:50%;transform:translateY(-50%);width:0;height:0;border-top:6px solid transparent;border-bottom:6px solid transparent;border-right:10px solid #fff}.hull-cl{width:170px;height:32px;background:var(--color-steel-mid);background-image:repeating-linear-gradient(90deg,transparent,transparent 19px,rgba(0,0,0,.1) 20px);border-radius:50% 10% 10% 50%;position:relative;box-shadow:inset 0 0 0 2px var(--color-steel-dark)}.cl-bridge-area{position:absolute;left:50px;right:40px;top:0;bottom:0}.cl-block{position:absolute;left:0;top:2px;bottom:2px;width:15px;background:var(--color-steel-dark);border-radius:2px}.cl-funnel{position:absolute;width:8px;height:18px;background:#37474f;border-radius:4px;top:7px}.hull-dd{width:120px;height:22px;background:var(--deck-dd);border-radius:100px 3px 3px 100px;position:relative;display:flex;align-items:center}.dd-mid{position:absolute;left:35px;right:30px;height:100%}.dd-structure{position:absolute;top:6px;width:8px;height:10px;background:#546e7a;border-radius:2px}.dd-torpedo{position:absolute;top:5px;width:12px;height:12px;background:linear-gradient(90deg,#455a64,#263238);border-radius:2px}.hull-ss{width:60px;height:14px;background:var(--hull-ss);border-radius:10px;position:relative;box-shadow:inset 0 2px 4px #ffffff1a}.ss-tower{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:8px;height:22px;background:#333;border-radius:2px;border-top:1px solid #666}.ss-periscope{position:absolute;right:-2px;top:0;width:2px;height:6px;background:#999}.ship-inner{display:flex;align-items:center;justify-content:center;overflow:visible}.hull-scale-wrapper{transform-origin:center center;transform:scale(.66)}

</style>
</head>
<body>
  <header>
    <h1>æŒ‡æŒ¥å®˜ï¼šå†³æˆ˜å¤§æ´‹ (v7.0alpha)</h1>
  </header>

  <div id="help-btn" data-action="toggle-help">?</div>

  <div id="help-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn" data-action="toggle-help">&times;</span>
      <h2 style="color: var(--accent); text-align: center; margin-top: 0;">æ¸¸æˆè§„åˆ™è¯´æ˜</h2>

      <h3>1. èƒœåˆ©æ¡ä»¶</h3>
      <p>ç‡å…ˆå‡»æ²‰æ•Œæ–¹æ‰€æœ‰ 5 è‰˜èˆ°èˆ¹çš„ä¸€æ–¹è·èƒœã€‚</p>

      <h3>2. èˆ°èˆ¹å±æ€§</h3>
      <table class="rules-table">
        <thead>
          <tr><th>å›¾ç¤º</th><th>ä»£å·</th><th>åç§°</th><th>é•¿åº¦</th><th>è¡€é‡/æ ¼</th><th>ç‰¹æ®Šèƒ½åŠ›</th></tr>
        </thead>
        <tbody id="rules-ship-table-body"></tbody>
      </table>

      <h3>3. æ­¦å™¨ç³»ç»Ÿ</h3>
      <table class="rules-table">
        <tr><th>æ­¦å™¨</th><th>èŒƒå›´</th><th>ä¼¤å®³</th><th>è¯´æ˜</th></tr>
        <tr><td><b>ä¸»ç‚®</b></td><td>å•ç‚¹</td><td>1~3</td><td>åŸºç¡€æ”»å‡»ã€‚ä¼¤å®³å–å†³äºå­˜æ´»èˆ°èˆ¹(BB/SS=3, CL=2, å…¶ä»–=1)ã€‚</td></tr>
        <tr><td><b>ç©ºè¢­</b></td><td>Xå‹ (5æ ¼)</td><td>1</td><td>éœ€èˆªæ¯(CV)å­˜æ´»ã€‚å¯¹ä¸­å¿ƒåŠå››è§’é€ æˆä¼¤å®³ã€‚</td></tr>
        <tr><td><b>æ°´å¬</b></td><td>3x3 åŒºåŸŸ</td><td>0</td><td>éœ€é©±é€(DD)å­˜æ´»ã€‚æ¢æµ‹åŒºåŸŸå†…æ˜¯å¦æœ‰èˆ¹ã€‚è‹¥æœ‰ï¼Œæ˜¾ç¤ºä¸­å¿ƒçœŸå®çŠ¶æ€ï¼Œå¹¶æ ‡è®°å‘¨å›´ä¸ºç–‘ä¼¼ã€‚</td></tr>
      </table>

      <h3>4. çŠ¶æ€æ ‡è¯†</h3>
      <ul style="font-size: 14px; line-height: 1.6;">
        <li>ğŸŒŠ <b>ç©ºç™½</b>ï¼šæœªçŸ¥æµ·åŸŸã€‚</li>
        <li>âšª <b>æ°´èŠ±</b>ï¼šæœªå‘½ä¸­ (Miss)ã€‚</li>
        <li>â“ <b>é—®å·</b>ï¼šç–‘ä¼¼ç›®æ ‡ (å£°å‘æ‰«æç»“æœ)ã€‚</li>
        <li>ğŸ’¥ <b>å†’çƒŸ</b>ï¼šå—æŸ (Hit)ï¼Œèˆ¹è¿˜åœ¨ã€‚</li>
        <li>â˜ ï¸ <b>çº¢å‰</b>ï¼šæ¯å (Destroyed)ï¼Œè¯¥æ ¼è¡€é‡å½’é›¶ã€‚</li>
      </ul>
    </div>
  </div>

  <div id="game-over-modal" class="modal">
    <div class="modal-content game-over-content">
      <h2 id="game-over-title" class="game-over-title"></h2>
      <p id="game-over-msg" style="font-size: 1.2rem; margin-bottom: 30px; color: #cbd5e0;"></p>
      <div style="display: flex; gap: 10px; justify-content: center;">
        <button class="btn-blue" data-action="view-battlefield" style="font-size: 1.2rem; padding: 12px 20px;">ğŸ‘€ æŸ¥çœ‹æˆ˜åœº</button>
        <button class="btn-restart" data-action="restart-game" style="font-size: 1.2rem; padding: 12px 20px;">ğŸ”„ é‡æ–°å¼€å§‹</button>
      </div>
    </div>
  </div>

  <div class="layout">
    <div class="dock-panel">
      <div class="dock-header">âš“ è£…å¤‡åŒº</div>

      <div id="battle-panel" class="dock-container" style="display: none; align-items: stretch;">
        <div class="weapon-bar" id="weapon-bar">
          <button class="weapon-btn active" id="btn-ap" data-weapon="AP">
            <span>ğŸ’¥ ä¸»ç‚®</span>
            <span id="ap-desc" style="font-size:10px; opacity:0.8">å•ç‚¹ 3ä¼¤</span>
          </button>
          <button class="weapon-btn" id="btn-he" data-weapon="HE">
            <span>âœˆï¸ ç©ºè¢­</span>
            <span style="font-size:10px; opacity:0.8">èŒƒå›´ 1ä¼¤</span>
          </button>
          <button class="weapon-btn" id="btn-sonar" data-weapon="SONAR">
            <span>ğŸ“¡ æ°´å¬</span>
            <span style="font-size:10px; opacity:0.8">ä¾¦æŸ¥ 3x3</span>
          </button>
        </div>

        <div class="status-panel" id="status-panel">
          <div style="text-align:center; color:#90cdf4; font-weight:bold; margin-bottom:5px">èˆ°é˜ŸçŠ¶æ€</div>
          <div id="ship-status-list"></div>
        </div>
      </div>

      <div class="dock-container" id="dock"></div>

      <div class="control-group">
        <div style="font-size: 12px; color: #a0aec0; margin-bottom: 2px;">AI éš¾åº¦</div>
        <div class="difficulty-bar" id="diff-bar">
          <button class="diff-btn" data-difficulty="EASY">æ–°å…µ (ç®€å•)</button>
          <button class="diff-btn" data-difficulty="NORMAL">èˆ°é•¿ (å›°éš¾)</button>
          <button class="diff-btn active" data-difficulty="HARD">æç£ (å†·é…·)</button>
        </div>

        <div class="btn-row">
          <button class="btn-mode" id="rotate-toggle" title="åˆ‡æ¢éƒ¨ç½²æ–¹å‘">æ–¹å‘ï¼šæ°´å¹³ â®•</button>
          <button class="btn-mode" id="first-turn-toggle" title="åˆ‡æ¢å…ˆæ‰‹">å…ˆæ‰‹ï¼šç©å®¶ ğŸ‘¤</button>
        </div>
      </div>
    </div>

    <div class="center-area">
      <div class="toggle-btn toggle-left" data-panel-toggle="left" title="åˆ‡æ¢è£…å¤‡åŒº">â—€</div>
      <div class="toggle-btn toggle-right" data-panel-toggle="right" title="åˆ‡æ¢æ—¥å¿—åŒº">â–¶</div>

      <div class="scroll-view">
        <div class="battlefield">
          <div class="board-box">
            <div class="board-title" style="color:#68d391">æˆ‘æ–¹æµ·åŸŸ</div>
            <div id="player-grid" class="grid"></div>
          </div>
          <div class="board-box">
            <div class="board-title" style="color:#fc8181">æ•Œæ–¹æµ·åŸŸ</div>
            <div id="enemy-grid" class="grid"></div>
          </div>
        </div>
      </div>

      <div class="bottom-controls">
        <button class="btn-mode" id="btn-debug" title="AI è§†è§’ (Debug)">ğŸ§  AI è§†è§’(åˆ«è¯´æˆ‘ä½œå¼Šå“ˆ)</button>
        <button id="btn-reset" class="btn-blue" title="å…¨éƒ¨å›æ¸¯">ğŸ”„ å…¨éƒ¨å›æ¸¯</button>
        <button id="btn-random" class="btn-blue" title="éšæœºéƒ¨ç½²">ğŸ² éšæœºéƒ¨ç½²</button>
        <button class="btn-orange" id="start-btn" disabled>ğŸš€ å¼€å§‹æˆ˜æ–—</button>
      </div>
    </div>

    <div class="log-panel">
      <div class="log-header">âš¡ æˆ˜å†µè®°å½•</div>
      <div id="log" class="log-content">
        <div class="log-line c-sys">æ‹–æ‹½éƒ¨ç½²ï¼Œç»¿è‰²åŒºåŸŸä¸ºæœ‰æ•ˆã€‚</div>
        <div class="log-line c-sys">å‡†å¤‡å°±ç»ªåç‚¹å‡»å¼€å§‹ã€‚</div>
      </div>
    </div>
  </div>

</body>
</html>
