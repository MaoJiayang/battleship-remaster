<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ÊåáÊå•ÂÆòÔºöÂÜ≥ÊàòÂ§ßÊ¥ã</title>
  <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function l(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=l(s);fetch(s.href,i)}})();const m=10,$e=40,Ye="Êµ∑ÊùÉ:ÂÜ≥ÊàòÊ∑±Ëìù",Oe="v2.2Œ±",J={MOBILE_BREAKPOINT:768,MOBILE:{VIEW_SWITCH_DELAY:750,AI_ACTION_DELAY:1500,TURN_BACK_DELAY:1e3},DESKTOP:{VIEW_SWITCH_DELAY:0,AI_ACTION_DELAY:200,TURN_BACK_DELAY:0}},te=[{name:"Ëà™Á©∫ÊØçËà∞",len:4,maxHp:2,code:"CV",type:"carrier"},{name:"ÊàòÂàóËà∞",len:4,maxHp:3,code:"BB",type:"battleship"},{name:"ËΩªÂ∑°Ê¥ãËà∞",len:3,maxHp:1,code:"CL",type:"cruiser"},{name:"ÊΩúËâá",len:1,maxHp:2,code:"SS",type:"sub"},{name:"È©±ÈÄêËà∞",len:2,maxHp:1,code:"DD",type:"destroyer"}],he={EASY:{hitFocus:.3,sonarFocus:.2,airstrikeAdvantage:1.5,sonarEntropyGate:.3,randomness:.5},NORMAL:{hitFocus:2,sonarFocus:1.2,airstrikeAdvantage:1.1,sonarEntropyGate:.15,randomness:.3},HARD:{hitFocus:5.5,sonarFocus:2,airstrikeAdvantage:.85,sonarEntropyGate:.05,randomness:0}},pe="EASY";function $(){const e=document.querySelector(".cell");let t=e?e.getBoundingClientRect().width:0;if(!t||t===0)if(window.innerWidth<=768){const l=window.innerWidth*.085;t=Math.max(26,Math.min(l,34))}else t=$e;return t}function ne(){return window.innerWidth<=J.MOBILE_BREAKPOINT?J.MOBILE:J.DESKTOP}function le(e){let t="";return e==="BB"?t=`
                <div class="hull-scale-wrapper" data-original-width="240">
                    <div class="hull-bb">
                        <div class="turret-base facing-left" style="left: 25px;"><div class="turret-bb"></div></div>
                        <div class="turret-base facing-left" style="left: 52px; z-index: 11;"><div class="turret-bb"></div></div>
                        <div class="bb-bridge-complex">
                            <div class="bb-tower"></div>
                            <div class="bb-funnel"></div>
                        </div>
                        <div class="turret-base facing-right" style="right: 60px; z-index: 11;"><div class="turret-bb"></div></div>
                        <div class="bb-stern-equipment">
                            <div class="bb-catapult-rail"></div>
                            <div class="bb-floatplane"></div>
                            <div class="bb-crane"></div>
                        </div>
                    </div>
                </div>`:e==="CV"?t=`
                <div class="hull-scale-wrapper" data-original-width="240">
                    <div class="hull-cv">
                        <div class="cv-arrow"></div>
                        <div class="cv-elevator"></div>
                        <div class="cv-island"></div>
                        <div class="cv-sponson"></div>
                    </div>
                </div>`:e==="CL"?t=`
                <div class="hull-scale-wrapper" data-original-width="170">
                    <div class="hull-cl">
                        <div class="turret-base facing-left" style="left: 15px;"><div class="turret-cl"></div></div>
                        <div class="turret-base facing-left" style="left: 35px; z-index:11"><div class="turret-cl"></div></div>
                        <div class="cl-bridge-area">
                            <div class="cl-block"></div>
                            <div class="cl-funnel" style="left: 25px;"></div>
                            <div class="cl-funnel" style="left: 45px;"></div>
                        </div>
                        <div class="turret-base facing-right" style="right: 35px; z-index:11"><div class="turret-cl"></div></div>
                        <div class="turret-base facing-right" style="right: 15px;"><div class="turret-cl"></div></div>
                    </div>
                </div>`:e==="DD"?t=`
                <div class="hull-scale-wrapper" data-original-width="120">
                    <div class="hull-dd">
                        <div class="turret-base facing-left" style="left: 10px;"><div class="turret-dd"></div></div>
                        <div class="turret-base facing-left" style="left: 24px; z-index:11"><div class="turret-dd"></div></div>
                        <div class="dd-mid">
                            <div class="dd-structure" style="left: 0px;"></div>
                            <div class="dd-torpedo" style="left: 12px;"></div>
                            <div class="dd-structure" style="left: 28px;"></div>
                            <div class="dd-torpedo" style="left: 40px;"></div>
                        </div>
                        <div class="turret-base facing-right" style="right: 10px;"><div class="turret-dd"></div></div>
                    </div>
                </div>`:e==="SS"&&(t=`
                <div class="hull-scale-wrapper" data-original-width="60">
                    <div class="hull-ss">
                        <div class="ss-tower">
                            <div class="ss-periscope"></div>
                        </div>
                    </div>
                </div>`),t}let L="SETUP",b=[],x=[],W=q(),w=[],G="horizontal",C="AP",F="PLAYER",N=!1,z=null,O=null;function Re(){Ee(),T("player"),We(),qe(),document.addEventListener("mouseup",xe),document.addEventListener("mousemove",Be),document.addEventListener("touchend",Xe,{passive:!1}),document.addEventListener("touchmove",Ue,{passive:!1}),window.addEventListener("resize",()=>{b.forEach(e=>Y(e)),document.querySelectorAll(".revealed-enemy-ship").forEach(e=>{const t=parseInt(e.dataset.id),l=x.find(n=>n.id===t);l&&ut(e,l)})}),vt(),Me(we,{silent:!0}),T("player")}function q(){return Array(m).fill(0).map(()=>Array(m).fill(0))}function Ee(){const e=document.getElementById("player-grid"),t=document.getElementById("enemy-grid");e.innerHTML="",t.innerHTML="";for(let l=0;l<m;l++)for(let n=0;n<m;n++){let s=document.createElement("div");s.className="cell",s.dataset.r=l,s.dataset.c=n,e.appendChild(s);let i=document.createElement("div");i.className="cell",i.dataset.r=l,i.dataset.c=n,i.onclick=()=>tt(l,n),i.onmouseenter=()=>_e(l,n),i.onmouseleave=()=>be(),t.appendChild(i)}}function qe(){const e=document.getElementById("help-btn");e&&(localStorage.getItem("hasClickedHelp")||e.classList.add("pulse-highlight"),e.addEventListener("click",()=>{e.classList.remove("pulse-highlight"),localStorage.setItem("hasClickedHelp","true"),V()}));const t=document.getElementById("btn-menu-toggle"),l=document.getElementById("settings-modal");t&&l&&t.addEventListener("click",()=>{l.style.display="block"});const n=document.getElementById("help-modal");if(n){n.addEventListener("click",E=>{E.target===n&&V()});const g=n.querySelector(".close-btn");g&&g.addEventListener("click",V)}document.querySelectorAll("[data-weapon]").forEach(g=>{g.addEventListener("click",()=>{j(g.dataset.weapon),window.innerWidth<=768&&document.getElementById("weapon-bar").classList.remove("show")})}),document.querySelectorAll("[data-difficulty]").forEach(g=>{g.addEventListener("click",()=>Me(g.dataset.difficulty))});const s=document.getElementById("rotate-toggle");s&&s.addEventListener("click",Ve);const i=document.getElementById("first-turn-toggle");i&&i.addEventListener("click",fe),document.querySelectorAll("[data-panel-toggle]").forEach(g=>{g.addEventListener("click",()=>gt(g.dataset.panelToggle))});const o=document.getElementById("btn-debug");o&&o.addEventListener("click",ye);const c=document.getElementById("btn-reset");c&&c.addEventListener("click",R);const a=document.getElementById("btn-random");a&&a.addEventListener("click",ge);const r=document.getElementById("start-btn");r&&r.addEventListener("click",ve);const d=document.querySelector('[data-action="view-battlefield"]');d&&d.addEventListener("click",ft);const u=document.querySelector('[data-action="restart-game"]');u&&u.addEventListener("click",yt);const f=document.getElementById("btn-settings");if(f&&l){f.addEventListener("click",()=>{l.style.display="block"}),l.addEventListener("click",He=>{He.target===l&&(l.style.display="none")});const g=l.querySelector(".close-btn");g&&g.addEventListener("click",()=>l.style.display="none");const E=document.getElementById("mobile-first-turn");E&&E.addEventListener("click",fe);const I=document.getElementById("mobile-debug");I&&I.addEventListener("click",ye);const k=document.getElementById("mobile-reset");k&&k.addEventListener("click",()=>{R(),l.style.display="none"});const re=document.getElementById("mobile-menu-restart");re&&re.addEventListener("click",()=>{L==="PLAYING"||L==="END"?confirm("Á°ÆÂÆöË¶ÅÈáçÊñ∞ÂºÄÂßãÂêóÔºü")&&(X(),l.style.display="none"):(X(),l.style.display="none")});const de=document.getElementById("mobile-menu-random");de&&de.addEventListener("click",()=>{ge(),l.style.display="none"});const me=document.getElementById("mobile-menu-reset");me&&me.addEventListener("click",()=>{R(),l.style.display="none"});const ue=document.getElementById("mobile-menu-help");ue&&ue.addEventListener("click",()=>{l.style.display="none",V()})}const h=document.getElementById("tab-view-player"),p=document.getElementById("tab-view-enemy");h&&h.addEventListener("click",()=>T("player")),p&&p.addEventListener("click",()=>T("enemy"));const M=document.getElementById("mb-tab-player"),S=document.getElementById("mb-tab-enemy");M&&M.addEventListener("click",()=>T("player")),S&&S.addEventListener("click",()=>T("enemy"));const y=document.getElementById("mb-btn-start");y&&y.addEventListener("click",ve);const v=document.getElementById("mb-btn-weapon");v&&v.addEventListener("click",()=>{document.getElementById("weapon-bar").classList.toggle("show")})}function T(e){const t=document.getElementById("player-board-box"),l=document.getElementById("enemy-board-box"),n=document.getElementById("tab-view-player"),s=document.getElementById("tab-view-enemy"),i=document.getElementById("mb-tab-player"),o=document.getElementById("mb-tab-enemy");t.classList.remove("active-view"),l.classList.remove("active-view"),n&&n.classList.remove("active"),s&&s.classList.remove("active"),i&&i.classList.remove("active"),o&&o.classList.remove("active"),e==="player"?(t.classList.add("active-view"),n&&n.classList.add("active"),i&&i.classList.add("active")):(l.classList.add("active-view"),s&&s.classList.add("active"),o&&o.classList.add("active"))}function _e(e,t){if(L!=="PLAYING"||document.getElementById("enemy-grid").style.pointerEvents==="none")return;be();let l=[];if(C==="AP")l.push({r:e,c:t});else if(C==="HE")[[0,0],[-1,-1],[-1,1],[1,-1],[1,1]].forEach(i=>{l.push({r:e+i[0],c:t+i[1]})});else if(C==="SONAR")for(let s=-1;s<=1;s++)for(let i=-1;i<=1;i++)l.push({r:e+s,c:t+i});const n=document.getElementById("enemy-grid");l.forEach(s=>{if(s.r>=0&&s.r<m&&s.c>=0&&s.c<m){const i=n.querySelector(`.cell[data-r="${s.r}"][data-c="${s.c}"]`);i&&i.classList.add("attack-range-highlight")}})}function be(){document.getElementById("enemy-grid").querySelectorAll(".attack-range-highlight").forEach(t=>{t.classList.remove("attack-range-highlight")})}function We(){const e=document.getElementById("dock");b=[],e.innerHTML="",te.forEach((t,l)=>{const n=document.createElement("div");n.className="ship ship-visuals-root",n.title=`${t.name} (ÈïøÂ∫¶:${t.len})`,n.style.position="relative";const s=document.createElement("div");s.className="ship-inner",s.innerHTML=le(t.code),n.appendChild(s);const i={id:l,name:t.name,len:t.len,maxHp:t.maxHp,code:t.code,hp:Array(t.len).fill(t.maxHp),el:n,inDock:!0,vertical:!1,r:-1,c:-1,sunk:!1};Y(i),n.onclick=o=>{K||L==="SETUP"&&!i.inDock&&Ke(i)},n.onmousedown=o=>Ie(o,i),n.ontouchstart=o=>ze(o,i),e.appendChild(n),b.push(i)})}function se(e,t,l){const n=e.querySelector(".hull-scale-wrapper");if(!n)return;const s=parseFloat(n.dataset.originalWidth);if(!s)return;const o=t*l/s*.95;n.style.transform=`scale(${o})`}function Y(e,t=!1){const l=$(),n=e.len*l+"px",s=l+"px";e.el.style.setProperty("--w",n),e.el.style.setProperty("--h",s),se(e.el,e.len,l),e.vertical&&(!e.inDock||t)?(e.el.classList.add("vertical"),e.el.style.width=l+"px",e.el.style.height=n):(e.el.classList.remove("vertical"),e.el.style.width=n,e.el.style.height=l+"px"),!e.inDock&&!t&&(e.el.style.left=e.c*l+"px",e.el.style.top=e.r*l+"px")}function Ve(){G=G==="horizontal"?"vertical":"horizontal";const e=document.getElementById("rotate-toggle");e.innerText=G==="horizontal"?"ÈÉ®ÁΩ≤ÊñπÂêë:Ê∞¥Âπ≥‚Æï":"ÈÉ®ÁΩ≤ÊñπÂêë:ÂûÇÁõ¥‚¨á",b.forEach(t=>{t.inDock&&(t.vertical=G==="vertical")})}function fe(){F=F==="PLAYER"?"AI":"PLAYER";const e=F==="PLAYER"?"ÂÖàÊâãÔºöÁé©ÂÆ∂ üë§":"ÂÖàÊâãÔºöÁîµËÑë ü§ñ",t=document.getElementById("first-turn-toggle");t&&(t.innerText=e);const l=document.getElementById("mobile-first-turn");l&&(l.innerText=e)}function ye(){N=!N;const e=N?"üß† AI ËßÜËßí: ÂºÄÂêØ":"üß† AI ËßÜËßí: ÂÖ≥Èó≠",t=N?"#ed8936":"",l=document.getElementById("btn-debug");l&&(l.innerText=e,l.style.background=t);const n=document.getElementById("mobile-debug");n&&(n.innerText=e,n.style.background=t),N?Le():Fe()}function Le(e=null){if(!N)return;const t=Ce(),l=b.filter(i=>!i.sunk),n=e||De(t,l),s=document.getElementById("player-grid");for(let i=0;i<m;i++)for(let o=0;o<m;o++){const c=s.querySelector(`.cell[data-r="${i}"][data-c="${o}"]`),a=n[i][o]||0;c.classList.remove("debug-heat"),c.removeAttribute("data-heat"),c.style.removeProperty("--heat-bg");const r=Math.min(1,Math.max(0,a));if(r>0){c.setAttribute("data-heat",`${(r*100).toFixed(1)}%`),c.classList.add("debug-heat");const d=.1+r*.6,u=Math.floor(255*r),f=Math.floor(255*(1-r));c.style.setProperty("--heat-bg",`rgba(${u}, 0, ${f}, ${d})`)}}}function Fe(){document.getElementById("player-grid").querySelectorAll(".debug-heat").forEach(t=>{t.classList.remove("debug-heat"),t.removeAttribute("data-heat"),t.style.removeProperty("--heat-bg")})}let D=null,A={x:0,y:0},K=!1,P=null;function ie(e){return e.touches&&e.touches.length>0?{x:e.touches[0].clientX,y:e.touches[0].clientY}:e.changedTouches&&e.changedTouches.length>0?{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:{x:e.clientX,y:e.clientY}}function ze(e,t){if(e.touches.length>1)return;e.cancelable&&e.preventDefault();const l=ie(e),n={button:0,preventDefault:()=>{},clientX:l.x,clientY:l.y,target:e.target};Ie(n,t)}function Ie(e,t){if(L!=="SETUP"||e.button!==0)return;e.preventDefault(),D=t,K=!1,P=null;const l=t.el.getBoundingClientRect();let n=e.clientX-l.left,s=e.clientY-l.top;t.el.classList.add("dragging");const i=t.inDock&&G==="vertical";t.inDock&&(t.vertical=G==="vertical"),Y(t,!0),i?(A.x=s,A.y=n):(A.x=n,A.y=s),t.el.style.left=e.clientX-A.x+"px",t.el.style.top=e.clientY-A.y+"px",document.body.appendChild(t.el),t.inDock||ke(t)}function Ue(e){if(!D)return;e.cancelable&&e.preventDefault();const t=ie(e),l={clientX:t.x,clientY:t.y};Be(l)}function Be(e){if(!D)return;K=!0;const t=D;t.el.style.left=e.clientX-A.x+"px",t.el.style.top=e.clientY-A.y+"px",Ae();const l=document.elementFromPoint(e.clientX,e.clientY);if(!l){P=null;return}const n=l.closest(".cell"),s=document.getElementById("player-grid"),i=$();if(n&&s.contains(n)){const o=s.getBoundingClientRect(),c=e.clientX-A.x,a=e.clientY-A.y,r=c-o.left+i/2,d=a-o.top+i/2,u=Math.floor(r/i),f=Math.floor(d/i);je(t,f,u)}else P=null}function Xe(e){if(!D)return;const t=ie(e),l={clientX:t.x,clientY:t.y};xe(l)}function xe(e){if(!D)return;const t=D;t.el.classList.remove("dragging");const n=document.getElementById("player-grid").getBoundingClientRect(),s=$(),i=e.clientX>=n.left&&e.clientX<=n.right&&e.clientY>=n.top&&e.clientY<=n.bottom,o=P&&P.shipId===t.id?P:null;Ae(),P=null;let c=!1;if(o&&_(o.r,o.c,t.len,o.vertical))U(t,o.r,o.c,o.vertical),c=!0;else if(i){const a=e.clientX-A.x,r=e.clientY-A.y,d=a-n.left+s/2,u=r-n.top+s/2,f=Math.floor(d/s),h=Math.floor(u/s);_(h,f,t.len,t.vertical)&&(U(t,h,f,t.vertical),c=!0)}c||(Se(t),i&&B("Êó†Êïà‰ΩçÁΩÆÔºöÈáçÂè†ÊàñË∂äÁïå","c-warn")),D=null,setTimeout(()=>K=!1,50),ce()}function je(e,t,l){const n=e.len,s=e.vertical,i=_(t,l,n,s),o=i?"highlight-valid":"highlight-invalid";let c=!1;for(let a=0;a<n;a++){const r=s?t+a:t,d=s?l:l+a,u=document.querySelector(`#player-grid .cell[data-r="${r}"][data-c="${d}"]`);u&&(u.classList.add(o),c=!0)}i&&c?P={shipId:e.id,r:t,c:l,vertical:s}:P=null}function Ae(){document.querySelectorAll(".highlight-valid, .highlight-invalid").forEach(e=>{e.classList.remove("highlight-valid"),e.classList.remove("highlight-invalid")})}function U(e,t,l,n){const s=document.getElementById("player-grid"),i=$();e.inDock=!1,e.r=t,e.c=l,e.vertical=n,e.el.style.transition="none",e.el.style.position="absolute",e.el.style.margin="0",s.appendChild(e.el),Y(e),e.el.style.left=l*i+"px",e.el.style.top=t*i+"px",e.el.offsetWidth,e.el.style.transition="",oe(e,1)}function Se(e){const t=document.getElementById("dock");e.el.style.transition="none",e.inDock=!0,e.r=-1,e.c=-1,e.sunk=!1,e.hp=Array(e.len).fill(e.maxHp),e.el.classList.remove("sunk"),e.vertical=G==="vertical",e.el.style.position="relative",e.el.style.left="auto",e.el.style.top="auto",e.el.style.margin="0",Y(e),t.appendChild(e.el),e.el.offsetWidth,e.el.style.transition=""}function Ke(e){const t=!e.vertical;ke(e),_(e.r,e.c,e.len,t)?U(e,e.r,e.c,t):(oe(e,1),Ze(e.el),B("ÊóãËΩ¨Á©∫Èó¥‰∏çË∂≥","c-warn"))}function Ze(e){e.classList.remove("shake"),e.offsetWidth,e.classList.add("shake")}function _(e,t,l,n,s){if(e<0||t<0)return!1;if(n){if(e+l>m||t>=m)return!1}else if(t+l>m||e>=m)return!1;for(let i=0;i<l;i++){let o=n?e+i:e,c=n?t:t+i;if(W[o][c]===1)return!1}return!0}function oe(e,t){for(let l=0;l<e.len;l++){let n=e.vertical?e.r+l:e.r,s=e.vertical?e.c:e.c+l;n<m&&s<m&&(W[n][s]=t)}}function ke(e){oe(e,0)}function R(){W=q(),b.forEach(e=>Se(e)),ce()}function ge(){R(),setTimeout(()=>{b.forEach(e=>{let t=!1,l=0;for(;!t&&l<200;){let n=Math.floor(Math.random()*m),s=Math.floor(Math.random()*m),i=Math.random()>.5;_(n,s,e.len,i)&&(U(e,n,s,i),t=!0),l++}}),ce()},50)}function ce(){const e=b.every(n=>!n.inDock),t=document.getElementById("start-btn"),l=document.getElementById("mb-btn-start");L==="SETUP"&&(t.disabled=!e,l&&(l.disabled=!e),e?t.className="btn-orange":t.disabled=!0)}function ve(){document.getElementById("start-btn"),L==="PLAYING"||L==="END"?confirm("Á°ÆÂÆöË¶ÅÁªìÊùüÂΩìÂâçÊàòÊñóÂπ∂ÈáçÊñ∞ÂºÄÂßãÂêóÔºü")&&X():Je()}function X(){document.body.classList.remove("game-playing"),Z(),z=null,L="SETUP",document.getElementById("dock").style.display="flex",document.getElementById("battle-panel").style.display="none";const e=document.getElementById("mb-deploy-group"),t=document.getElementById("mb-combat-group");e&&(e.style.display="flex"),t&&(t.style.display="none"),document.getElementById("dock").style.pointerEvents="auto",document.getElementById("dock").style.opacity=1,["rotate-toggle","first-turn-toggle","btn-debug","btn-reset","btn-random","mobile-first-turn","mobile-debug","mobile-reset","mobile-menu-random","mobile-menu-reset"].forEach(i=>{const o=document.getElementById(i);o&&(o.disabled=!1)});const n=document.getElementById("start-btn");n.innerText="üöÄ ÂºÄÂßãÊàòÊñó",n.className="btn-orange",n.disabled=!0;const s=document.getElementById("mb-btn-start");s&&(s.disabled=!0),Ee(),document.getElementById("enemy-grid").style.pointerEvents="none",W=q(),R(),document.getElementById("log").innerHTML='<div class="log-line c-sys">Ê∏∏ÊàèÂ∑≤ÈáçÁΩÆ„ÄÇ</div>',T("player")}function Je(){document.body.classList.add("game-playing"),Z(),z=null,L="PLAYING",document.getElementById("dock").style.display="none",document.getElementById("battle-panel").style.display="flex";const e=document.getElementById("mb-deploy-group"),t=document.getElementById("mb-combat-group");e&&(e.style.display="none"),t&&(t.style.display="flex"),["rotate-toggle","first-turn-toggle","btn-reset","btn-random","mobile-first-turn","mobile-reset","mobile-menu-random","mobile-menu-reset"].forEach(s=>{const i=document.getElementById(s);i&&(i.disabled=!0)}),b.forEach(s=>s.el.style.cursor="default");const n=document.getElementById("start-btn");n.innerText="üîÑ ÈáçÊñ∞ÂºÄÂßã",n.className="btn-restart",Qe(),ae(),j("AP"),F==="PLAYER"?(B("ÊàòÊñóÂºÄÂßãÔºÅÁé©ÂÆ∂ÂÖàÊâãÔºåÁÇπÂáªÊïåÊñπÊµ∑ÂüüÂºÄÁÅ´„ÄÇ","c-warn"),document.getElementById("enemy-grid").style.pointerEvents="auto",T("enemy")):(B("ÊàòÊñóÂºÄÂßãÔºÅÁîµËÑëÂÖàÊâã„ÄÇ","c-warn"),document.getElementById("enemy-grid").style.pointerEvents="none",T("player"),Pe(ne().AI_ACTION_DELAY))}function Qe(){const e=document.getElementById("enemy-grid");e.querySelectorAll(".wreck").forEach(l=>l.remove()),e.querySelectorAll(".revealed-enemy-ship").forEach(l=>l.remove()),e.querySelectorAll(".cell").forEach(l=>{for(l.className="cell";l.firstChild;)l.removeChild(l.firstChild)}),x=[],w=q().map(l=>l.map(n=>({hit:!1,shipId:-1,segmentIndex:-1})));let t=q();te.forEach((l,n)=>{let s=!1,i=0;for(;!s&&i<1e3;){i++;let o=Math.floor(Math.random()*m),c=Math.floor(Math.random()*m),a=Math.random()>.5,r=!0;if(a?o+l.len>m&&(r=!1):c+l.len>m&&(r=!1),r)for(let d=0;d<l.len;d++){let u=a?o+d:o,f=a?c:c+d;t[u][f]===1&&(r=!1)}if(r){for(let d=0;d<l.len;d++){let u=a?o+d:o,f=a?c:c+d;t[u][f]=1,w[u][f].shipId=n,w[u][f].segmentIndex=d}x.push({id:n,name:l.name,len:l.len,maxHp:l.maxHp,code:l.code,hp:Array(l.len).fill(l.maxHp),sunk:!1,r:o,c,v:a}),s=!0}}s||console.error("Failed to place ship:",l.name)})}function j(e){C=e,document.querySelectorAll(".weapon-btn").forEach(s=>s.classList.remove("active"));const t=e==="AP"?"btn-ap":e==="HE"?"btn-he":"btn-sonar";document.getElementById(t).classList.add("active");const l=document.getElementById("mb-weapon-name"),n=document.getElementById("mb-weapon-icon");l&&n&&(e==="AP"?(l.innerText="‰∏ªÁÇÆ",n.innerText="üí•"):e==="HE"?(l.innerText="Á©∫Ë¢≠",n.innerText="‚úàÔ∏è"):e==="SONAR"&&(l.innerText="Ê∞¥Âê¨",n.innerText="üì°"))}function et(){const e=b.some(o=>o.code==="CV"&&!o.sunk);b.some(o=>o.code==="CL"&&!o.sunk);const t=b.some(o=>o.code==="DD"&&!o.sunk),l=e,n=t;document.getElementById("btn-he").disabled=!l,document.getElementById("btn-sonar").disabled=!n,C==="HE"&&!l&&j("AP"),C==="SONAR"&&!n&&j("AP");const s=Te(),i=document.getElementById("ap-desc");i&&(i.innerText=`ÂçïÁÇπ ${s}‰º§`)}function Te(){const e=b.some(n=>n.code==="BB"&&!n.sunk),t=b.some(n=>n.code==="SS"&&!n.sunk),l=b.some(n=>n.code==="CL"&&!n.sunk);return e||t?3:l?2:1}function ae(){const e=document.getElementById("ship-status-list");e.innerHTML="",b.forEach(t=>{const l=document.createElement("div");l.className="ship-status-row";const n=document.createElement("span");n.innerText=t.name,t.sunk&&(n.style.textDecoration="line-through",n.style.color="#fc8181");const s=document.createElement("div");s.className="hp-blocks",t.hp.forEach(i=>{const o=document.createElement("div");o.className="hp-block",i<=0?o.classList.add("lost"):i<t.maxHp&&o.classList.add("dmg"),s.appendChild(o)}),l.appendChild(n),l.appendChild(s),e.appendChild(l)}),et()}function tt(e,t){if(L==="PLAYING"&&document.getElementById("enemy-grid").style.pointerEvents!=="none"){if(C==="AP"){const l=w[e][t];if(l.hit&&l.shipId!==-1&&x[l.shipId].hp[l.segmentIndex]<=0||l.hit&&l.shipId===-1)return;const n=Te();Q(e,t,n),B(`‰ΩøÁî®‰∏ªÁÇÆÊîªÂáª (${e+1},${t+1})Ôºå‰º§ÂÆ≥: ${n}`,"c-p")}else if(C==="HE"){const l=[[0,0],[-1,-1],[-1,1],[1,-1],[1,1]];let n=0;l.forEach(s=>{let i=e+s[0],o=t+s[1];if(i>=0&&i<m&&o>=0&&o<m){const c=w[i][o],a=c.hit&&c.shipId!==-1&&x[c.shipId].hp[c.segmentIndex]<=0;!(c.hit&&c.shipId===-1)&&!a&&(Q(i,o,1),n++)}}),B(`ÂëºÂè´Á©∫Ë¢≠Ë¶ÜÁõñ (${e+1},${t+1}) Âë®ËæπÔºåÊâìÂáªÁÇπÊï∞: ${n}`,"c-p")}else if(C==="SONAR"){let l=0;for(let n=-1;n<=1;n++)for(let s=-1;s<=1;s++){let i=e+n,o=t+s;if(i>=0&&i<m&&o>=0&&o<m){const c=w[i][o];c.shipId!==-1&&!c.hit&&l++}}if(l===0){for(let n=-1;n<=1;n++)for(let s=-1;s<=1;s++){let i=e+n,o=t+s;if(i>=0&&i<m&&o>=0&&o<m){const c=w[i][o],a=document.querySelector(`#enemy-grid .cell[data-r='${i}'][data-c='${o}']`);a&&a.classList.remove("detect"),c.hit||(c.hit=!0,a&&a.classList.add("miss"))}}B(`Â£∞Á∫≥Êâ´Êèè (${e+1},${t+1}) Âå∫ÂüüÔºöÊó†ÂèçÂ∫î„ÄÇ`,"c-sys")}else{w[e][t].hit||Q(e,t,0);for(let s=-1;s<=1;s++)for(let i=-1;i<=1;i++){let o=e+s,c=t+i;if(!(s===0&&i===0)&&o>=0&&o<m&&c>=0&&c<m){const a=w[o][c],r=document.querySelector(`#enemy-grid .cell[data-r='${o}'][data-c='${c}']`);!a.hit&&r&&!r.classList.contains("miss")&&!r.classList.contains("hit")&&!r.classList.contains("destroyed")&&!r.classList.contains("detect")&&r.classList.add("detect")}}B(`Â£∞Á∫≥Êâ´Êèè (${e+1},${t+1}) Âå∫ÂüüÔºöÂèëÁé∞‰ø°Âè∑ÔºÅÂë®ËæπÊ†áËÆ∞‰∏∫Áñë‰ºº„ÄÇ`,"c-warn")}}if(ae(),document.getElementById("enemy-grid").style.pointerEvents="none",L==="PLAYING"){const l=ne();l.VIEW_SWITCH_DELAY>0&&setTimeout(()=>{L==="PLAYING"&&T("player")},l.VIEW_SWITCH_DELAY),Pe(l.AI_ACTION_DELAY)}}}function Q(e,t,l){const n=w[e][t],s=document.querySelector(`#enemy-grid .cell[data-r='${e}'][data-c='${t}']`);if(!(n.hit&&n.shipId===-1))if(n.hit=!0,s.classList.remove("detect"),n.shipId!==-1){const i=x[n.shipId];l>0&&(i.hp[n.segmentIndex]-=l),s.classList.remove("hit","destroyed"),i.hp[n.segmentIndex]<=0?s.classList.add("destroyed"):s.classList.add("hit"),i.hp.every(o=>o<=0)&&!i.sunk&&(i.sunk=!0,B(`ÊàòÊä•ÔºöÊïåÊñπ„Äê${i.name}„ÄëÁ°ÆËÆ§Ê≤âÊ≤°ÔºÅ`,"c-warn"),Ge(i),Ne("Áé©ÂÆ∂"))}else s.classList.add("miss")}let H={...he[pe]},we=pe;function Me(e,t={}){const{silent:l=!1}=t;we=e,H={...he[e]},document.querySelectorAll(".diff-btn").forEach(n=>{n.dataset.difficulty===e?n.classList.add("active"):n.classList.remove("active")}),l||B(`AI ÈöæÂ∫¶Â∑≤Ë∞ÉÊï¥‰∏∫: ${e==="EASY"?"Êñ∞ÂÖµ (ÁÆÄÂçï)":e==="NORMAL"?"Ëà∞Èïø (Âõ∞Èöæ)":"ÊèêÁù£ (ÂÜ∑ÈÖ∑)"}`,"c-sys")}const nt=1e-4;function Z(){O!==null&&(clearTimeout(O),O=null)}function Pe(e){Z(),O=setTimeout(()=>{O=null,st()},e)}function lt(){document.getElementById("player-grid").querySelectorAll(".last-enemy-attack").forEach(t=>{t.classList.remove("last-enemy-attack")})}function st(){if(L!=="PLAYING")return;lt();const e=x.some(y=>y.code==="CV"&&!y.sunk),t=x.some(y=>y.code==="CL"&&!y.sunk),l=x.some(y=>y.code==="BB"&&!y.sunk),n=x.some(y=>y.code==="SS"&&!y.sunk),s=x.some(y=>y.code==="DD"&&!y.sunk);let i=1;l||n?i=3:t&&(i=2);const o=e,c=s,a=Ce(),r=b.filter(y=>!y.sunk),d=r.reduce((y,v)=>Math.max(y,v.len),0),u=De(a,r);let f={r:-1,c:-1,weapon:"AP"};if(Math.random()<H.randomness){let y,v,g=0;do y=Math.floor(Math.random()*m),v=Math.floor(Math.random()*m),g++;while((a[y][v]===1||a[y][v]===3||a[y][v]===5)&&g<200);o&&Math.random()<.1?f={r:y,c:v,weapon:"HE"}:c&&Math.random()<.1?f={r:y,c:v,weapon:"SONAR"}:f={r:y,c:v,weapon:"AP"}}else{const y=ot(u,a,i),v=at(u,a,i);if(f={...y,weapon:"AP"},o){const g=ct(u,a,1);g.score>y.score*H.airstrikeAdvantage&&(f={...g,weapon:"HE"})}if(c){const g=rt(u,a),I=1-(v.normEntropy??0)<H.sonarEntropyGate,k=Math.max(1,d);g.r!==-1&&g.unknownCount>=k&&I&&(f={...g,weapon:"SONAR"})}}if(f.r===-1){let y,v;do y=Math.floor(Math.random()*10),v=Math.floor(Math.random()*10);while(a[y][v]===1||a[y][v]===3||a[y][v]===5);f={r:y,c:v,weapon:"AP"}}const{r:h,c:p,weapon:M}=f;if(M==="AP")ee(h,p,i),B(`ÊïåÊñπ‰ΩøÁî®‰∏ªÁÇÆÊîªÂáª (${h+1},${p+1})`,"c-e");else if(M==="HE")[[0,0],[-1,-1],[-1,1],[1,-1],[1,1]].forEach(v=>{let g=h+v[0],E=p+v[1];g>=0&&g<m&&E>=0&&E<m&&ee(g,E,1)}),B(`ÊïåÊñπÂèëÂä®Á©∫Ë¢≠ (${h+1},${p+1})`,"c-e");else if(M==="SONAR"){for(let v=-1;v<=1;v++)for(let g=-1;g<=1;g++){let E=h+v,I=p+g;if(E>=0&&E<m&&I>=0&&I<m){const k=document.querySelector(`#player-grid .cell[data-r='${E}'][data-c='${I}']`);k&&k.classList.add("last-enemy-attack")}}let y=!1;for(let v=-1;v<=1;v++)for(let g=-1;g<=1;g++){let E=h+v,I=p+g;E>=0&&E<10&&I>=0&&I<10&&W[E][I]===1&&(y=!0)}if(y)B(`ÊïåÊñπÂ£∞Á∫≥Êâ´Êèè (${h+1},${p+1})ÔºöÂèëÁé∞‰ø°Âè∑ÔºÅ`,"c-e"),ee(h,p,0),dt(h,p);else{B(`ÊïåÊñπÂ£∞Á∫≥Êâ´Êèè (${h+1},${p+1})ÔºöÊó†ÂèçÂ∫î„ÄÇ`,"c-sys");for(let v=-1;v<=1;v++)for(let g=-1;g<=1;g++){let E=h+v,I=p+g;if(E>=0&&E<10&&I>=0&&I<10){const k=document.querySelector(`#player-grid .cell[data-r='${E}'][data-c='${I}']`);!k.classList.contains("hit")&&!k.classList.contains("destroyed")&&k.classList.add("miss")}}}}ae(),N&&Le();const S=document.getElementById("enemy-grid");if(L==="PLAYING"){S.style.pointerEvents="auto";const y=ne();y.TURN_BACK_DELAY>0&&setTimeout(()=>{L==="PLAYING"&&T("enemy")},y.TURN_BACK_DELAY)}else S.style.pointerEvents="none"}function Ce(){let e=Array(10).fill(0).map(()=>Array(10).fill(0));return document.querySelectorAll("#player-grid .cell").forEach(t=>{const l=parseInt(t.dataset.r),n=parseInt(t.dataset.c);t.classList.contains("destroyed")?e[l][n]=3:t.classList.contains("hit")?e[l][n]=2:t.classList.contains("miss")?e[l][n]=1:t.classList.contains("ai-detect")&&(e[l][n]=4)}),b.forEach(t=>{if(t.sunk)for(let l=0;l<t.len;l++){let n=t.vertical?t.r+l:t.r,s=t.vertical?t.c:t.c+l;n>=0&&n<10&&s>=0&&s<10&&(e[n][s]=5)}}),e}function De(e,t){const l=Array(m).fill(0).map(()=>Array(m).fill(0));let n=0;if(t.forEach(s=>{it(s,e).forEach(({cells:o,weight:c})=>{const a=o.filter(d=>{const u=e[d.r][d.c];return u===0||u===4});if(a.length===0)return;const r=c/a.length;a.forEach(d=>{l[d.r][d.c]+=r,n+=r})})}),n>0)for(let s=0;s<m;s++)for(let i=0;i<m;i++)l[s][i]=l[s][i]/n;for(let s=0;s<m;s++)for(let i=0;i<m;i++){const o=e[s][i];o===2&&(l[s][i]=1),(o===1||o===3||o===5)&&(l[s][i]=0)}return l}function it(e,t){const l=[],n=e.len,i=Math.max(1,e.hp.filter(c=>c>0).length)/n;for(let c=0;c<m;c++)for(let a=0;a<=m-n;a++)o(c,a,!1);for(let c=0;c<=m-n;c++)for(let a=0;a<m;a++)o(c,a,!0);return l;function o(c,a,r){const d=[];let u=1;for(let h=0;h<n;h++){const p=r?c+h:c,M=r?a:a+h,S=t[p][M];if(S===1||S===5)return;d.push({r:p,c:M}),S===2||S===3?u+=H.hitFocus:S===4&&(u+=H.sonarFocus)}const f=Math.max(nt,u*i);l.push({cells:d,weight:f})}}function ot(e,t,l=1){let n=-1;const s=[];for(let o=0;o<m;o++)for(let c=0;c<m;c++){const a=t[o][c];if(a===1||a===3||a===5)continue;const d=(a===2?1:e[o][c]||0)*l;d>n+1e-6?(n=d,s.length=0,s.push({r:o,c})):Math.abs(d-n)<1e-6&&s.push({r:o,c})}return s.length===0?{r:-1,c:-1,score:0}:{...s[Math.floor(Math.random()*s.length)],score:n}}function ct(e,t,l=1){const n=[[0,0],[-1,-1],[-1,1],[1,-1],[1,1]];let s=-1;const i=[];for(let c=0;c<m;c++)for(let a=0;a<m;a++){let r=0;n.forEach(d=>{const u=c+d[0],f=a+d[1];if(u<0||u>=m||f<0||f>=m)return;const h=t[u][f];if(h===1||h===3||h===5)return;const p=h===2?1:e[u][f]||0;r+=p*l}),r>s+1e-6?(s=r,i.length=0,i.push({r:c,c:a})):Math.abs(r-s)<1e-6&&r>=0&&i.push({r:c,c:a})}return i.length===0?{r:-1,c:-1,score:0}:{...i[Math.floor(Math.random()*i.length)],score:s}}function at(e,t,l=1){const n=[];let s=0;for(let r=0;r<m;r++)for(let d=0;d<m;d++){const u=t[r][d];if(u===1||u===3||u===5)continue;const h=(u===2?1:e[r][d]||0)*l;n.push(h),h>s&&(s=h)}if(!n.length)return{mean:0,variance:0,maxScore:0,normEntropy:1};const i=n.reduce((r,d)=>r+d,0)/n.length,o=n.reduce((r,d)=>r+Math.pow(d-i,2),0)/n.length;let c=1;const a=n.filter(r=>r>0);if(a.length>0){const r=a.reduce((d,u)=>d+u,0);if(r>0){const d=a.reduce((f,h)=>{const p=h/r;return p>0?f-p*Math.log(p):f},0),u=Math.log(a.length);u>0?c=Math.min(1,d/u):c=0}}return{mean:i,variance:o,maxScore:s,normEntropy:c}}function rt(e,t){let l={r:-1,c:-1,score:0,density:0,unknownCount:0};for(let n=0;n<m;n++)for(let s=0;s<m;s++){let i=0,o=0;for(let r=-1;r<=1;r++)for(let d=-1;d<=1;d++){const u=n+r,f=s+d;if(u<0||u>=m||f<0||f>=m)continue;t[u][f]===0&&(i++,o+=e[u][f]||0)}if(i===0)continue;const c=i/9,a=o/i;(c>l.score+1e-6||Math.abs(c-l.score)<1e-6&&a>l.density)&&(l={r:n,c:s,score:c,density:a,unknownCount:i})}return l}function dt(e,t){for(let l=-1;l<=1;l++)for(let n=-1;n<=1;n++){if(l===0&&n===0)continue;const s=e+l,i=t+n;if(s<0||s>=m||i<0||i>=m)continue;const o=document.querySelector(`#player-grid .cell[data-r='${s}'][data-c='${i}']`);o&&(o.classList.contains("hit")||o.classList.contains("destroyed")||o.classList.add("ai-detect"))}}function ee(e,t,l){const n=document.querySelector(`#player-grid .cell[data-r='${e}'][data-c='${t}']`);n.classList.remove("ai-detect"),n.classList.add("last-enemy-attack");let s=null,i=-1;for(let o of b)if(o.vertical){if(t===o.c&&e>=o.r&&e<o.r+o.len){s=o,i=e-o.r;break}}else if(e===o.r&&t>=o.c&&t<o.c+o.len){s=o,i=t-o.c;break}if(s){if(s.hp[i]<=0)return;s.hp[i]-=l,n.classList.remove("hit","destroyed","miss"),s.hp[i]<=0?n.classList.add("destroyed"):n.classList.add("hit"),s.hp.every(o=>o<=0)&&!s.sunk&&(s.sunk=!0,s.el.classList.add("sunk"),B(`‰∏•ÈáçË≠¶Êä•ÔºöÊàëÊñπ„Äê${s.name}„ÄëÊ≤âÊ≤°ÔºÅ`,"c-e"),Ne("ÁîµËÑë"))}else!n.classList.contains("miss")&&!n.classList.contains("hit")&&!n.classList.contains("destroyed")&&n.classList.add("miss")}function Ne(e){if(z)return;const t=b.every(c=>c.sunk),l=x.every(c=>c.sunk);if(!(t||l))return;z=e,L="END",Z();const n=document.getElementById("enemy-grid");n&&(n.style.pointerEvents="none"),mt();const s=document.getElementById("game-over-modal"),i=document.getElementById("game-over-title"),o=document.getElementById("game-over-msg");e==="Áé©ÂÆ∂"?(i.innerText="VICTORY",i.className="game-over-title win-text",o.innerText="ÊÅ≠ÂñúÊåáÊå•ÂÆòÔºÅÊïåÊñπËà∞ÈòüÂ∑≤Ë¢´ÂÖ®Ê≠ºÔºÅ"):(i.innerText="DEFEAT",i.className="game-over-title lose-text",o.innerText="ÂæàÈÅóÊÜæÔºåÊàëÊñπËà∞ÈòüÂ∑≤ÂÖ®ÂÜõË¶ÜÊ≤°..."),setTimeout(()=>{s.style.display="block"},500)}function mt(){x.forEach(e=>{Ge(e)})}function Ge(e){const t=document.getElementById("enemy-grid"),l=$();if(t.querySelector(`.revealed-enemy-ship[data-id="${e.id}"]`))return;const n=document.createElement("div");n.className="ship revealed-enemy-ship ship-visuals-root",n.dataset.id=e.id,n.style.position="absolute",n.style.left=e.c*l+"px",n.style.top=e.r*l+"px",n.style.pointerEvents="none";const s=document.createElement("div");s.className="ship-inner",s.innerHTML=le(e.code),n.appendChild(s);const i=e.len*l+"px",o=l+"px";n.style.setProperty("--w",i),n.style.setProperty("--h",o),e.v?(n.classList.add("vertical"),n.style.width=l+"px",n.style.height=i):(n.style.width=i,n.style.height=l+"px"),e.sunk?n.classList.add("sunk"):(n.style.opacity="0.9",n.style.filter="drop-shadow(0 0 5px white)"),se(n,e.len,l),t.appendChild(n)}function ut(e,t){const l=$(),n=t.len*l+"px",s=l+"px";e.style.left=t.c*l+"px",e.style.top=t.r*l+"px",e.style.setProperty("--w",n),e.style.setProperty("--h",s),se(e,t.len,l),t.v?(e.style.width=l+"px",e.style.height=n):(e.style.width=n,e.style.height=l+"px")}function ft(){document.getElementById("game-over-modal").style.display="none"}function yt(){document.getElementById("game-over-modal").style.display="none",X()}function B(e,t){const l=document.getElementById("log"),n=document.createElement("div");n.className=`log-line ${t}`,n.innerHTML=`[${new Date().toLocaleTimeString().split(" ")[0]}] ${e}`,l.prepend(n)}function V(){const e=document.getElementById("help-modal");e.style.display=e.style.display==="block"?"none":"block"}function gt(e){const t=e==="left",l=document.querySelector(t?".dock-panel":".log-panel"),n=document.querySelector(t?".toggle-left":".toggle-right");l.classList.toggle("panel-collapsed");const s=l.classList.contains("panel-collapsed");t?n.innerText=s?"‚ñ∂":"‚óÄ":n.innerText=s?"‚óÄ":"‚ñ∂"}function vt(){const e=document.getElementById("rules-ship-table-body");e&&(e.innerHTML="",te.forEach(t=>{const l=document.createElement("tr"),n=document.createElement("td"),s=document.createElement("div");s.className="ship-preview";const i=document.createElement("div");i.className="ship ship-visuals-root";const o=document.createElement("div");o.className="ship-inner",o.innerHTML=le(t.code),i.appendChild(o),Y({len:t.len,el:i,vertical:!1,inDock:!1});const c=i.querySelector(".hull-scale-wrapper");c&&(c.style.transform="scale(0.4)"),s.appendChild(i),n.appendChild(s),l.appendChild(n);const a=document.createElement("td");a.innerText=t.code,l.appendChild(a);const r=document.createElement("td");r.innerText=t.name,l.appendChild(r);const d=document.createElement("td");d.innerText=t.len,l.appendChild(d);const u=document.createElement("td");u.innerText=t.maxHp,l.appendChild(u);const f=document.createElement("td");t.code==="CV"?f.innerHTML="Ëß£ÈîÅ <b>Á©∫Ë¢≠</b>":t.code==="DD"?f.innerHTML="Ëß£ÈîÅ <b>Ê∞¥Âê¨</b>":t.code==="BB"||t.code==="SS"?f.innerHTML="‰∏ªÁÇÆ‰º§ÂÆ≥ 3":t.code==="CL"?f.innerHTML="‰∏ªÁÇÆ‰º§ÂÆ≥ 2 (Ëã•BB/SSÊ≤âÊ≤°)":f.innerText="-",l.appendChild(f),e.appendChild(l)}))}window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector("header h1");e&&(e.textContent=`${Ye} (${Oe})`),Re()});</script>
  <style rel="stylesheet" crossorigin>:root{--bg-color: #1a202c;--panel-bg: #2d3748;--water: #2b6cb0;--accent: #ed8936;--text: #e2e8f0;--cell-size: 40px}*{box-sizing:border-box}body{font-family:Segoe UI,sans-serif;background-color:var(--bg-color);color:var(--text);margin:0;height:100vh;display:flex;flex-direction:column;-webkit-user-select:none;user-select:none}header{height:50px;background:#171923;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 5px #00000080;z-index:50}h1{margin:0;font-size:1.2rem;color:var(--accent);letter-spacing:2px}.layout{display:flex;flex:1;height:calc(100vh - 50px)}.center-area{flex:1;display:flex;flex-direction:column;background:radial-gradient(#2c3e50 1px,transparent 1px);background-size:20px 20px;position:relative;overflow:hidden}.scroll-view{flex:1;overflow:auto;width:100%;display:flex;flex-direction:column;position:relative}.dock-panel{width:260px;min-width:260px;background:var(--panel-bg);border-right:1px solid #4a5568;display:flex;flex-direction:column;padding:15px;z-index:30;transition:all .3s cubic-bezier(.4,0,.2,1);overflow:hidden;white-space:nowrap}.dock-header{font-weight:700;color:#90cdf4;margin-bottom:10px;text-align:center;display:flex;align-items:center;justify-content:center;gap:8px}.dock-container{flex:1;background:#0003;border-radius:8px;padding:15px;display:flex;flex-direction:column;align-items:center;gap:15px;position:relative;overflow-y:auto}.battlefield{flex:0 0 auto;margin:auto;display:flex;justify-content:center;align-items:center;gap:40px;min-width:fit-content;padding:20px}.board-box{display:flex;flex-direction:column;align-items:center;flex-shrink:0}.board-title{margin-bottom:8px;font-weight:700}.bottom-controls{height:70px;background:#171923e6;border-top:1px solid #4a5568;display:flex;justify-content:center;align-items:center;gap:15px;padding:0 20px;z-index:40;box-shadow:0 -4px 10px #0000004d}.bottom-controls button{padding:10px 20px;font-size:14px;display:flex;align-items:center;gap:8px;min-width:120px;justify-content:center}@media(max-width:768px){.bottom-controls button{min-width:auto;padding:8px 12px}}.panel-collapsed{width:0!important;min-width:0!important;padding-left:0!important;padding-right:0!important;border:none!important;opacity:0}.toggle-btn{position:absolute;top:50%;transform:translateY(-50%);width:16px;height:40px;background:var(--panel-bg);border:1px solid #4a5568;color:var(--accent);display:flex;align-items:center;justify-content:center;cursor:pointer;z-index:90;transition:all .2s;font-size:10px;box-shadow:0 2px 8px #0000004d;opacity:.8}.toggle-btn:hover{background:#4a5568;color:#fff;width:20px;opacity:1}.toggle-left{left:0;border-left:none;border-radius:0 12px 12px 0}.toggle-right{right:0;border-right:none;border-radius:12px 0 0 12px}.grid{display:grid;grid-template-columns:repeat(10,var(--cell-size));grid-template-rows:repeat(10,var(--cell-size));background-color:var(--water);border:4px solid #2c5282;box-shadow:0 10px 20px #0006;position:relative}.cell{width:var(--cell-size);height:var(--cell-size);border:1px solid rgba(255,255,255,.1);box-sizing:border-box;transition:background .1s;position:relative}#enemy-grid .cell{z-index:5}#player-grid .cell{z-index:auto}.cell.highlight-valid{background-color:#48bb78b3!important;box-shadow:inset 0 0 0 2px #fff}.cell.highlight-invalid{background-color:#f56565b3!important;box-shadow:inset 0 0 0 2px red}#enemy-grid .cell:hover:not(.hit):not(.miss):not(.destroyed):not(.detect){background-color:#fff3;cursor:crosshair}.hit{background-color:#ecc94b66!important;position:relative}.hit:after{content:"üí•";position:absolute;inset:0;display:flex;justify-content:center;align-items:center;font-size:18px;z-index:102}.destroyed{background-color:#e53e3e66!important;position:relative}.destroyed:after{content:"‚ò†Ô∏è";position:absolute;inset:0;display:flex;justify-content:center;align-items:center;font-size:18px;z-index:102}.detect{background-color:#ecc94b4d!important;position:relative}.detect:after{content:"‚ùì";position:absolute;inset:0;display:flex;justify-content:center;align-items:center;font-size:18px;z-index:102}.ai-detect{background-color:#ecc94b4d!important;position:relative}.ai-detect:after{content:"‚ùì";position:absolute;inset:0;display:flex;justify-content:center;align-items:center;font-size:18px;z-index:102}.miss{background-color:#ffffff1a!important;position:relative}.miss:after{content:"";position:absolute;width:10px;height:10px;border-radius:50%;top:50%;left:50%;transform:translate(-50%,-50%);background:#ffffff80;z-index:102}.attack-range-highlight{box-shadow:inset 0 0 0 2px #fc8181,0 0 10px #fc818180;background-color:#fc818133!important;z-index:60}.last-enemy-attack{background-color:#fc81814d!important;box-shadow:inset 0 0 0 2px #fc8181;z-index:200}.weapon-bar{display:flex;gap:8px;width:100%}.weapon-btn{flex:1;padding:10px 6px;font-size:12px;background:linear-gradient(to bottom,#2d3748,#1a202c);color:#cbd5e0;border:1px solid #4a5568;border-radius:6px;cursor:pointer;display:flex;flex-direction:column;align-items:center;gap:4px;transition:all .2s;box-shadow:0 2px 4px #0003}.weapon-btn:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 8px #0000004d;border-color:#718096}.weapon-btn.active{background:linear-gradient(to bottom,#3182ce,#2b6cb0);color:#fff;border-color:#63b3ed;box-shadow:0 0 12px #4299e180;transform:translateY(-1px)}.weapon-btn:disabled{opacity:.5;cursor:not-allowed;background:#1a202c;filter:grayscale(1);border-color:#2d3748}.status-panel{display:flex;flex-direction:column;gap:8px;width:100%;margin-top:10px}.ship-status-row{display:flex;align-items:center;justify-content:space-between;padding:6px 8px;background:#0003;border-radius:4px;border-bottom:none;font-size:12px;margin-bottom:2px}.hp-blocks{display:flex;gap:4px}.hp-block{width:12px;height:6px;background:#48bb78;border-radius:2px;box-shadow:0 0 4px #48bb7866}.hp-block.dmg{background:#ecc94b;box-shadow:0 0 4px #ecc94b66}.hp-block.lost{background:#e53e3e;box-shadow:none;opacity:.3}.top-hit-marker{position:absolute;z-index:102;pointer-events:none;width:var(--cell-size);height:var(--cell-size);display:flex;justify-content:center;align-items:center;font-size:28px;text-shadow:0 0 5px #000}.log-panel{width:260px;min-width:260px;background:var(--panel-bg);border-left:1px solid #4a5568;display:flex;flex-direction:column;z-index:20;transition:all .3s cubic-bezier(.4,0,.2,1);overflow:hidden;white-space:normal}.log-header{padding:10px;background:#232936;text-align:center;font-weight:700;color:#90cdf4}.log-content{flex:1;overflow-y:auto;padding:10px;font-family:Consolas,monospace;font-size:12px}.log-line{margin-bottom:4px;border-bottom:1px solid #3a4657;padding-bottom:2px}.c-sys{color:#a0aec0}.c-p{color:#68d391}.c-e{color:#fc8181}.c-warn{color:var(--accent);font-weight:700}.ship{position:relative;z-index:100;cursor:grab;display:block;transition:top .1s,left .1s;touch-action:none}.ship:not(.sunk):hover .ship-inner{filter:brightness(1.2) drop-shadow(0 0 5px rgba(255,255,255,.4))}.ship-inner{width:100%;height:100%;pointer-events:none;transform-origin:top left;transition:transform .2s}.ship.dragging{opacity:.7;cursor:grabbing;z-index:9999;position:fixed!important;pointer-events:none!important;transition:none!important;transform:scale(1.05);filter:drop-shadow(5px 5px 10px rgba(0,0,0,.5))}.ship.vertical{width:var(--cell-size)!important}.ship.vertical .ship-inner{width:var(--w)!important;height:var(--h)!important;transform:rotate(90deg) translateY(-100%)}.ship.sunk{filter:grayscale(100%) brightness(.8);border:1px solid red}@keyframes shake{0%,to{transform:translate(0)}25%{transform:translate(-5px)}75%{transform:translate(5px)}}.shake{animation:shake .2s ease-in-out 2}.wreck{position:absolute;border:2px solid #fc8181;background:#0000004d;pointer-events:none;z-index:10}.revealed-enemy-ship{z-index:1!important}.btn-area{margin-top:auto;display:flex;flex-direction:column;gap:8px}button{padding:10px;border:none;border-radius:4px;font-weight:700;cursor:pointer;transition:.2s;font-size:14px}.btn-mode{background:#805ad5;color:#fff;margin-bottom:5px}.btn-mode:hover{background:#6b46c1}.btn-mode:disabled{background:#553c9a;opacity:.5;cursor:not-allowed}.btn-blue{background:#4299e1;color:#fff}.btn-blue:hover{background:#3182ce}.btn-blue:disabled{background:#2c5282;opacity:.5;cursor:not-allowed}.btn-orange{background:var(--accent);color:#1a202c}.btn-orange:hover{background:#dd6b20}.btn-orange:disabled{background:#718096;cursor:not-allowed}.btn-restart{background:#9f7aea;color:#fff}.btn-restart:hover{background:#805ad5}.difficulty-bar{display:flex;gap:5px;margin-bottom:10px}.diff-btn{flex:1;padding:6px;font-size:12px;background:#2d3748;color:#a0aec0;border:1px solid #4a5568;cursor:pointer;transition:all .2s}.diff-btn:hover{background:#4a5568}.diff-btn.active{color:#1a202c;font-weight:700}.diff-btn.active[data-difficulty=EASY]{background:#38a169;border-color:#48bb78;color:#f0fff4;box-shadow:0 0 6px #38a16980}.diff-btn.active[data-difficulty=NORMAL]{background:#ecc94b;border-color:#f6e05e;color:#442a00;box-shadow:0 0 6px #ecc94b99}.diff-btn.active[data-difficulty=HARD]{background:#e53e3e;border-color:#fc8181;color:#fff5f5;box-shadow:0 0 6px #e53e3e99}.cell.debug-heat:before{content:attr(data-heat);position:absolute;inset:0;display:flex;justify-content:center;align-items:center;font-size:12px;font-weight:700;color:#fff;background:var(--heat-bg, rgba(255, 0, 0, .3));z-index:200;pointer-events:none;text-shadow:0 0 2px black}#help-btn{position:fixed;bottom:20px;right:20px;width:50px;height:50px;background:var(--accent);color:#1a202c;border-radius:50%;display:flex;justify-content:center;align-items:center;font-size:24px;font-weight:700;cursor:pointer;box-shadow:0 4px 10px #00000080;z-index:1000;transition:transform .2s}#help-btn:hover{transform:scale(1.1)}.modal{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;background-color:#000c;-webkit-backdrop-filter:blur(5px);backdrop-filter:blur(5px);animation:fadeIn .3s ease-out}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.modal-content{background:linear-gradient(135deg,#2d3748,#1a202c);margin:5% auto;padding:25px;border:1px solid #4a5568;width:80%;max-width:600px;border-radius:16px;position:relative;color:var(--text);max-height:80vh;overflow-y:auto;box-shadow:0 20px 50px #00000080;animation:slideIn .3s ease-out}@keyframes slideIn{0%{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1}}.close-btn{position:absolute;top:15px;right:20px;color:#718096;font-size:28px;font-weight:700;cursor:pointer;transition:color .2s}.close-btn:hover{color:#fc8181}.rules-table{width:100%;border-collapse:collapse;margin-bottom:15px;font-size:14px}.rules-table th,.rules-table td{border:1px solid #4a5568;padding:10px;text-align:left;vertical-align:middle}.rules-table th{background-color:#0000004d;color:var(--accent);font-weight:600}.rules-table tr:nth-child(2n){background-color:#ffffff05}.ship-preview{width:80px;height:30px;display:flex;align-items:center;justify-content:center;overflow:hidden}.ship-preview .ship-inner{pointer-events:none}.ship-preview .hull-scale-wrapper{transform:scale(.4)!important}.game-over-content{text-align:center;max-width:400px;padding:40px}.game-over-title{font-size:3rem;margin:0 0 20px;text-shadow:0 0 20px currentColor}.win-text{color:#48bb78}.lose-text{color:#fc8181}.control-group{margin-top:auto;display:flex;flex-direction:column;gap:8px;padding-top:10px;border-top:1px solid #4a5568}.btn-row{display:flex;gap:5px}.btn-row>*{flex:1}.btn-icon{padding:8px;font-size:16px}.difficulty-bar{margin-bottom:0}@media(max-width:768px){:root{--cell-size: clamp(26px, 8.5vw, 34px)}body{height:auto;min-height:100vh;overflow-y:auto;padding-top:50px}.layout{flex-direction:column;height:auto;overflow:visible}.dock-panel{width:100%;min-width:100%;height:auto;max-height:none;border-right:none;border-bottom:1px solid #4a5568;order:1;padding:10px;overflow:visible}.center-area{order:2;height:auto;overflow:visible;flex:none;background-attachment:fixed}.log-panel{width:100%;min-width:100%;height:200px;border-left:none;border-top:1px solid #4a5568;order:3}.toggle-btn{display:none}.scroll-view{overflow:visible;padding-bottom:120px}.battlefield{display:grid;grid-template-areas:"stack";width:100%;flex:1;padding:0;margin:0;gap:0;position:relative}.board-box{grid-area:stack;width:100%;display:flex;flex:1;justify-content:center;padding-top:20px;visibility:visible;z-index:0;opacity:1;pointer-events:none}.board-box.active-view{z-index:10;pointer-events:auto}.board-box.active-view .board-title{animation:titleEnter .4s cubic-bezier(.2,.8,.2,1) forwards}.board-box:not(.active-view) .board-title{opacity:0;visibility:hidden;transition:opacity 0s}.board-box.active-view .grid{animation:gridEnter .4s cubic-bezier(.2,.8,.2,1) forwards;box-shadow:0 10px 25px #00000080}@keyframes titleEnter{0%{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}@keyframes gridEnter{0%{opacity:0;transform:scale(.95) translateY(10px)}to{opacity:1;transform:scale(1) translateY(0)}}.bottom-controls{height:auto;flex-wrap:nowrap;padding:8px 10px;gap:8px;position:fixed;bottom:0;left:0;right:0;background:#1a202cfa;border-top:1px solid #4a5568;z-index:1000;box-shadow:0 -4px 20px #00000080;display:flex;justify-content:space-between}#btn-reset,#btn-debug{display:none}#btn-random,#btn-settings{display:flex!important}.dock-panel .difficulty-bar,.dock-panel #first-turn-toggle,.dock-panel .control-group>div:first-child{display:none}.dock-panel #rotate-toggle{display:flex;width:100%;justify-content:center;padding:12px;margin-top:8px;font-size:15px;background:linear-gradient(to right,#667eea,#764ba2);border:1px solid rgba(255,255,255,.2);box-shadow:0 4px 12px #764ba266;border-radius:8px;animation:pulse-guide 2s infinite}@keyframes pulse-guide{0%{box-shadow:0 0 #764ba2b3}70%{box-shadow:0 0 0 6px #764ba200}to{box-shadow:0 0 #764ba200}}.mobile-tab-btn{display:flex!important;flex-direction:column;align-items:center;justify-content:center;font-size:10px;background:transparent;border:none;color:#718096;padding:0 15px;min-width:60px;cursor:pointer}.mobile-tab-btn.active{color:#63b3ed;text-shadow:0 0 10px rgba(99,179,237,.5)}.mobile-tab-btn span{font-size:20px;margin-bottom:4px;display:block}#start-btn{flex:2;margin:0 10px;border-radius:20px;box-shadow:0 4px 10px #ed893666}.weapon-bar{position:fixed;bottom:70px;left:50%;transform:translate(-50%);width:90%;background:#2d3748e6;padding:8px;border-radius:12px;border:1px solid #4a5568;box-shadow:0 4px 15px #0006;z-index:999;display:none}.dock-panel{padding-bottom:20px}.log-panel{display:none}#help-btn{position:static;width:20px;height:20px;font-size:12px;box-shadow:0 2px 4px #0003;border:1px solid rgba(255,255,255,.3);transform:none;margin-left:8px;bottom:auto;right:auto}#help-btn:hover{transform:none}.pulse-highlight{animation:pulse-orange 2s infinite;background-color:#f6ad55!important;border-color:#fff!important}@keyframes pulse-orange{0%{box-shadow:0 0 #ed8936b3;transform:scale(1)}70%{box-shadow:0 0 0 6px #ed893600;transform:scale(1.1)}to{box-shadow:0 0 #ed893600;transform:scale(1)}}}.icon-btn{background:transparent;border:none;color:var(--text);font-size:24px;cursor:pointer;padding:8px;display:none;position:absolute;right:15px;top:50%;transform:translateY(-50%);z-index:60;text-shadow:0 0 10px rgba(0,0,0,.5)}.icon-btn:hover{color:var(--accent);transform:translateY(-50%) rotate(90deg);transition:all .3s}.menu-modal-content{background:#1a202c;border:1px solid #2d3748;padding:20px}.menu-grid{display:flex;flex-direction:column;gap:15px}.menu-section{background:#2d3748;padding:15px;border-radius:12px}.menu-label{font-size:12px;color:#a0aec0;margin-bottom:10px;text-transform:uppercase;letter-spacing:1px;font-weight:700}.menu-row{display:flex;gap:10px}.menu-btn{flex:1;padding:12px;border-radius:8px;font-size:14px;display:flex;align-items:center;justify-content:center;gap:8px;border:none;cursor:pointer;transition:.2s}.mobile-bottom-bar{display:none;width:100%;height:65px;background:#1a202c;align-items:center;justify-content:space-between;padding:0 10px;box-shadow:0 -2px 10px #0000004d;position:relative;z-index:100}.nav-tab{flex:0 0 60px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:transparent;border:none;color:#718096;font-size:10px;padding:0;cursor:pointer;transition:color .2s}.nav-tab .icon{font-size:22px;margin-bottom:4px}.nav-tab.active{color:#63b3ed}.nav-tab.active .icon{transform:scale(1.1)}.action-center{flex:1;display:flex;justify-content:center;padding:0 15px}.deploy-actions,.combat-actions{display:flex;gap:10px;width:100%;justify-content:center}.action-btn{display:flex;align-items:center;justify-content:center;gap:6px;border:none;border-radius:16px;font-weight:700;transition:transform .1s,background .2s;cursor:pointer;box-shadow:0 2px 5px #0003}.action-btn:active{transform:scale(.95)}.action-btn.primary{background:var(--accent);color:#1a202c;flex:2;height:44px;font-size:16px}.action-btn.primary:disabled{background:#4a5568;color:#a0aec0;cursor:not-allowed;box-shadow:none}.action-btn.secondary{background:#2d3748;color:var(--text);flex:1;height:44px;border:1px solid #4a5568;font-size:18px}.weapon-selector{background:linear-gradient(135deg,#3182ce,#2b6cb0);color:#fff;width:100%;height:44px;border-radius:22px;font-size:16px;border:1px solid #4299e1}.desktop-controls{display:flex;gap:10px;align-items:center;width:100%;justify-content:center}@media(max-width:768px){header{justify-content:center;padding:0 15px;position:fixed;top:0;width:100%}.icon-btn{display:block}.bottom-controls{padding:0;background:#1a202c;height:auto;border-top:1px solid #2d3748}.mobile-bottom-bar{display:flex}.desktop-controls{display:none}.weapon-bar{bottom:75px!important;width:auto!important;left:15px!important;right:15px!important;transform:none!important;background:#1a202cf2!important;-webkit-backdrop-filter:blur(10px);backdrop-filter:blur(10px);border:1px solid #4a5568;display:none}.weapon-bar.show{display:flex!important;animation:slideUp .2s ease-out}@keyframes slideUp{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.mobile-tab-btn,#btn-random,#btn-settings{display:none!important}.dock-panel{padding-bottom:10px}.scroll-view{padding-bottom:80px}}.ship-visuals-root{--color-sea: #1a2b3c;--color-steel-light: #cfd8dc;--color-steel-mid: #90a4ae;--color-steel-dark: #546e7a;--color-barrel: #263238;--deck-wood-bb: #8d6e63;--deck-flight: #455a64;--deck-dd: #607d8b;--hull-ss: #212121}.turret-base{position:absolute;top:50%;transform:translateY(-50%);z-index:10;display:flex;align-items:center;justify-content:center}.turret-bb{width:22px;height:20px;background:linear-gradient(to bottom,#eceff1,#90a4ae);border-radius:50% 4px 4px 50%;box-shadow:0 2px 3px #0006}.turret-bb:before{content:"";position:absolute;top:50%;transform:translateY(-50%);width:24px;height:3px;background:var(--color-barrel);box-shadow:0 -5px 0 var(--color-barrel),0 5px 0 var(--color-barrel);border-radius:0 2px 2px 0}.turret-bb:after{content:"";position:absolute;top:3px;bottom:3px;width:4px;background:#fff}.turret-cl{width:16px;height:14px;background:#b0bec5;border-radius:4px;box-shadow:0 1px 2px #0000004d}.turret-cl:before{content:"";position:absolute;top:4px;width:14px;height:2px;background:var(--color-barrel);box-shadow:0 4px 0 var(--color-barrel)}.turret-dd{width:12px;height:12px;background:#cfd8dc;border:1px solid #78909c;border-radius:50%}.turret-dd:before{content:"";position:absolute;top:50%;left:50%;width:10px;height:2px;background:var(--color-barrel);transform:translate(-100%,-50%)}.turret-bb:before{left:-20px}.turret-cl:before{left:-10px}.turret-bb:after{left:0}.facing-left .turret-bb,.facing-left .turret-cl,.facing-left .turret-dd{transform:rotate(0)}.facing-right .turret-bb,.facing-right .turret-cl,.facing-right .turret-dd{transform:rotate(180deg)}.hull-bb{width:240px;height:46px;background:repeating-linear-gradient(90deg,#795548 0px 4px,#5d4037 5px);border-radius:50% 15% 15% 50%;position:relative;overflow:hidden;box-shadow:inset 0 0 0 3px var(--color-steel-mid)}.bb-bridge-complex{position:absolute;left:85px;top:4px;bottom:4px;width:60px;background:#0003;border-radius:4px;z-index:5}.bb-tower{position:absolute;left:0;top:-2px;bottom:-2px;width:25px;background:var(--color-steel-light);border:1px solid var(--color-steel-dark);border-radius:4px;box-shadow:2px 2px 4px #0006}.bb-funnel{position:absolute;right:5px;top:8px;bottom:8px;width:18px;background:repeating-linear-gradient(to bottom,#37474f,#37474f 4px,#263238 5px);border-radius:6px;border:1px solid #fff}.bb-stern-equipment{position:absolute;right:10px;top:0;bottom:0;width:40px;z-index:1}.bb-catapult-rail{position:absolute;top:10px;bottom:10px;left:0;width:20px;border-top:2px solid #5d4037;border-bottom:2px solid #5d4037;opacity:.7}.bb-crane{position:absolute;right:5px;bottom:12px;width:25px;height:4px;background:var(--color-steel-dark);transform:rotate(-45deg);border-radius:2px;box-shadow:1px 1px 2px #00000080}.bb-floatplane{position:absolute;left:5px;top:50%;transform:translateY(-50%);width:12px;height:10px;background:#4caf50;clip-path:polygon(50% 0,100% 50%,50% 100%,0 50%)}.hull-cv{width:240px;height:50px;background:var(--deck-flight);border-radius:4px;position:relative;background-image:linear-gradient(90deg,transparent 20%,rgba(255,255,255,.9) 20%,rgba(255,255,255,.9) 80%,transparent 80%),linear-gradient(to bottom,transparent 5%,rgba(255,255,255,.1) 5%,rgba(255,255,255,.1) 95%,transparent 95%);background-size:30px 3px,100% 100%;background-repeat:repeat-x,no-repeat;background-position:center,center}.cv-island{position:absolute;right:55px;top:-6px;width:45px;height:14px;background:var(--color-steel-dark);border-radius:2px;z-index:20;box-shadow:3px 3px 5px #00000080;border-right:6px solid #263238}.cv-elevator{position:absolute;left:60px;top:6px;width:35px;height:38px;border:1px dashed rgba(255,255,255,.4);background:#0003}.cv-sponson{position:absolute;left:10px;bottom:-4px;width:40px;height:6px;background:var(--color-steel-mid);border-radius:0 0 4px 4px}.cv-arrow{position:absolute;left:5px;top:50%;transform:translateY(-50%);width:0;height:0;border-top:6px solid transparent;border-bottom:6px solid transparent;border-right:10px solid #fff}.hull-cl{width:170px;height:32px;background:var(--color-steel-mid);background-image:repeating-linear-gradient(90deg,transparent,transparent 19px,rgba(0,0,0,.1) 20px);border-radius:50% 10% 10% 50%;position:relative;box-shadow:inset 0 0 0 2px var(--color-steel-dark)}.cl-bridge-area{position:absolute;inset:0 40px 0 50px}.cl-block{position:absolute;left:0;top:2px;bottom:2px;width:15px;background:var(--color-steel-dark);border-radius:2px}.cl-funnel{position:absolute;width:8px;height:18px;background:#37474f;border-radius:4px;top:7px}.hull-dd{width:120px;height:22px;background:var(--deck-dd);border-radius:100px 3px 3px 100px;position:relative;display:flex;align-items:center}.dd-mid{position:absolute;left:35px;right:30px;height:100%}.dd-structure{position:absolute;top:6px;width:8px;height:10px;background:#546e7a;border-radius:2px}.dd-torpedo{position:absolute;top:5px;width:12px;height:12px;background:linear-gradient(90deg,#455a64,#263238);border-radius:2px}.hull-ss{width:60px;height:14px;background:var(--hull-ss);border-radius:10px;position:relative;box-shadow:inset 0 2px 4px #ffffff1a}.ss-tower{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:8px;height:22px;background:#333;border-radius:2px;border-top:1px solid #666}.ss-periscope{position:absolute;right:-2px;top:0;width:2px;height:6px;background:#999}.ship-inner{display:flex;align-items:center;justify-content:center;overflow:visible}.hull-scale-wrapper{transform-origin:center center}</style>
</head>
<body>
  <header>
    <h1>ÊåáÊå•ÂÆòÔºöÂÜ≥ÊàòÂ§ßÊ¥ã</h1>
    <button id="btn-menu-toggle" class="icon-btn" aria-label="ËèúÂçï">‚öôÔ∏è</button>
  </header>

  <div id="help-modal" class="modal">
    <div class="modal-content">
      <span class="close-btn" data-action="toggle-help">&times;</span>
      <h2 style="color: var(--accent); text-align: center; margin-top: 0;">Ê∏∏ÊàèËßÑÂàôËØ¥Êòé</h2>

      <h3>1. ËÉúÂà©Êù°‰ª∂</h3>
      <p>ÁéáÂÖàÂáªÊ≤âÊïåÊñπÊâÄÊúâ 5 ËâòËà∞ËàπÁöÑ‰∏ÄÊñπËé∑ËÉú„ÄÇ</p>

      <h3>2. Ëà∞ËàπÂ±ûÊÄß</h3>
      <table class="rules-table">
        <thead>
          <tr><th>ÂõæÁ§∫</th><th>‰ª£Âè∑</th><th>ÂêçÁß∞</th><th>ÈïøÂ∫¶</th><th>Ë°ÄÈáè/Ê†º</th><th>ÁâπÊÆäËÉΩÂäõ</th></tr>
        </thead>
        <tbody id="rules-ship-table-body"></tbody>
      </table>

      <h3>3. Ê≠¶Âô®Á≥ªÁªü</h3>
      <table class="rules-table">
        <tr><th>Ê≠¶Âô®</th><th>ËåÉÂõ¥</th><th>‰º§ÂÆ≥</th><th>ËØ¥Êòé</th></tr>
        <tr><td><b>‰∏ªÁÇÆ</b></td><td>ÂçïÁÇπ</td><td>1~3</td><td>Âü∫Á°ÄÊîªÂáª„ÄÇ‰º§ÂÆ≥ÂèñÂÜ≥‰∫éÂ≠òÊ¥ªËà∞Ëàπ(BB/SS=3, CL=2, ÂÖ∂‰ªñ=1)„ÄÇ</td></tr>
        <tr><td><b>Á©∫Ë¢≠</b></td><td>XÂûã (5Ê†º)</td><td>1</td><td>ÈúÄËà™ÊØç(CV)Â≠òÊ¥ª„ÄÇÂØπ‰∏≠ÂøÉÂèäÂõõËßíÈÄ†Êàê‰º§ÂÆ≥„ÄÇ</td></tr>
        <tr><td><b>Ê∞¥Âê¨</b></td><td>3x3 Âå∫Âüü</td><td>0</td><td>ÈúÄÈ©±ÈÄê(DD)Â≠òÊ¥ª„ÄÇÊé¢ÊµãÂå∫ÂüüÂÜÖÊòØÂê¶ÊúâËàπ„ÄÇËã•ÊúâÔºåÊòæÁ§∫‰∏≠ÂøÉÁúüÂÆûÁä∂ÊÄÅÔºåÂπ∂Ê†áËÆ∞Âë®Âõ¥‰∏∫Áñë‰ºº„ÄÇ</td></tr>
      </table>

      <h3>4. Áä∂ÊÄÅÊ†áËØÜ</h3>
      <ul style="font-size: 14px; line-height: 1.6;">
        <li>üåä <b>Á©∫ÁôΩ</b>ÔºöÊú™Áü•Êµ∑Âüü„ÄÇ</li>
        <li>‚ö™ <b>Ê∞¥Ëä±</b>ÔºöÊú™ÂëΩ‰∏≠ (Miss)„ÄÇ</li>
        <li>‚ùì <b>ÈóÆÂè∑</b>ÔºöÁñë‰ººÁõÆÊ†á (Â£∞ÂëêÊâ´ÊèèÁªìÊûú)„ÄÇ</li>
        <li>üí• <b>ÂÜíÁÉü</b>ÔºöÂèóÊçü (Hit)ÔºåËàπËøòÂú®„ÄÇ</li>
        <li>‚ò†Ô∏è <b>Á∫¢Âèâ</b>ÔºöÊØÅÂùè (Destroyed)ÔºåËØ•Ê†ºË°ÄÈáèÂΩíÈõ∂„ÄÇ</li>
      </ul>

      <h3>5. Â∞èÊèêÁ§∫</h3>
      <ul style="font-size: 14px; line-height: 1.6;">
        <li>ÁßªÂä®Á´ØÈïøÊåâË¶ÅÊîªÂáªÁöÑÊ†º‰ΩçÂèØ‰ª•È¢ÑËßàÊîªÂáªËåÉÂõ¥</li>
        <li>Êõ¥ÊîπÈÉ®ÁΩ≤ÊñπÂêëÈ¶ñÂÖàÈúÄË¶ÅÂ∞ÜËà∞ËàπÊãñÂõûÊ∏ØÂè£ÔºàÂú®‰øÆ‰∫ÜÂú®‰øÆ‰∫ÜÔºâ</li>
      </ul>
    </div>
  </div>

  <div id="game-over-modal" class="modal">
    <div class="modal-content game-over-content">
      <h2 id="game-over-title" class="game-over-title"></h2>
      <p id="game-over-msg" style="font-size: 1.2rem; margin-bottom: 30px; color: #cbd5e0;"></p>
      <div style="display: flex; gap: 10px; justify-content: center;">
        <button class="btn-blue" data-action="view-battlefield" style="font-size: 1.2rem; padding: 12px 20px;">üëÄ Êü•ÁúãÊàòÂú∫</button>
        <button class="btn-restart" data-action="restart-game" style="font-size: 1.2rem; padding: 12px 20px;">üîÑ ÈáçÊñ∞ÂºÄÂßã</button>
      </div>
    </div>
  </div>

  <!-- ÈÄöÁî®ËèúÂçïÊ®°ÊÄÅÊ°Ü (ÂéüËÆæÁΩÆËèúÂçï) -->
  <div id="settings-modal" class="modal">
    <div class="modal-content menu-modal-content">
      <span class="close-btn" data-action="toggle-settings">&times;</span>
      <h2 style="color: var(--accent); text-align: center; margin-top: 0;">‚ò∞ ËèúÂçï</h2>
      
      <div class="menu-grid">
        <!-- Ê∏∏ÊàèÊéßÂà∂ -->
        <div class="menu-section">
            <div class="menu-label">Ê∏∏ÊàèÊéßÂà∂</div>
            <div class="menu-row">
                <button id="mobile-menu-restart" class="menu-btn btn-restart">üîÑ ÈáçÊñ∞ÂºÄÂßã</button>
                <button id="mobile-menu-random" class="menu-btn btn-blue">üé≤ ÈöèÊú∫ÈÉ®ÁΩ≤</button>
            </div>
            <button id="mobile-menu-reset" class="menu-btn btn-blue" style="width:100%; margin-top:8px">‚Ü©Ô∏è ÂÖ®ÈÉ®ÂõûÊ∏Ø</button>
        </div>

        <!-- ÈöæÂ∫¶ËÆæÁΩÆ -->
        <div class="menu-section">
            <div class="menu-label">AI ÈöæÂ∫¶</div>
            <div class="difficulty-bar">
                <button class="diff-btn" id="mobile-diff-easy" data-difficulty="EASY">Êñ∞ÂÖµ</button>
                <button class="diff-btn" id="mobile-diff-normal" data-difficulty="NORMAL">Ëà∞Èïø</button>
                <button class="diff-btn" id="mobile-diff-hard" data-difficulty="HARD">ÊèêÁù£</button>
            </div>
        </div>

        <!-- ÈÄâÈ°π -->
        <div class="menu-section">
            <div class="menu-label">ÈÄâÈ°π</div>
            <div class="menu-row">
                <button class="btn-mode" id="mobile-first-turn">ÂÖàÊâãÔºöÁé©ÂÆ∂ üë§</button>
                <button class="btn-mode" id="mobile-debug">üß† AI ËßÜËßí</button>
            </div>
        </div>
        
        <!-- Â∏ÆÂä© -->
        <div class="menu-section">
             <button id="mobile-menu-help" class="menu-btn btn-orange" style="width:100%">üìñ Ê∏∏ÊàèËØ¥Êòé</button>
        </div>
      </div>
    </div>
  </div>

  <div class="layout">
    <div class="dock-panel">
      <div class="dock-header">
        <span>‚öì Ë£ÖÂ§áÂå∫</span>
        <div id="help-btn" data-action="toggle-help">?</div>
      </div>

      <div id="battle-panel" class="dock-container" style="display: none; align-items: stretch;">
        <div class="weapon-bar" id="weapon-bar">
          <button class="weapon-btn active" id="btn-ap" data-weapon="AP">
            <span>üí• ‰∏ªÁÇÆ</span>
            <span id="ap-desc" style="font-size:10px; opacity:0.8">ÂçïÁÇπ 3‰º§</span>
          </button>
          <button class="weapon-btn" id="btn-he" data-weapon="HE">
            <span>‚úàÔ∏è Á©∫Ë¢≠</span>
            <span style="font-size:10px; opacity:0.8">ËåÉÂõ¥ 1‰º§</span>
          </button>
          <button class="weapon-btn" id="btn-sonar" data-weapon="SONAR">
            <span>üì° Ê∞¥Âê¨</span>
            <span style="font-size:10px; opacity:0.8">‰æ¶Êü• 3x3</span>
          </button>
        </div>

        <div class="status-panel" id="status-panel">
          <div style="text-align:center; color:#90cdf4; font-weight:bold; margin-bottom:5px">Ëà∞ÈòüÁä∂ÊÄÅ</div>
          <div id="ship-status-list"></div>
        </div>
      </div>

      <div class="dock-container" id="dock"></div>

      <div class="control-group">
        <div style="font-size: 12px; color: #a0aec0; margin-bottom: 2px;">AI ÈöæÂ∫¶</div>
        <div class="difficulty-bar" id="diff-bar">
          <button class="diff-btn" data-difficulty="EASY">Êñ∞ÂÖµ (ÁÆÄÂçï)</button>
          <button class="diff-btn" data-difficulty="NORMAL">Ëà∞Èïø (Âõ∞Èöæ)</button>
          <button class="diff-btn active" data-difficulty="HARD">ÊèêÁù£ (ÂÜ∑ÈÖ∑)</button>
        </div>

        <div class="btn-row">
          <button class="btn-mode" id="rotate-toggle" title="ÂàáÊç¢ÈÉ®ÁΩ≤ÊñπÂêë">ÊñπÂêëÔºöÊ∞¥Âπ≥ ‚Æï</button>
          <button class="btn-mode" id="first-turn-toggle" title="ÂàáÊç¢ÂÖàÊâã">ÂÖàÊâãÔºöÁé©ÂÆ∂ üë§</button>
        </div>
      </div>
    </div>

    <div class="center-area">
      <div class="toggle-btn toggle-left" data-panel-toggle="left" title="ÂàáÊç¢Ë£ÖÂ§áÂå∫">‚óÄ</div>
      <div class="toggle-btn toggle-right" data-panel-toggle="right" title="ÂàáÊç¢Êó•ÂøóÂå∫">‚ñ∂</div>

      <div class="scroll-view">
        <div class="battlefield">
          <div class="board-box" id="player-board-box">
            <div class="board-title" style="color:#68d391">ÊàëÊñπÊµ∑Âüü (Èò≤ÂÆà)</div>
            <div id="player-grid" class="grid"></div>
          </div>
          <div class="board-box" id="enemy-board-box">
            <div class="board-title" style="color:#fc8181">ÊïåÊñπÊµ∑Âüü (ËøõÊîª)</div>
            <div id="enemy-grid" class="grid"></div>
          </div>
        </div>
      </div>

      <div class="bottom-controls" id="bottom-controls">
        <!-- ÁßªÂä®Á´ØÂ∫ïÈÉ®ÂØºËà™ (Êñ∞ËÆæËÆ°) -->
        <div class="mobile-bottom-bar">
            <button class="nav-tab active" id="mb-tab-player">
                <span class="icon">üõ°Ô∏è</span>
                <span class="label">ÊàëÊñπ</span>
            </button>
            
            <div class="action-center">
                <!-- ÈÉ®ÁΩ≤Èò∂ÊÆµ -->
                <div class="deploy-actions" id="mb-deploy-group">
                    <button id="mb-btn-start" class="action-btn primary" disabled>
                        <span>üöÄ ÂºÄÂßã</span>
                    </button>
                </div>
                <!-- ÊàòÊñóÈò∂ÊÆµ -->
                <div class="combat-actions" id="mb-combat-group" style="display:none">
                    <button id="mb-btn-weapon" class="action-btn weapon-selector">
                        <span id="mb-weapon-icon">üí•</span>
                        <span id="mb-weapon-name">‰∏ªÁÇÆ</span>
                    </button>
                </div>
            </div>

            <button class="nav-tab" id="mb-tab-enemy">
                <span class="icon">üéØ</span>
                <span class="label">ÊïåÊñπ</span>
            </button>
        </div>

        <!-- Ê°åÈù¢Á´ØÂéüÊúâÊåâÈíÆ (ÁßªÂä®Á´ØÈöêËóè) -->
        <div class="desktop-controls">
            <button class="btn-mode" id="btn-debug" title="AI ËßÜËßí (Debug)">üß† AI ËßÜËßí</button>
            <button id="btn-reset" class="btn-blue" title="ÂÖ®ÈÉ®ÂõûÊ∏Ø">üîÑ ÂÖ®ÈÉ®ÂõûÊ∏Ø</button>
            <button id="btn-settings" class="btn-blue" style="display:none" title="ËÆæÁΩÆ">‚öôÔ∏è ËÆæÁΩÆ</button>
            <button id="btn-random" class="btn-blue" title="ÈöèÊú∫ÈÉ®ÁΩ≤">üé≤ ÈöèÊú∫ÈÉ®ÁΩ≤</button>
            <button class="btn-orange" id="start-btn" disabled>üöÄ ÂºÄÂßãÊàòÊñó</button>
        </div>
      </div>
    </div>

    <div class="log-panel">
      <div class="log-header">‚ö° ÊàòÂÜµËÆ∞ÂΩï</div>
      <div id="log" class="log-content">
        <div class="log-line c-sys">ÊãñÊãΩÈÉ®ÁΩ≤ÔºåÁªøËâ≤Âå∫Âüü‰∏∫ÊúâÊïà„ÄÇ</div>
        <div class="log-line c-sys">ÂáÜÂ§áÂ∞±Áª™ÂêéÁÇπÂáªÂºÄÂßã„ÄÇ</div>
      </div>
    </div>
  </div>

</body>
</html>
