### 表一：攻击机制配置表 (Attack Config)

| UI名称 | 标识符 | 攻击范围 | 伤害数值 (Dmg) | 判定逻辑 (Dev Logic) |
| :--- | :--- | :--- | :--- | :--- |
| **主炮** | `GUN` | **1格** | **3** (若持有者存活)<br>**1** (若持有者全灭) | **单点判定**：<br>`Target.HP -= Dmg`<br>若 `Target.HP <= 0`，状态转为 **X (毁坏)**；<br>若 `Target.HP > 0`，状态转为 **Hit (受损)**。 |
| **空袭** | `AIR` | **5格** (X字) | **1** | **多点循环判定**：<br>对5个坐标分别执行单点判定。<br>若某点已是 Miss/X，则跳过；若为未知，执行扣血逻辑。 |
| **水听** | `SONAR` | **9格** (3x3) | **0** | **区域扫描逻辑**：<br>1. 遍历9格，若 `Sum(ShipCount) == 0` $\rightarrow$ 全部标记为 **Miss**。<br>2. 若 `Sum > 0` $\rightarrow$ 强制揭示中心点 `(x,y)` 的当前真实状态（Miss/Hit/X），并为周围区域标记疑似状态 |

---

### 表二：船只属性定义表 (Ship Stats)

| 代号 | 船只名称 | 占格 | 格位血量 (MaxHP) | 绑定攻击 | 战术解释 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **CV** | 航空母舰 | 4 | **2** | **空袭** | **空袭核心**：拥有者 |
| **CL** | 轻巡洋舰 | 3 | **1** | **主炮** | **穿甲僚机**：存活时主炮伤害>=2 |
| **BB** | 战列舰 | 4 | **3** | **主炮** | **穿甲核心**：存活时主炮伤害=3 |
| **SS** | 潜艇 | 1 | **2** | **主炮** | **穿甲雷击**：存活时主炮伤害=3 (雷击) |
| **DD** | 驱逐舰 | 2 | **1** | **水听** | **侦查核心**：失去后无法发动水听。 |

---

### 表三：格位状态机 (Grid State Machine)

这张表定义了地图上每一个格子（Grid Cell）在数据层和表现层的状态流转。

*   **FOW**: Fog of War (战争迷雾，未探索)
*   **Obj**: 该格子是否有船只实体 (null 或 ShipID)

| 状态名称 (State) | 前置条件 | 触发事件 (Event) | 转换后状态 (Next State) | UI表现 (View) | 备注 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **未知 (FOW)** | 初始状态 | 玩家攻击 / 水听扫描 | (见下文判定) | **空白/海浪** | 玩家不可见内部是否有船 |
| **$\downarrow$ 判定过程** | FOW状态被击中 | **判定：Obj Is Null?** | (分流) | - | 后端逻辑 |
| **未命中 (MISS)** | Obj Is Null | 攻击结算 / 水听排空 | **终态** | **水花图标 / 灰点** | 确认为安全海域，不可再被选为目标 |
| **疑似 (DETECT)** | Obj Is Null | 水听排空 | **受损，毁坏或未命中** | **问号图标** | 疑似标记，类似于扫雷中的插旗 |
| **受损 (HIT)** | Obj Not Null | 攻击结算 (HP剩余 > 0) | **保持 HIT 状态**<br>(但在数据层更新HP) | **冒烟 / 黄色爆炸** | 玩家知道这里有船，但没打烂。<br>*注：BB需打3次，SS需打2次* |
| **毁坏 (X)** | Obj Not Null | 攻击结算 (HP剩余 $\le$ 0) | **终态** | **大红叉 / 燃烧残骸** | 该格彻底报废。若该船所有格均为X，全船沉没。 |

#### 状态流转示例 (以攻击 BB 为例，BB单格血量=3)：

1.  **初始**：状态 `FOW`，HP=3。
2.  **玩家使用 HE (1伤)**：
    *   HP 变 2。
    *   状态变为 `HIT`。UI显示：冒烟。
3.  **玩家再使用 HE (1伤)**：
    *   HP 变 1。
    *   状态仍为 `HIT`。UI显示：冒烟（或者火势变大，如果美术资源允许）。
4.  **玩家使用 AP (3伤，溢出)**：
    *   HP 变 -2。
    *   状态变为 `X`。UI显示：红叉/残骸。

---

### 附录：AI 智能逻辑 (v3.0)

AI 现已完全改用 **概率推断** 作为唯一决策依据，不再需要“猎杀/搜寻”模式切换。

#### 1. 核心机制：概率网格 (Probability Grid)
AI 不掌握玩家真实布局，而是维护一个 $[0,1]$ 区间的概率矩阵，按如下规则实时更新：
* **全局约束**：根据玩家剩余的舰船长度与剩余格位血量，枚举每艘船所有合法放置（横/纵）方案。
* **局部证据**：每个放置方案会读取当前格子状态（MISS/DETECT/HIT/DESTROYED/沉没残骸），非法状态立即剔除；命中、毁坏和疑似格子分别给予不同的局部加成。
* **权重归一化**：把所有合法方案的权重平均分配给其覆盖的未知/疑似格子，并对全图进行归一化，得到“该格仍可能有船”的概率。
* **显式矫正**：命中格固定为1，Miss/Destroyed/沉没残骸则直接置零，保证概率矩阵与棋盘表现一致。

#### 2. 决策流程
每个回合 AI 都先刷新概率网格，再依据概率直接选择武器：
1. **主炮 (AP)**：锁定概率最高的格子打击；若有多格同概率则随机一格，命中线索会在下一回合被概率模型吸收。
2. **空袭 (HE)**：拥有航母时，以“概率总和”评估每个 X 字区域，若区域收益超过当前最佳单点 $\times 1.2$，则发动覆盖打击，用于清理交错的高概率区域。
3. **水听 (SONAR)**：拥有驱逐舰且最高概率仍低于阈值（例如 8%）时，挑选未知格子密度最大的 3x3 区域进行扫描；一旦扫描产出新证据，概率网格会立即偏向该区域。
4. **兜底**：若全部策略均无效（极罕见），在未探索区域内等概率随机开火，确保流程不会停顿。

#### 3. 行为特征
* **连续锁定**：命中某艘船后，受损段会让对应放置方案权重暴增，AI 自然沿可能的船体方向推进，无需额外的“猎杀模式”。
* **自适应侦查**：当全图概率分布趋于平坦时会偏向启动声纳，优先扩大未知区域的情报覆盖率。
* **火力调度**：空袭与主炮的选择直接比较概率收益，AI 会在“精准消灭”与“范围压制”之间动态切换。
* **计算复杂度**：枚举逻辑只依赖剩余船只与 10x10 棋盘，时间复杂度保持在 $O(\text{船型}\times 10^2)$，可以频繁刷新而不影响帧率。
